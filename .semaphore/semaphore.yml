version: v1.0
name: JavaScript example
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Publish the packages
    task:
      secrets:
        - name: GIT setup
        - name: NPM setup
        - name: SSH_PRIVATE_KEY
      prologue:
        commands:
          - checkout
          - nvm install node
          - node --version
          - npm --version
          # Correct premissions since they are too open by default:
          - chmod 0600 ~/.ssh/id_rsa
          # Add the key to the ssh agent:
          - ssh-add ~/.ssh/id_rsa
      jobs:
        - name: Publish
          commands:
            - echo "${USER_EMAIL}"
            - git config --global user.email "$USER_EMAIL"
            - git config --global user.name "$YOUR_NAME_SURNAME"
            - echo "git user:"
            - git config user.name
            - pwd
            - ls
            - git remote -v
