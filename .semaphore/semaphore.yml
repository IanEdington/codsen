version: v1.0
name: CODSEN
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
execution_time_limit:
  hours: 2
blocks:
  - name: Publish the packages
    task:
      secrets:
        - name: GIT setup
        - name: NPM setup
        - name: SSH_PRIVATE_KEY
      prologue:
        commands:
          - nvm install node
          - node --version
          - npm --version
          # Correct premissions since they are too open by default:
          - chmod 0600 ~/.ssh/id_rsa
          # Add the key to the ssh agent:
          - ssh-add ~/.ssh/id_rsa
          - checkout
      jobs:
        - name: Publish
          commands:
            # set up git
            - git config --global user.email "${USER_EMAIL}"
            - git config --global user.name "${YOUR_NAME_SURNAME}"
            - git config user.name
            - git remote -v
            # sey up npm
            - npm set unsafe-perm true -g
            - npm set //registry.npmjs.org/:_authToken $NPM_TOKEN -g
            - npm set username $NPM_USERNAME -g
            - npm set email $NPM_EMAIL -g
            - npm whoami
            # set up...
            - pwd
            - ls
            - npm run fresh
            - npm run info
            - npm run readme:generate
            - git status
