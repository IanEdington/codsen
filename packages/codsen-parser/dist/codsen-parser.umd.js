/**
 * codsen-parser
 * Parser aiming at broken code, especially HTML & CSS
 * Version: 0.4.0
 * Author: Roy Revelt, Codsen Ltd
 * License: MIT
 * Homepage: https://gitlab.com/codsen/codsen/tree/master/packages/codsen-parser
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).codsenParser=e()}(this,(function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function n(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function o(t){return"string"==typeof t&&t.length?t.includes(".")&&/^\d*$/.test(t.slice(t.lastIndexOf(".")+1))?`${t.slice(0,t.lastIndexOf(".")+1)}${+t.slice(t.lastIndexOf(".")+1)+1}`:/^\d*$/.test(t)?`${+t+1}`:t:t}function r(t){if("string"==typeof t){if(!t.includes(".")||!t.slice(t.indexOf(".")+1).includes("."))return"0";let e=0;for(let n=t.length;n--;)if("."===t[n]&&e++,2===e)return t.slice(0,n)}return t}Function.prototype.toString.call(Object);var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(t,e){return t(e={exports:{}},e.exports),e.exports}var s=i((function(t,e){var n="[object Arguments]",o="[object Function]",r="[object GeneratorFunction]",i="[object Map]",s="[object Set]",l=/\w*$/,c=/^\[object .+?Constructor\]$/,u=/^(?:0|[1-9]\d*)$/,m={};m[n]=m["[object Array]"]=m["[object ArrayBuffer]"]=m["[object DataView]"]=m["[object Boolean]"]=m["[object Date]"]=m["[object Float32Array]"]=m["[object Float64Array]"]=m["[object Int8Array]"]=m["[object Int16Array]"]=m["[object Int32Array]"]=m[i]=m["[object Number]"]=m["[object Object]"]=m["[object RegExp]"]=m[s]=m["[object String]"]=m["[object Symbol]"]=m["[object Uint8Array]"]=m["[object Uint8ClampedArray]"]=m["[object Uint16Array]"]=m["[object Uint32Array]"]=!0,m["[object Error]"]=m[o]=m["[object WeakMap]"]=!1;var g="object"==typeof a&&a&&a.Object===Object&&a,d="object"==typeof self&&self&&self.Object===Object&&self,f=g||d||Function("return this")(),p=e&&!e.nodeType&&e,h=p&&t&&!t.nodeType&&t,b=h&&h.exports===p;function y(t,e){return t.set(e[0],e[1]),t}function v(t,e){return t.add(e),t}function O(t,e,n,o){var r=-1,a=t?t.length:0;for(o&&a&&(n=t[++r]);++r<a;)n=e(n,t[r],r,t);return n}function w(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function k(t){var e=-1,n=Array(t.size);return t.forEach((function(t,o){n[++e]=[o,t]})),n}function A(t,e){return function(n){return t(e(n))}}function N(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var _,x=Array.prototype,C=Function.prototype,S=Object.prototype,E=f["__core-js_shared__"],j=(_=/[^.]+$/.exec(E&&E.keys&&E.keys.IE_PROTO||""))?"Symbol(src)_1."+_:"",I=C.toString,T=S.hasOwnProperty,M=S.toString,R=RegExp("^"+I.call(T).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),F=b?f.Buffer:void 0,P=f.Symbol,$=f.Uint8Array,B=A(Object.getPrototypeOf,Object),L=Object.create,D=S.propertyIsEnumerable,J=x.splice,W=Object.getOwnPropertySymbols,q=F?F.isBuffer:void 0,z=A(Object.keys,Object),V=ht(f,"DataView"),H=ht(f,"Map"),U=ht(f,"Promise"),G=ht(f,"Set"),Q=ht(f,"WeakMap"),Y=ht(Object,"create"),X=wt(V),K=wt(H),Z=wt(U),tt=wt(G),et=wt(Q),nt=P?P.prototype:void 0,ot=nt?nt.valueOf:void 0;function rt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}function at(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}function it(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}function st(t){this.__data__=new at(t)}function lt(t,e){var o=At(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&Nt(t)}(t)&&T.call(t,"callee")&&(!D.call(t,"callee")||M.call(t)==n)}(t)?function(t,e){for(var n=-1,o=Array(t);++n<t;)o[n]=e(n);return o}(t.length,String):[],r=o.length,a=!!r;for(var i in t)!e&&!T.call(t,i)||a&&("length"==i||vt(i,r))||o.push(i);return o}function ct(t,e,n){var o=t[e];T.call(t,e)&&kt(o,n)&&(void 0!==n||e in t)||(t[e]=n)}function ut(t,e){for(var n=t.length;n--;)if(kt(t[n][0],e))return n;return-1}function mt(t,e,a,c,u,g,d){var f;if(c&&(f=g?c(t,u,g,d):c(t)),void 0!==f)return f;if(!Ct(t))return t;var p=At(t);if(p){if(f=function(t){var e=t.length,n=t.constructor(e);e&&"string"==typeof t[0]&&T.call(t,"index")&&(n.index=t.index,n.input=t.input);return n}(t),!e)return function(t,e){var n=-1,o=t.length;e||(e=Array(o));for(;++n<o;)e[n]=t[n];return e}(t,f)}else{var h=yt(t),b=h==o||h==r;if(_t(t))return function(t,e){if(e)return t.slice();var n=new t.constructor(t.length);return t.copy(n),n}(t,e);if("[object Object]"==h||h==n||b&&!g){if(w(t))return g?t:{};if(f=function(t){return"function"!=typeof t.constructor||Ot(t)?{}:(e=B(t),Ct(e)?L(e):{});var e}(b?{}:t),!e)return function(t,e){return ft(t,bt(t),e)}(t,function(t,e){return t&&ft(e,St(e),t)}(f,t))}else{if(!m[h])return g?t:{};f=function(t,e,n,o){var r=t.constructor;switch(e){case"[object ArrayBuffer]":return dt(t);case"[object Boolean]":case"[object Date]":return new r(+t);case"[object DataView]":return function(t,e){var n=e?dt(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,o);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(t,e){var n=e?dt(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}(t,o);case i:return function(t,e,n){return O(e?n(k(t),!0):k(t),y,new t.constructor)}(t,o,n);case"[object Number]":case"[object String]":return new r(t);case"[object RegExp]":return function(t){var e=new t.constructor(t.source,l.exec(t));return e.lastIndex=t.lastIndex,e}(t);case s:return function(t,e,n){return O(e?n(N(t),!0):N(t),v,new t.constructor)}(t,o,n);case"[object Symbol]":return a=t,ot?Object(ot.call(a)):{}}var a}(t,h,mt,e)}}d||(d=new st);var A=d.get(t);if(A)return A;if(d.set(t,f),!p)var _=a?function(t){return function(t,e,n){var o=e(t);return At(t)?o:function(t,e){for(var n=-1,o=e.length,r=t.length;++n<o;)t[r+n]=e[n];return t}(o,n(t))}(t,St,bt)}(t):St(t);return function(t,e){for(var n=-1,o=t?t.length:0;++n<o&&!1!==e(t[n],n,t););}(_||t,(function(n,o){_&&(n=t[o=n]),ct(f,o,mt(n,e,a,c,o,t,d))})),f}function gt(t){return!(!Ct(t)||(e=t,j&&j in e))&&(xt(t)||w(t)?R:c).test(wt(t));var e}function dt(t){var e=new t.constructor(t.byteLength);return new $(e).set(new $(t)),e}function ft(t,e,n,o){n||(n={});for(var r=-1,a=e.length;++r<a;){var i=e[r],s=o?o(n[i],t[i],i,n,t):void 0;ct(n,i,void 0===s?t[i]:s)}return n}function pt(t,e){var n,o,r=t.__data__;return("string"==(o=typeof(n=e))||"number"==o||"symbol"==o||"boolean"==o?"__proto__"!==n:null===n)?r["string"==typeof e?"string":"hash"]:r.map}function ht(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return gt(n)?n:void 0}rt.prototype.clear=function(){this.__data__=Y?Y(null):{}},rt.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},rt.prototype.get=function(t){var e=this.__data__;if(Y){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return T.call(e,t)?e[t]:void 0},rt.prototype.has=function(t){var e=this.__data__;return Y?void 0!==e[t]:T.call(e,t)},rt.prototype.set=function(t,e){return this.__data__[t]=Y&&void 0===e?"__lodash_hash_undefined__":e,this},at.prototype.clear=function(){this.__data__=[]},at.prototype.delete=function(t){var e=this.__data__,n=ut(e,t);return!(n<0)&&(n==e.length-1?e.pop():J.call(e,n,1),!0)},at.prototype.get=function(t){var e=this.__data__,n=ut(e,t);return n<0?void 0:e[n][1]},at.prototype.has=function(t){return ut(this.__data__,t)>-1},at.prototype.set=function(t,e){var n=this.__data__,o=ut(n,t);return o<0?n.push([t,e]):n[o][1]=e,this},it.prototype.clear=function(){this.__data__={hash:new rt,map:new(H||at),string:new rt}},it.prototype.delete=function(t){return pt(this,t).delete(t)},it.prototype.get=function(t){return pt(this,t).get(t)},it.prototype.has=function(t){return pt(this,t).has(t)},it.prototype.set=function(t,e){return pt(this,t).set(t,e),this},st.prototype.clear=function(){this.__data__=new at},st.prototype.delete=function(t){return this.__data__.delete(t)},st.prototype.get=function(t){return this.__data__.get(t)},st.prototype.has=function(t){return this.__data__.has(t)},st.prototype.set=function(t,e){var n=this.__data__;if(n instanceof at){var o=n.__data__;if(!H||o.length<199)return o.push([t,e]),this;n=this.__data__=new it(o)}return n.set(t,e),this};var bt=W?A(W,Object):function(){return[]},yt=function(t){return M.call(t)};function vt(t,e){return!!(e=null==e?9007199254740991:e)&&("number"==typeof t||u.test(t))&&t>-1&&t%1==0&&t<e}function Ot(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||S)}function wt(t){if(null!=t){try{return I.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function kt(t,e){return t===e||t!=t&&e!=e}(V&&"[object DataView]"!=yt(new V(new ArrayBuffer(1)))||H&&yt(new H)!=i||U&&"[object Promise]"!=yt(U.resolve())||G&&yt(new G)!=s||Q&&"[object WeakMap]"!=yt(new Q))&&(yt=function(t){var e=M.call(t),n="[object Object]"==e?t.constructor:void 0,o=n?wt(n):void 0;if(o)switch(o){case X:return"[object DataView]";case K:return i;case Z:return"[object Promise]";case tt:return s;case et:return"[object WeakMap]"}return e});var At=Array.isArray;function Nt(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}(t.length)&&!xt(t)}var _t=q||function(){return!1};function xt(t){var e=Ct(t)?M.call(t):"";return e==o||e==r}function Ct(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function St(t){return Nt(t)?lt(t):function(t){if(!Ot(t))return z(t);var e=[];for(var n in Object(t))T.call(t,n)&&"constructor"!=n&&e.push(n);return e}(t)}t.exports=function(t){return mt(t,!0,!0)}}));function l(t,e){return function(t,e,n){if("string"!=typeof t||!t.length)return null;if(e&&"number"==typeof e||(e=0),!t[e+1])return null;if(t[e+1]&&(!n&&t[e+1].trim().length||n&&(t[e+1].trim().length||"\n\r".includes(t[e+1]))))return e+1;if(t[e+2]&&(!n&&t[e+2].trim().length||n&&(t[e+2].trim().length||"\n\r".includes(t[e+2]))))return e+2;for(let o=e+1,r=t.length;o<r;o++)if(t[o]&&(!n&&t[o].trim().length||n&&(t[o].trim().length||"\n\r".includes(t[o]))))return o;return null}(t,e,!1)}function c(t,e){return function(t,e,n){if("string"!=typeof t||!t.length)return null;if(e&&"number"==typeof e||(e=0),e<1)return null;if(t[e-1]&&(!n&&t[e-1].trim().length||n&&(t[e-1].trim().length||"\n\r".includes(t[e-1]))))return e-1;if(t[e-2]&&(!n&&t[e-2].trim().length||n&&(t[e-2].trim().length||"\n\r".includes(t[e-2]))))return e-2;for(let o=e;o--;)if(t[o]&&(!n&&t[o].trim().length||n&&(t[o].trim().length||"\n\r".includes(t[o]))))return o;return null}(t,e,!1)}function u(t){return"string"==typeof t}function m(t,e,n,o){if(!u(t))throw new TypeError(`string-find-malformed: [THROW_ID_01] the first input argument, string where to look for, must be a string! Currently it's equal to: ${t} (type: ${typeof t})`);if(!t.length)return;if(!u(e))throw new TypeError(`string-find-malformed: [THROW_ID_02] the second input argument, string we should find, must be a string! Currently it's equal to: ${e} (type: ${typeof e})`);if(!e.length)return;if("function"!=typeof n)throw new TypeError(`string-find-malformed: [THROW_ID_03] the third input argument, a callback function, must be a function! Currently it's equal to: ${n} (type: ${typeof n})`);if(o&&(!(r=o)||"object"!=typeof r||Array.isArray(r)))throw new TypeError(`string-find-malformed: [THROW_ID_04] the fourth input argument, an Optional Options Object, must be a plain object! Currently it's equal to: ${o} (type: ${typeof o})`);var r;const a=Object.assign({},{stringOffset:0,maxDistance:1,ignoreWhitespace:!0},o);if("string"==typeof a.stringOffset&&/^\d*$/.test(a.stringOffset))a.stringOffset=Number(a.stringOffset);else if(!Number.isInteger(a.stringOffset)||a.stringOffset<0)throw new TypeError(`${a.source} [THROW_ID_05] opts.stringOffset must be a natural number or zero! Currently it's: ${a.fromIndex}`);const i=t.length,s=Math.min(e.length,a.maxDistance+1);let c=[];const m=a.maxDistance;let g;for(let o=0;o<i;o++){if(a.ignoreWhitespace&&!t[o].trim().length)continue;for(let e=0,n=c.length;e<n;e++)g=!1,Array.isArray(c[e].pendingToCheck)&&c[e].pendingToCheck.length&&t[o]===c[e].pendingToCheck[0]?(g=!0,c[e].pendingToCheck.shift()):Array.isArray(c[e].pendingToCheck)&&c[e].pendingToCheck.length&&t[o]===c[e].pendingToCheck[1]?(g=!0,c[e].pendingToCheck.shift(),c[e].pendingToCheck.shift(),c[e].patienceLeft=c[e].patienceLeft-1):(c[e].patienceLeft=c[e].patienceLeft-1,t[l(t,o)]!==c[e].pendingToCheck[0]&&(c[e].pendingToCheck.shift(),t[o]===c[e].pendingToCheck[0]&&c[e].pendingToCheck.shift()));c=c.filter(t=>t.patienceLeft>=0);const r=c.filter(t=>0===t.pendingToCheck.length).map(t=>t.startsAt);if(Array.isArray(r)&&r.length){const i=Math.min(...r),s=o+(g?1:0);t.slice(i,s)!==e&&n({idxFrom:i+a.stringOffset,idxTo:s+a.stringOffset}),c=c.filter(t=>t.pendingToCheck.length)}for(let n=0;n<s;n++)if(t[o]===e[n]){const t={startsAt:o,patienceLeft:m-n,pendingToCheck:Array.from(e.slice(n+1))};c.push(t);break}}}var g=["abbr","accept","accept-charset","accesskey","action","align","alink","allow","alt","archive","async","autocapitalize","autocomplete","autofocus","autoplay","axis","background","background-attachment","background-color","background-image","background-position","background-position-x","background-position-y","background-repeat","bgcolor","border","border-bottom","border-bottom-color","border-bottom-style","border-bottom-width","border-collapse","border-color","border-left","border-left-color","border-left-style","border-left-width","border-right","border-right-color","border-right-style","border-right-width","border-style","border-top","border-top-color","border-top-style","border-top-width","border-width","buffered","capture","cellpadding","cellspacing","challenge","char","charoff","charset","checked","cite","class","classid","clear","clip","code","codebase","codetype","color","cols","colspan","column-span","compact","content","contenteditable","contextmenu","controls","coords","crossorigin","csp","cursor","data","data-*","datetime","declare","decoding","default","defer","dir","direction","dirname","disabled","display","download","draggable","dropzone","enctype","enterkeyhint","face","filter","float","font","font-color","font-emphasize","font-emphasize-position","font-emphasize-style","font-family","font-size","font-style","font-variant","font-weight","for","form","formaction","formenctype","formmethod","formnovalidate","formtarget","frame","frameborder","frontuid","headers","height","hidden","high","horiz-align","href","hreflang","hspace","http-equiv","icon","id","importance","inputmode","integrity","intrinsicsize","ismap","itemprop","keytype","kind","label","lang","language","layout-flow","layout-grid","layout-grid-char","layout-grid-line","layout-grid-mode","layout-grid-type","left","letter-spacing","line-break","line-height","link","list","list-image-1","list-image-2","list-image-3","list-style","list-style-image","list-style-position","list-style-type","loading","longdesc","loop","low","manifest","margin","margin-bottom","margin-left","margin-right","margin-top","marginheight","marginwidth","max","maxlength","media","method","min","minlength","mso-ansi-font-size","mso-ansi-font-style","mso-ansi-font-weight","mso-ansi-language","mso-ascii-font-family","mso-background","mso-background-source","mso-baseline-position","mso-bidi-flag","mso-bidi-font-family","mso-bidi-font-size","mso-bidi-font-style","mso-bidi-font-weight","mso-bidi-language","mso-bookmark","mso-border-alt","mso-border-between","mso-border-between-color","mso-border-between-style","mso-border-between-width","mso-border-bottom-alt","mso-border-bottom-color-alt","mso-border-bottom-source","mso-border-bottom-style-alt","mso-border-bottom-width-alt","mso-border-color-alt","mso-border-effect","mso-border-left-alt","mso-border-left-color-alt","mso-border-left-source","mso-border-left-style-alt","mso-border-left-width-alt","mso-border-right-alt","mso-border-right-color-alt","mso-border-right-source","mso-border-right-style-alt","mso-border-right-width-alt","mso-border-shadow","mso-border-source","mso-border-style-alt","mso-border-top-alt","mso-border-top-color-alt","mso-border-top-source","mso-border-top-style-alt","mso-border-top-width-alt","mso-border-width-alt","mso-break-type","mso-build","mso-build-after-action","mso-build-after-color","mso-build-auto-secs","mso-build-avi","mso-build-dual-id","mso-build-order","mso-build-sound-name","mso-bullet-image","mso-cell-special","mso-cellspacing","mso-char-indent","mso-char-indent-count","mso-char-indent-size","mso-char-type","mso-char-wrap","mso-color-alt","mso-color-index","mso-color-source","mso-column-break-before","mso-column-separator","mso-columns","mso-comment-author","mso-comment-continuation","mso-comment-id","mso-comment-reference","mso-data-placement","mso-default-height","mso-default-width","mso-diagonal-down","mso-diagonal-down-color","mso-diagonal-down-source","mso-diagonal-down-style","mso-diagonal-down-width","mso-diagonal-up","mso-diagonal-up-color","mso-diagonal-up-source","mso-diagonal-up-style","mso-diagonal-up-width","mso-displayed-decimal-separator","mso-displayed-thousand-separator","mso-element","mso-element-anchor-horizontal","mso-element-anchor-lock","mso-element-anchor-vertical","mso-element-frame-height","mso-element-frame-hspace","mso-element-frame-vspace","mso-element-frame-width","mso-element-left","mso-element-linespan","mso-element-top","mso-element-wrap","mso-endnote-continuation-notice","mso-endnote-continuation-notice-id","mso-endnote-continuation-notice-src","mso-endnote-continuation-separator","mso-endnote-continuation-separator-id","mso-endnote-continuation-separator-src","mso-endnote-display","mso-endnote-id","mso-endnote-numbering","mso-endnote-numbering-restart","mso-endnote-numbering-start","mso-endnote-numbering-style","mso-endnote-position","mso-endnote-separator","mso-endnote-separator-id","mso-endnote-separator-src","mso-even-footer","mso-even-footer-id","mso-even-footer-src","mso-even-header","mso-even-header-id","mso-even-header-src","mso-facing-pages","mso-fareast-font-family","mso-fareast-hint","mso-fareast-language","mso-field-change","mso-field-change-author","mso-field-change-time","mso-field-change-value","mso-field-code","mso-field-lock","mso-fills-color","mso-first-footer","mso-first-footer-id","mso-first-footer-src","mso-first-header","mso-first-header-id","mso-first-header-src","mso-font-alt","mso-font-charset","mso-font-format","mso-font-info","mso-font-info-charset","mso-font-info-type","mso-font-kerning","mso-font-pitch","mso-font-signature","mso-font-signature-csb-one","mso-font-signature-csb-two","mso-font-signature-usb-four","mso-font-signature-usb-one","mso-font-signature-usb-three","mso-font-signature-usb-two","mso-font-src","mso-font-width","mso-footer","mso-footer-data","mso-footer-id","mso-footer-margin","mso-footer-src","mso-footnote-continuation-notice","mso-footnote-continuation-notice-id","mso-footnote-continuation-notice-src","mso-footnote-continuation-separator","mso-footnote-continuation-separator-id","mso-footnote-continuation-separator-src","mso-footnote-id","mso-footnote-numbering","mso-footnote-numbering-restart","mso-footnote-numbering-start","mso-footnote-numbering-style","mso-footnote-position","mso-footnote-separator","mso-footnote-separator-id","mso-footnote-separator-src","mso-foreground","mso-forms-protection","mso-generic-font-family","mso-grid-bottom","mso-grid-bottom-count","mso-grid-left","mso-grid-left-count","mso-grid-right","mso-grid-right-count","mso-grid-top","mso-grid-top-count","mso-gutter-direction","mso-gutter-margin","mso-gutter-position","mso-hansi-font-family","mso-header","mso-header-data","mso-header-id","mso-header-margin","mso-header-src","mso-height-alt","mso-height-rule","mso-height-source","mso-hide","mso-highlight","mso-horizontal-page-align","mso-hyphenate","mso-ignore","mso-kinsoku-overflow","mso-layout-grid-align","mso-layout-grid-char-alt","mso-layout-grid-origin","mso-level-inherit","mso-level-legacy","mso-level-legacy-indent","mso-level-legacy-space","mso-level-legal-format","mso-level-number-format","mso-level-number-position","mso-level-numbering","mso-level-reset-level","mso-level-start-at","mso-level-style-link","mso-level-suffix","mso-level-tab-stop","mso-level-text","mso-line-break-override","mso-line-grid","mso-line-height-alt","mso-line-height-rule","mso-line-numbers-count-by","mso-line-numbers-distance","mso-line-numbers-restart","mso-line-numbers-start","mso-line-spacing","mso-linked-frame","mso-list","mso-list-change","mso-list-change-author","mso-list-change-time","mso-list-change-values","mso-list-id","mso-list-ins","mso-list-ins-author","mso-list-ins-time","mso-list-name","mso-list-template-ids","mso-list-type","mso-margin-bottom-alt","mso-margin-left-alt","mso-margin-top-alt","mso-mirror-margins","mso-negative-indent-tab","mso-number-format","mso-outline-level","mso-outline-parent","mso-outline-parent-col","mso-outline-parent-row","mso-outline-parent-visibility","mso-outline-style","mso-padding-alt","mso-padding-between","mso-padding-bottom-alt","mso-padding-left-alt","mso-padding-right-alt","mso-padding-top-alt","mso-page-border-aligned","mso-page-border-art","mso-page-border-bottom-art","mso-page-border-display","mso-page-border-left-art","mso-page-border-offset-from","mso-page-border-right-art","mso-page-border-surround-footer","mso-page-border-surround-header","mso-page-border-top-art","mso-page-border-z-order","mso-page-numbers","mso-page-numbers-chapter-separator","mso-page-numbers-chapter-style","mso-page-numbers-start","mso-page-numbers-style","mso-page-orientation","mso-page-scale","mso-pagination","mso-panose-arm-style","mso-panose-contrast","mso-panose-family-type","mso-panose-letterform","mso-panose-midline","mso-panose-proportion","mso-panose-serif-style","mso-panose-stroke-variation","mso-panose-weight","mso-panose-x-height","mso-paper-source","mso-paper-source-first-page","mso-paper-source-other-pages","mso-pattern","mso-pattern-color","mso-pattern-style","mso-print-area","mso-print-color","mso-print-gridlines","mso-print-headings","mso-print-resolution","mso-print-sheet-order","mso-print-title-column","mso-print-title-row","mso-prop-change","mso-prop-change-author","mso-prop-change-time","mso-protection","mso-rotate","mso-row-margin-left","mso-row-margin-right","mso-ruby-merge","mso-ruby-visibility","mso-scheme-fill-color","mso-scheme-shadow-color","mso-shading","mso-shadow-color","mso-space-above","mso-space-below","mso-spacerun","mso-special-character","mso-special-format","mso-style-id","mso-style-name","mso-style-next","mso-style-parent","mso-style-type","mso-style-update","mso-subdocument","mso-symbol-font-family","mso-tab-count","mso-table-anchor-horizontal","mso-table-anchor-vertical","mso-table-bspace","mso-table-del-author","mso-table-del-time","mso-table-deleted","mso-table-dir","mso-table-ins-author","mso-table-ins-time","mso-table-inserted","mso-table-layout-alt","mso-table-left","mso-table-lspace","mso-table-overlap","mso-table-prop-author","mso-table-prop-change","mso-table-prop-time","mso-table-rspace","mso-table-top","mso-table-tspace","mso-table-wrap","mso-text-animation","mso-text-combine-brackets","mso-text-combine-id","mso-text-control","mso-text-fit-id","mso-text-indent-alt","mso-text-orientation","mso-text-raise","mso-title-page","mso-tny-compress","mso-unsynced","mso-vertical-align-alt","mso-vertical-align-special","mso-vertical-page-align","mso-width-alt","mso-width-source","mso-word-wrap","mso-xlrowspan","mso-zero-height","multiple","muted","name","nav-banner-image","navbutton_background_color","navbutton_home_hovered","navbutton_home_normal","navbutton_home_pushed","navbutton_horiz_hovered","navbutton_horiz_normal","navbutton_horiz_pushed","navbutton_next_hovered","navbutton_next_normal","navbutton_next_pushed","navbutton_prev_hovered","navbutton_prev_normal","navbutton_prev_pushed","navbutton_up_hovered","navbutton_up_normal","navbutton_up_pushed","navbutton_vert_hovered","navbutton_vert_normal","navbutton_vert_pushed","nohref","noresize","noshade","novalidate","nowrap","object","onblur","onchange","onclick","ondblclick","onfocus","onkeydown","onkeypress","onkeyup","onload","onmousedown","onmousemove","onmouseout","onmouseover","onmouseup","onreset","onselect","onsubmit","onunload","open","optimum","overflow","padding","padding-bottom","padding-left","padding-right","padding-top","page","page-break-after","page-break-before","panose-1","pattern","ping","placeholder","position","poster","preload","profile","prompt","punctuation-trim","punctuation-wrap","radiogroup","readonly","referrerpolicy","rel","required","rev","reversed","right","row-span","rows","rowspan","ruby-align","ruby-overhang","ruby-position","rules","sandbox","scheme","scope","scoped","scrolling","selected","separator-image","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","standby","start","step","style","summary","tab-interval","tab-stops","tabindex","table-border-color-dark","table-border-color-light","table-layout","target","text","text-align","text-autospace","text-combine","text-decoration","text-effect","text-fit","text-indent","text-justify","text-justify-trim","text-kashida","text-line-through","text-shadow","text-transform","text-underline","text-underline-color","text-underline-style","title","top","top-bar-button","translate","type","unicode-bidi","urlId","usemap","valign","value","valuetype","version","vert-align","vertical-align","visibility","vlink","vnd.ms-excel.numberformat","vspace","white-space","width","word-break","word-spacing","wrap","xmlns","z-index"];function d(t){return t&&"object"==typeof t&&!Array.isArray(t)}function f(t){return"string"==typeof t}function p(t,e,n,o,r,a){const i="function"==typeof n?n():n;if(e<0&&r&&"EOL"===i)return i;if(e>=t.length&&!r)return!1;let s=r?1:n.length,l=!1,c=!1,u=o.maxMismatches,m=e,g=!1,d=!1,f=!1;for(;t[m];){const e=a(m);if(o.trimBeforeMatching&&""===t[m].trim()){if(!t[e]&&r&&"EOL"===n)return!0;m=a(m);continue}if(!o.i&&o.trimCharsBeforeMatching.includes(t[m])||o.i&&o.trimCharsBeforeMatching.map(t=>t.toLowerCase()).includes(t[m].toLowerCase())){if(r&&"EOL"===n&&!t[e])return!0;m=a(m);continue}const i=e>m?n[n.length-s]:n[s-1];if(!o.i&&t[m]===i||o.i&&t[m].toLowerCase()===i.toLowerCase()){if(g||(g=!0),c||(c=!0),s===n.length?d=!0:1===s&&(f=!0),s-=1,s<1)return m}else{if(!(o.maxMismatches&&u&&m))return!(0!==m||1!==s||o.lastMustMatch||!c)&&0;u--;for(let r=0;r<=u;r++){const i=e>m?n[n.length-s+1+r]:n[s-2-r],l=t[a(m)];if(i&&(!o.i&&t[m]===i||o.i&&t[m].toLowerCase()===i.toLowerCase())&&(!o.firstMustMatch||s!==n.length)){s-=2,g=!0;break}if(l&&i&&(!o.i&&l===i||o.i&&l.toLowerCase()===i.toLowerCase())&&(!o.firstMustMatch||s!==n.length)){s-=1,g=!0;break}if(void 0===i&&u>=0&&g&&(!o.firstMustMatch||d)&&(!o.lastMustMatch||f))return m}g||(l=m)}if(!1!==l&&l!==m&&(l=!1),s<1)return m;m=a(m)}return s>0?!(!r||"EOL"!==i)||!!(o.maxMismatches>=s&&c)&&(l||0):void 0}function h(t,e,n,o,r){if(d(r)&&Object.prototype.hasOwnProperty.call(r,"trimBeforeMatching")&&"boolean"!=typeof r.trimBeforeMatching)throw new Error(`string-match-left-right/${t}(): [THROW_ID_09] opts.trimBeforeMatching should be boolean!${Array.isArray(r.trimBeforeMatching)?" Did you mean to use opts.trimCharsBeforeMatching?":""}`);const a=Object.assign({},{i:!1,trimBeforeMatching:!1,trimCharsBeforeMatching:[],maxMismatches:0,firstMustMatch:!1,lastMustMatch:!1},r);var i;if(a.trimCharsBeforeMatching="string"==typeof(i=a.trimCharsBeforeMatching)?i.length>0?[i]:[]:i,a.trimCharsBeforeMatching=a.trimCharsBeforeMatching.map(t=>f(t)?t:String(t)),!f(e))return!1;if(!e.length)return!1;if(!Number.isInteger(n)||n<0)throw new Error(`string-match-left-right/${t}(): [THROW_ID_03] the second argument should be a natural number. Currently it's of a type: ${typeof n}, equal to:\n${JSON.stringify(n,null,4)}`);let s,l,c,u;if(f(o))s=[o];else if(Array.isArray(o))s=o;else if(o){if("function"!=typeof o)throw new Error(`string-match-left-right/${t}(): [THROW_ID_05] the third argument, whatToMatch, is neither string nor array of strings! It's ${typeof o}, equal to:\n${JSON.stringify(o,null,4)}`);s=[],s.push(o)}else s=o;if(r&&!d(r))throw new Error(`string-match-left-right/${t}(): [THROW_ID_06] the fourth argument, options object, should be a plain object. Currently it's of a type "${typeof r}", and equal to:\n${JSON.stringify(r,null,4)}`);if(a.trimCharsBeforeMatching.some((t,e)=>t.length>1&&(c=e,u=t,!0)))throw new Error(`string-match-left-right/${t}(): [THROW_ID_07] the fourth argument, options object contains trimCharsBeforeMatching. It was meant to list the single characters but one of the entries at index ${c} is longer than 1 character, ${u.length} (equals to ${u}). Please split it into separate characters and put into array as separate elements.`);if(!s||!Array.isArray(s)||Array.isArray(s)&&!s.length||Array.isArray(s)&&1===s.length&&f(s[0])&&!s[0].trim().length){if("function"==typeof a.cb){let o,r=n;if("matchLeftIncl"!==t&&"matchRight"!==t||(r+=1),"L"===t[5])for(let t=r;t--;){const n=e[t];if((!a.trimBeforeMatching||a.trimBeforeMatching&&void 0!==n&&n.trim().length)&&(!a.trimCharsBeforeMatching.length||void 0!==n&&!a.trimCharsBeforeMatching.includes(n))){o=t;break}}else if(t.startsWith("matchRight"))for(let t=r;t<e.length;t++){const n=e[t];if((!a.trimBeforeMatching||a.trimBeforeMatching&&n.trim().length)&&(!a.trimCharsBeforeMatching.length||!a.trimCharsBeforeMatching.includes(n))){o=t;break}}if(void 0===o)return!1;const i=e[o],s=o+1;let l="";return s&&s>0&&(l=e.slice(0,s)),"L"===t[5]?a.cb(i,l,o):(o&&o>0&&(l=e.slice(o)),a.cb(i,l,o))}let o="";throw r||(o=" More so, the whole options object, the fourth input argument, is missing!"),new Error(`string-match-left-right/${t}(): [THROW_ID_08] the third argument, "whatToMatch", was given as an empty string. This means, you intend to match purely by a callback. The callback was not set though, the opts key "cb" is not set!${o}`)}for(let o=0,r=s.length;o<r;o++){l="function"==typeof s[o];const r=s[o];let i,c,u="",m=n;"matchRight"===t?m++:"matchLeft"===t&&m--;const g=p(e,m,r,a,l,e=>"L"===t[5]?e-1:e+1);if(g&&l&&"function"==typeof r&&"EOL"===r())return!(!r()||a.cb&&!a.cb(i,u,c))&&r();if(Number.isInteger(g)&&(c=t.startsWith("matchLeft")?g-1:g+1,u="L"===t[5]?e.slice(0,g):e.slice(c)),c<0&&(c=void 0),e[c]&&(i=e[c]),Number.isInteger(g)&&(!a.cb||a.cb(i,u,c)))return r}return!1}function b(t,e,n,o){return h("matchLeftIncl",t,e,n,o)}function y(t,e,n,o){return h("matchLeft",t,e,n,o)}function v(t,e,n,o){return h("matchRightIncl",t,e,n,o)}function O(t,e,n,o){return h("matchRight",t,e,n,o)}const w=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","big","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","dir","div","dl","doctype","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h1 - h6","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","math","menu","menuitem","meta","meter","nav","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","slot","small","source","span","strike","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr","xml"];function k(t){return void 0===t||t.toUpperCase()===t.toLowerCase()&&!"0123456789".includes(t)&&"="!==t}function A(t,e=0,n){const o=Object.assign({},{allowCustomTagNames:!1,skipOpeningBracket:!1},n),r="._a-z0-9·À-ÖØ-öø-ͽͿ-῿‌-‍‿-⁀⁰-￿",a=new RegExp(`^${o.skipOpeningBracket?"":"<"}[\\\\ \\t\\r\\n/]*\\w+[\\\\ \\t\\r\\n/]*>`,"g"),i=new RegExp(`^${o.skipOpeningBracket?"":"<"}[\\\\ \\t\\r\\n/]*[${r}]+[-${r}]*[\\\\ \\t\\r\\n/]*>`,"g"),s=new RegExp(`^${o.skipOpeningBracket?"":"<"}\\s*\\w+\\s+\\w+(?:-\\w+)?\\s*=\\s*['"\\w]`,"g"),l=new RegExp(`^${o.skipOpeningBracket?"":"<"}\\s*\\w+\\s+[${r}]+[-${r}]*(?:-\\w+)?\\s*=\\s*['"\\w]`),c=new RegExp(`^${o.skipOpeningBracket?"":"<"}\\s*\\/?\\s*\\w+\\s*\\/?\\s*>`,"g"),u=new RegExp(`^${o.skipOpeningBracket?"":"<"}\\s*\\/?\\s*[${r}]+[-${r}]*\\s*\\/?\\s*>`,"g"),m=new RegExp(`^${o.skipOpeningBracket?"":"<"}[\\\\ \\t\\r\\n/]*\\w+(?:\\s*\\w+)*\\s*\\w+=['"]`,"g"),g=new RegExp(`^${o.skipOpeningBracket?"":"<"}[\\\\ \\t\\r\\n/]*[${r}]+[-${r}]*(?:\\s*\\w+)*\\s*\\w+=['"]`,"g"),d=e?t.slice(e):t;let f=!1;const p={cb:k,i:!0,trimCharsBeforeMatching:["/","\\","!"," ","\t","\n","\r"]};return o.allowCustomTagNames?(i.test(d)||l.test(d)||u.test(d)||g.test(d))&&(f=!0):v(t,e,w,{cb:k,i:!0,trimCharsBeforeMatching:["<","/","\\","!"," ","\t","\n","\r"]})&&(a.test(d)||s.test(d)||c.test(d)||m.test(d))&&(f=!0),!f&&!o.skipOpeningBracket&&"<"===t[e]&&t[e+1].trim().length&&O(t,e,w,p)&&(f=!0),"string"==typeof t&&e<t.length&&f}function N(t,e,n){return("<"===t[e]&&(O(t,e,["!--"],{maxMismatches:1,firstMustMatch:!0,trimBeforeMatching:!0})||O(t,e,["![endif]"],{i:!0,maxMismatches:2,trimBeforeMatching:!0}))&&!O(t,e,["![cdata","<"],{i:!0,maxMismatches:1,trimBeforeMatching:!0})&&("comment"!==n.type||"not"!==n.kind)||"-"===t[e]&&O(t,e,["->"],{trimBeforeMatching:!0})&&("comment"!==n.type||!n.closing&&"not"!==n.kind)&&!y(t,e,"<",{trimBeforeMatching:!0,trimCharsBeforeMatching:["-","!"]}))&&("esp"!==n.type||n.tail.includes(t[e]))}const _=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","bgsound","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","command","content","data","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","element","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","image","img","input","ins","isindex","kbd","keygen","label","legend","li","link","listing","main","map","mark","marquee","menu","menuitem","meta","meter","multicol","nav","nextid","nobr","noembed","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","plaintext","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr","xmp"],x="{}%-$_()*|",C=[")|(","|(",")(","()","{}","%)","*)","**"];function S(t){return"string"==typeof t}function E(t){return S(t)&&1===t.length&&(t.charCodeAt(0)>64&&t.charCodeAt(0)<91||t.charCodeAt(0)>96&&t.charCodeAt(0)<123)}function j(t){return E(t)||t.charCodeAt(0)>=48&&t.charCodeAt(0)<=57||[":","-"].includes(t)}function I(t){let e="";for(let n=0,o=t.length;n<o;n++)e="["===t[n]?`]${e}`:"{"===t[n]?`}${e}`:"("===t[n]?`)${e}`:`${t[n]}${e}`;return e}function T(t){return _.includes(t.toLowerCase())||["doctype","cdata","xml"].includes(t.toLowerCase())}function M(t,e,n,o){for(let r=e,a=t.length;r<a;r++){if(t.startsWith(n,r))return!0;if(t.startsWith(o,r))return!1}return!1}const R="\\";function F(t,e,n,o){return t[e]&&t[e].trim().length&&(!o.length||"text"===n.type)&&!["doctype","xml"].includes(n.kind)&&("<"===t[e]&&(A(t,e,{allowCustomTagNames:!0})||">"===t[l(t,e)]||O(t,e,["doctype","xml","cdata"],{i:!0,trimBeforeMatching:!0,trimCharsBeforeMatching:["?","!","["," ","-"]}))||E(t[e])&&(!t[e-1]||!E(t[e-1])&&!["<","/","!",R].includes(t[c(t,e)]))&&A(t,e,{allowCustomTagNames:!1,skipOpeningBracket:!0}))&&("esp"!==n.type||n.tail.includes(t[e]))}function P(t,e,n,o,r){return x.includes(t[e])&&t[e+1]&&x.includes(t[e+1])&&"rule"!==n.type&&"at"!==n.type&&!("-"===t[e]&&"-{(".includes(t[e+1]))&&!("})".includes(t[e])&&"-".includes(t[e+1]))&&!("0123456789".includes(t[c(t,e)])&&(!t[e+2]||['"',"'",";"].includes(t[e+2])||!t[e+2].trim().length))&&!(r&&("{}".includes(t[e])||"{}".includes(t[l(t,e)])))}function $(t){return t&&"object"==typeof t&&!Array.isArray(t)}const B=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"],L=["{","}",","];var D=i((function(t){t.exports=function(){var t=Object.prototype.toString;function e(t,e){return null!=t&&Object.prototype.hasOwnProperty.call(t,e)}function n(t){if(!t)return!0;if(r(t)&&0===t.length)return!0;if("string"!=typeof t){for(var n in t)if(e(t,n))return!1;return!0}return!1}function o(e){return t.call(e)}var r=Array.isArray||function(e){return"[object Array]"===t.call(e)};function a(t){var e=parseInt(t);return e.toString()===t?e:t}function i(t){t=t||{};var i=function(t){return Object.keys(i).reduce((function(e,n){return"create"===n||"function"==typeof i[n]&&(e[n]=i[n].bind(i,t)),e}),{})};function s(n,o){return t.includeInheritedProps||"number"==typeof o&&Array.isArray(n)||e(n,o)}function l(t,e){if(s(t,e))return t[e]}function c(t,e,n,o){if("number"==typeof e&&(e=[e]),!e||0===e.length)return t;if("string"==typeof e)return c(t,e.split(".").map(a),n,o);var r=e[0],i=l(t,r);return 1===e.length?(void 0!==i&&o||(t[r]=n),i):(void 0===i&&("number"==typeof e[1]?t[r]=[]:t[r]={}),c(t[r],e.slice(1),n,o))}return i.has=function(n,o){if("number"==typeof o?o=[o]:"string"==typeof o&&(o=o.split(".")),!o||0===o.length)return!!n;for(var i=0;i<o.length;i++){var s=a(o[i]);if(!("number"==typeof s&&r(n)&&s<n.length||(t.includeInheritedProps?s in Object(n):e(n,s))))return!1;n=n[s]}return!0},i.ensureExists=function(t,e,n){return c(t,e,n,!0)},i.set=function(t,e,n,o){return c(t,e,n,o)},i.insert=function(t,e,n,o){var a=i.get(t,e);o=~~o,r(a)||(a=[],i.set(t,e,a)),a.splice(o,0,n)},i.empty=function(t,e){var a,l;if(!n(e)&&null!=t&&(a=i.get(t,e))){if("string"==typeof a)return i.set(t,e,"");if(function(t){return"boolean"==typeof t||"[object Boolean]"===o(t)}(a))return i.set(t,e,!1);if("number"==typeof a)return i.set(t,e,0);if(r(a))a.length=0;else{if(!function(t){return"object"==typeof t&&"[object Object]"===o(t)}(a))return i.set(t,e,null);for(l in a)s(a,l)&&delete a[l]}}},i.push=function(t,e){var n=i.get(t,e);r(n)||(n=[],i.set(t,e,n)),n.push.apply(n,Array.prototype.slice.call(arguments,2))},i.coalesce=function(t,e,n){for(var o,r=0,a=e.length;r<a;r++)if(void 0!==(o=i.get(t,e[r])))return o;return n},i.get=function(t,e,n){if("number"==typeof e&&(e=[e]),!e||0===e.length)return t;if(null==t)return n;if("string"==typeof e)return i.get(t,e.split("."),n);var o=a(e[0]),r=l(t,o);return void 0===r?n:1===e.length?r:i.get(t[o],e.slice(1),n)},i.del=function(t,e){if("number"==typeof e&&(e=[e]),null==t)return t;if(n(e))return t;if("string"==typeof e)return i.del(t,e.split("."));var o=a(e[0]);return s(t,o)?1!==e.length?i.del(t[o],e.slice(1)):(r(t)?t.splice(o,1):delete t[o],t):t},i}var s=i();return s.create=i,s.withInheritedProps=i({includeInheritedProps:!0}),s}()}));function J(e){return e&&"object"===t(e)&&!Array.isArray(e)}function W(t,e){return console.log("013 layerPending() received: "),console.log("015 - 1.".concat("[".concat(33,"m","layers","[",39,"m")," = ",JSON.stringify(t,null,4))),console.log("022 - 2. ".concat("[".concat(33,"m","tokenObj","[",39,"m")," = ",JSON.stringify(e,null,4))),console.log("029 >>>>>> ".concat("[".concat(33,"m","layers[layers.length - 1].tagName","[",39,"m")," = ",JSON.stringify(t.length&&J(t[t.length-1])&&t[t.length-1].tagName?t[t.length-1].tagName:null,null,4))),console.log("040 >>>>>> ".concat("[".concat(33,"m","tokenObj.tagName","[",39,"m")," = ",JSON.stringify(e.tagName,null,4))),e.closing&&t.length&&(t[t.length-1].type===e.type&&Object.prototype.hasOwnProperty.call(t[t.length-1],"tagName")&&Object.prototype.hasOwnProperty.call(e,"tagName")&&t[t.length-1].tagName===e.tagName&&!1===t[t.length-1].closing||"comment"===e.type&&t.some((function(t){return Object.prototype.hasOwnProperty.call(t,"closing")&&!t.closing})))}return function(a,i){if("string"!=typeof a)throw void 0===a?new Error("codsen-tokenizer: [THROW_ID_01] the first input argument is completely missing! It should be given as string."):new Error('codsen-tokenizer: [THROW_ID_02] the first input argument must be string! It was given as "'.concat(t(a),'", equal to:\n').concat(JSON.stringify(a,null,4)));if(i&&!J(i))throw new Error("codsen-tokenizer: [THROW_ID_03] the second input argument, an options object, should be a plain object but it was given as type ".concat(t(i),", equal to ").concat(JSON.stringify(i,null,4)));if(J(i)&&i.tagCb&&"function"!=typeof i.tagCb)throw new Error("codsen-tokenizer: [THROW_ID_04] the opts.tagCb, callback function, should be a function but it was given as type ".concat(t(i.tagCb),", equal to ").concat(JSON.stringify(i.tagCb,null,4)));if(J(i)&&i.charCb&&"function"!=typeof i.charCb)throw new Error("codsen-tokenizer: [THROW_ID_05] the opts.charCb, callback function, should be a function but it was given as type ".concat(t(i.charCb),", equal to ").concat(JSON.stringify(i.charCb,null,4)));if(J(i)&&i.reportProgressFunc&&"function"!=typeof i.reportProgressFunc)throw new Error("codsen-tokenizer: [THROW_ID_06] the opts.reportProgressFunc, callback function, should be a function but it was given as type ".concat(t(i.reportProgressFunc),", equal to ").concat(JSON.stringify(i.reportProgressFunc,null,4)));if(J(i)&&i.errCb&&"function"!=typeof i.errCb)throw new Error("codsen-tokenizer: [THROW_ID_07] the opts.errCb, callback function, should be a function but it was given as type ".concat(t(i.errCb),", equal to ").concat(JSON.stringify(i.errCb,null,4)));var u,d=Object.assign({},{reportProgressFunc:null,reportProgressFuncFrom:0,reportProgressFuncTo:100,tagCb:null,charCb:null,errCb:null},i),f=[],p=[],h=!1,w={},k=["tag","comment"],A=["doctype"];return function(t,e){if(!S(t))throw void 0===t?new Error("codsen-tokenizer: [THROW_ID_01] the first input argument is completely missing! It should be given as string."):new Error(`codsen-tokenizer: [THROW_ID_02] the first input argument must be string! It was given as "${typeof t}", equal to:\n${JSON.stringify(t,null,4)}`);if(e&&!$(e))throw new Error(`codsen-tokenizer: [THROW_ID_03] the second input argument, an options object, should be a plain object but it was given as type ${typeof e}, equal to ${JSON.stringify(e,null,4)}`);if($(e)&&e.tagCb&&"function"!=typeof e.tagCb)throw new Error(`codsen-tokenizer: [THROW_ID_04] the opts.tagCb, callback function, should be a function but it was given as type ${typeof e.tagCb}, equal to ${JSON.stringify(e.tagCb,null,4)}`);if($(e)&&e.charCb&&"function"!=typeof e.charCb)throw new Error(`codsen-tokenizer: [THROW_ID_05] the opts.charCb, callback function, should be a function but it was given as type ${typeof e.charCb}, equal to ${JSON.stringify(e.charCb,null,4)}`);if($(e)&&e.reportProgressFunc&&"function"!=typeof e.reportProgressFunc)throw new Error(`codsen-tokenizer: [THROW_ID_06] the opts.reportProgressFunc, callback function, should be a function but it was given as type ${typeof e.reportProgressFunc}, equal to ${JSON.stringify(e.reportProgressFunc,null,4)}`);const n=Object.assign({},{tagCb:null,tagCbLookahead:0,charCb:null,charCbLookahead:0,reportProgressFunc:null,reportProgressFuncFrom:0,reportProgressFuncTo:100},e);let o,r=0;const a=t.length,i=Math.floor(a/2);let u,m=!1;const d=[],f=[];let p={};const h={type:null,start:null,end:null};function w(){return p=s(h),_(),p}let k={};const A={attribName:null,attribNameRecognised:null,attribNameStartsAt:null,attribNameEndsAt:null,attribOpeningQuoteAt:null,attribClosingQuoteAt:null,attribValue:null,attribValueStartsAt:null,attribValueEndsAt:null,attribStart:null,attribEnd:null};function _(){k=s(A)}let R;w(),_();let D=[];function J(t,e,n){if(!D.length)return!1;const o=n?D[0]:D[D.length-1];if("simple"===o.type)return!o.value||t[e]===I(o.value);if("esp"===o.type){if(!x.includes(t[e]))return!1;let n="";const r=t.length;for(let o=e;o<r&&x.includes(t[o]);o++)n+=t[o];if(n&&o.openingLump&&n.length>o.guessedClosingLump.length){if(n.endsWith(o.openingLump))return n.length-o.openingLump.length;let t=new Set(o.guessedClosingLump),e=0;for(let o=0,r=n.length;o<r;o++){if(!t.has(n[o])&&e>1)return o;t.has(n[o])&&(e++,t=new Set([...t].filter(t=>t!==n[o])))}}else if(o.guessedClosingLump.split("").every(t=>n.includes(t)))return n.length}}function W(t,e){return J(t,e,!0)}function q(t,e,n){const o=t.shift(),r=[];for(let e=0;e<n&&t[e];e++)r.push(s(t[e]));e(o,r)}function z(t){n.tagCb&&(d.push(t),d.length>n.tagCbLookahead&&q(d,n.tagCb,n.tagCbLookahead))}function V(e,n){if(!["text","esp"].includes(e.type)&&null!==e.start&&e.start<n&&(t[n-1]&&!t[n-1].trim().length||"<"===t[n]))if(e.end=c(t,n)+1,e.value=t.slice(e.start,e.end),"tag"===e.type&&">"!==t[e.end-1]){let o=e.tagNameEndsAt||n;if(Array.isArray(e.attribs)&&e.attribs.length)for(let n=0,r=e.attribs.length;n<r;n++){if(!e.attribs[n].attribNameRecognised){e.attribs=0===n?[]:e.attribs.splice(0,n);break}o=e.attribs[n].attribEnd,t[o]&&t[o+1]&&!t[o].trim().length&&t[o+1].trim().length&&o++}e.end=o,e.value=t.slice(e.start,e.end),e.tagNameEndsAt||(e.tagNameEndsAt=o),Number.isInteger(e.tagNameStartsAt)&&Number.isInteger(e.tagNameEndsAt)&&!e.tagName&&(e.tagName=t.slice(e.tagNameStartsAt,o),e.recognised=T(e.tagName)),z(e),e=w(),H("text",o)}else z(e),e=w(),t[n-1]&&!t[n-1].trim().length&&H("text",c(t,n)+1);null!==e.start&&(null===e.end&&e.start!==n&&(e.end=n,e.value=t.slice(e.start,e.end)),null!==e.start&&null!==e.end&&z(e),e=w())}function H(t,e){_(),"tag"===t?(p.type=t,p.start=e,p.end=null,p.value=null,p.tagNameStartsAt=null,p.tagNameEndsAt=null,p.tagName=null,p.recognised=null,p.closing=!1,p.void=!1,p.pureHTML=!0,p.esp=[],p.kind=null,p.attribs=[]):"comment"===t?(p.type=t,p.start=e,p.end=null,p.value=null,p.kind="simple",p.closing=!1):"rule"===t?(p.type=t,p.start=e,p.end=null,p.value=null,p.openingCurlyAt=null,p.closingCurlyAt=null,p.selectorsStart=null,p.selectorsEnd=null,p.selectors=[]):"at"===t?(p.type=t,p.start=e,p.end=null,p.value=null,p.identifier=null,p.identifierStartsAt=null,p.identifierEndsAt=null,p.query=null,p.queryStartsAt=null,p.queryEndsAt=null,p.openingCurlyAt=null,p.closingCurlyAt=null):"text"===t?(p.type=t,p.start=e,p.end=null,p.value=null):"esp"===t&&(p.type=t,p.start=e,p.end=null,p.value=null,p.head=null,p.tail=null,p.kind=null)}for(let e=0;e<=a;e++){if(!u&&t[e]&&n.reportProgressFunc&&(a>1e3&&a<2e3?e===i&&n.reportProgressFunc(Math.floor((n.reportProgressFuncTo-n.reportProgressFuncFrom)/2)):a>=2e3&&(o=n.reportProgressFuncFrom+Math.floor(e/a*(n.reportProgressFuncTo-n.reportProgressFuncFrom)),o!==r&&(r=o,n.reportProgressFunc(o)))),m&&p.type&&!["rule","at","text"].includes(p.type)&&(m=!1),Number.isInteger(u)&&e>=u&&(u=!1),!u&&D.length&&"at"===D[D.length-1].type&&$(D[D.length-1].token)&&Number.isInteger(D[D.length-1].token.openingCurlyAt)&&!Number.isInteger(D[D.length-1].token.closingCurlyAt))if("}"===t[e]){if(null===p.type||"text"===p.type||"rule"===p.type&&null===p.openingCurlyAt){"rule"===p.type&&(p.end=c(t,e)+1,p.value=t.slice(p.start,p.end),z(p),p=w(),c(t,e)<e-1&&H("text",c(t,e)+1)),V(p,e);const n=D.pop();p=n.token,p.closingCurlyAt=e,p.end=e+1,p.value=t.slice(p.start,p.end),z(p),p=w(),u=e+1}}else"text"===p.type&&t[e]&&t[e].trim().length&&(p.end=e,p.value=t.slice(p.start,p.end),z(p),p=w());if(p.end&&p.end===e&&("style"!==p.tagName||p.closing||(m=!0),V(p,e),D=[]),u||(["tag","esp","rule","at"].includes(p.type)&&"cdata"!==p.kind?!['"',"'","(",")"].includes(t[e])||['"',"'"].includes(t[c(t,e)])&&t[c(t,e)]===t[l(t,e)]||(J(t,e)?D.pop():D.push({type:"simple",value:t[e],position:e})):"comment"===p.type&&["only","not"].includes(p.kind)&&["[","]"].includes(t[e])&&(J(t,e)?D.pop():D.push({type:"simple",value:t[e],position:e}))),!u&&"at"===p.type&&Number.isInteger(p.start)&&e>=p.start&&!Number.isInteger(p.identifierStartsAt)&&t[e]&&t[e].trim().length&&"@"!==t[e]&&(p.identifierStartsAt=e),!u&&"at"===p.type&&Number.isInteger(p.queryStartsAt)&&!Number.isInteger(p.queryEndsAt)&&"{};".includes(t[e])&&(t[e-1]&&t[e-1].trim().length?p.queryEndsAt=e:p.queryEndsAt=c(t,e)+1,p.query=t.slice(p.queryStartsAt,p.queryEndsAt)),!u&&"at"===p.type&&"{"===t[e]&&p.identifier&&!Number.isInteger(p.openingCurlyAt)){p.openingCurlyAt=e,D.push({type:"at",token:p});const n=l(t,e);"}"===t[n]?(p.closingCurlyAt=n,z(p),u=n):(w(),n>e+1&&(H("text",e+1),p.end=n,p.value=t.slice(p.start,p.end),z(p)),w(),H("rule",n),u=n)}if(!u&&"at"===p.type&&p.identifier&&t[e]&&t[e].trim().length&&!Number.isInteger(p.queryStartsAt)&&(p.queryStartsAt=e),!u&&"at"===p.type&&Number.isInteger(p.identifierStartsAt)&&e>=p.start&&t[e]&&(!t[e].trim().length||"()".includes(t[e]))&&!Number.isInteger(p.identifierEndsAt)&&(p.identifierEndsAt=e,p.identifier=t.slice(p.identifierStartsAt,e)),"rule"===p.type&&Number.isInteger(R)&&(L.includes(t[e])||t[e]&&!t[e].trim().length&&L.includes(t[l(t,e)]))&&(p.selectors.push({value:t.slice(R,e),selectorStarts:R,selectorEnds:e}),R=void 0,p.selectorsEnd=e),!u)if(F(t,e,p,D))p.type&&null!==p.start&&(V(p,e),w()),H("tag",e),m&&(m=!1),O(t,e,"doctype",{i:!0,trimCharsBeforeMatching:["?","!","["," ","-"]})?p.kind="doctype":O(t,e,"cdata",{i:!0,trimCharsBeforeMatching:["?","!","["," ","-"]})?p.kind="cdata":O(t,e,"xml",{i:!0,trimCharsBeforeMatching:["?","!","["," ","-"]})&&(p.kind="xml");else if(N(t,e,p))Number.isInteger(p.start)&&V(p,e),w(),H("comment",e),"-"===t[e]?p.closing=!0:v(t,e,["<![endif]--\x3e"],{trimBeforeMatching:!0,maxMismatches:2})&&(p.closing=!0,p.kind="only"),m&&(m=!1);else if(P(t,e,p,0,m)){let n="";for(let o=e;o<a&&x.includes(t[o]);o++)n+=t[o];if(!(C.includes(n)||Array.isArray(D)&&D.length&&"simple"===D[D.length-1].type&&D[D.length-1].value===t[e+n.length])){let o;D.length&&J(t,e)?(o=J(t,e),"esp"===p.type&&(Number.isInteger(p.end)||(p.end=e+o,p.value=t.slice(p.start,p.end)),V(p,e),w()),D.pop()):D.length&&W(t,e)?(o=W(t,e),"esp"===p.type&&(Number.isInteger(p.end)||(p.end=e+o,p.value=t.slice(p.start,p.end)),V(p,e),w()),D=[]):(D.push({type:"esp",openingLump:n,guessedClosingLump:I(n),position:e}),"tag"===p.type&&("comment"===p.kind||Number.isInteger(k.attribStart)&&!Number.isInteger(k.attribEnd))||(V(p,e),H("esp",e),p.tail=I(n),p.head=n)),u=e+(o||n.length)}}else if(null===p.start||p.end===e)if(m)if(t[e]&&!t[e].trim().length){if(w(),H("text",e),p.end=l(t,e)||t.length,p.value=t.slice(p.start,p.end),z(p),u=p.end,w(),l(t,e)&&!["{","}","<"].includes(t[l(t,e)])){const n=l(t,e);H("@"===t[n]?"at":"rule",n),t[e+1]&&!t[e+1].trim().length&&(u=l(t,e))}}else t[e]&&(w(),"}".includes(t[e])?(H("text",e),u=e+1):H("@"===t[e]?"at":"rule",e));else t[e]&&(p=w(),H("text",e));else"text"===p.type&&m&&t[e]&&t[e].trim().length&&!"{},".includes(t[e])&&(V(p,e),w(),H("rule",e));if(u||"rule"!==p.type||!t[e]||!t[e].trim().length||"{}".includes(t[e])||Number.isInteger(R)||Number.isInteger(p.openingCurlyAt)||(",".includes(t[e])?p.selectorsEnd=e+1:(R=e,null===p.selectorsStart&&(p.selectorsStart=e))),"comment"===p.type&&["only","not"].includes(p.kind)&&t[e],!u)if("tag"!==p.type||D.length||">"!==t[e])if("comment"===p.type&&!D.length&&"simple"===p.kind&&("<"===t[p.start]&&"-"===t[e]&&(y(t,e,"!-",{trimBeforeMatching:!0})||b(t,e,"!-",{trimBeforeMatching:!0})&&"-"!==t[e+1])||"-"===t[p.start]&&">"===t[e]&&y(t,e,"--",{trimBeforeMatching:!0,maxMismatches:1})))"-"===t[e]&&(O(t,e,["[if","(if","{if"],{trimBeforeMatching:!0})||O(t,e,["if"],{trimBeforeMatching:!0})&&M(t,e,"]",">"))?p.kind="only":"-"!==t[p.start]&&v(t,e,["-<![endif"],{trimBeforeMatching:!0,maxMismatches:2})?(p.kind="not",p.closing=!0):(p.end=e+1,"!"===t[c(t,e)]&&"-"===t[l(t,e)]&&(p.end=l(t,e)+1),p.value=t.slice(p.start,p.end));else if("comment"!==p.type||">"!==t[e]||D.length&&"<"!==t[l(t,e)]){if("esp"===p.type&&null===p.end&&S(p.tail)&&p.tail.includes(t[e])){let n="";for(let o=e;o<a&&x.includes(t[o]);o++)n+=t[o];if(n.length>p.head.length){const o=p.head[0];if(n.endsWith(p.head))p.end=e+n.length-p.head.length,p.value=t.slice(p.start,p.end),u=p.end;else if(n.startsWith(p.tail))p.end=e+p.tail.length,p.value=t.slice(p.start,p.end),u=p.end;else if(!p.tail.includes(o)&&n.includes(o)||n.endsWith(p.head)||n.startsWith(p.tail)){const r=n.slice(0,n.indexOf(o)),a=n.slice(n.indexOf(o));r.length&&a.length&&p.tail.split("").every(t=>r.includes(t))&&(p.end=e+r.length,p.value=t.slice(p.start,p.end),u=p.end)}else p.end=e+n.length,p.value=t.slice(p.start,p.end),u=p.end}else p.end=e+n.length,p.value=t.slice(p.start,p.end),u=p.end}}else Array.isArray(D)&&D.length&&"["===D[D.length-1].value&&D.pop(),O(t,e,["\x3c!--\x3e"],{trimBeforeMatching:!0,maxMismatches:1,lastMustMatch:!0})?p.kind="not":(p.end=e+1,p.value=t.slice(p.start,p.end));else p.end=e+1,p.value=t.slice(p.start,p.end);if(u||"tag"!==p.type||!Number.isInteger(p.tagNameStartsAt)||Number.isInteger(p.tagNameEndsAt)||t[e]&&(G=t[e],/[.\-_a-z0-9\u00B7\u00C0-\uFFFD]/i.test(G))||(p.tagNameEndsAt=e,p.tagName=t.slice(p.tagNameStartsAt,e).toLowerCase(),"xml"===p.tagName&&p.closing&&!p.kind&&(p.kind="xml"),B.includes(p.tagName)&&(p.void=!0),p.recognised=T(p.tagName)),!u&&"tag"===p.type&&!Number.isInteger(p.tagNameStartsAt)&&Number.isInteger(p.start)&&(p.start<e||"<"!==t[p.start])&&("/"===t[e]?p.closing=!0:E(t[e])&&(p.tagNameStartsAt=e,p.closing||(p.closing=!1))),!u&&"tag"===p.type&&"cdata"!==p.kind&&Number.isInteger(k.attribNameStartsAt)&&e>k.attribNameStartsAt&&null===k.attribNameEndsAt&&!j(t[e])&&(k.attribNameEndsAt=e,k.attribName=t.slice(k.attribNameStartsAt,e),k.attribNameRecognised=g.includes(k.attribName),t[e]&&!t[e].trim().length&&"="===t[l(t,e)]||(t[e]&&!t[e].trim().length||">"===t[e]||"/"===t[e]&&">"===t[l(t,e)])&&(k.attribEnd=e,p.attribs.push(s(k)),_())),!u&&t[e]&&"tag"===p.type&&"cdata"!==p.kind&&Number.isInteger(p.tagNameEndsAt)&&e>p.tagNameEndsAt&&null===k.attribStart&&j(t[e])&&(k.attribStart=e,k.attribNameStartsAt=e),u||"rule"!==p.type||("{"!==t[e]||Number.isInteger(p.openingCurlyAt)?"}"===t[e]&&Number.isInteger(p.openingCurlyAt)&&!Number.isInteger(p.closingCurlyAt)&&(p.closingCurlyAt=e,p.end=e+1,p.value=t.slice(p.start,p.end),z(p),w()):p.openingCurlyAt=e),!u&&"tag"===p.type&&Number.isInteger(k.attribValueStartsAt)&&e>=k.attribValueStartsAt&&null===k.attribValueEndsAt)if("'\"".includes(t[e]))t[c(t,e)]!==t[e]||`/>${x}`.includes(t[l(t,e)])||M(t,e,"=",'"')||M(t,e,"=","'")||!M(t,e,'"',">")&&!M(t,e,"'",">")||t.slice(e+1).includes("<")&&t.slice(0,t.indexOf("<")).includes("=")?((null===k.attribOpeningQuoteAt||t[k.attribOpeningQuoteAt]===t[e])&&!D.some(t=>"esp"===t.type)||"'\"".includes(t[k.attribOpeningQuoteAt])&&!M(t,e,t[k.attribOpeningQuoteAt],"="))&&(k.attribClosingQuoteAt=e,k.attribValueEndsAt=e,Number.isInteger(k.attribValueStartsAt)&&(k.attribValue=t.slice(k.attribValueStartsAt,e)),k.attribEnd=e+1,t[k.attribOpeningQuoteAt]!==t[e]&&(D.pop(),D.pop()),p.attribs.push(s(k)),_()):(k.attribOpeningQuoteAt=e,k.attribValueStartsAt=e+1,D.push({type:"simple",value:t[e],position:e}));else if(null===k.attribOpeningQuoteAt&&(t[e]&&!t[e].trim().length||["/",">"].includes(t[e])||x.includes(t[e])&&x.includes(t[e+1])))k.attribValueEndsAt=e,k.attribValue=t.slice(k.attribValueStartsAt,e),k.attribEnd=e,p.attribs.push(s(k)),_(),D.pop();else if("="===t[e]&&"'\"".includes(t[l(t,e)])){let n,o;for(let r=c(t,e);r>=k.attribValueStartsAt;r--){if(!n&&t[r]&&!t[r].trim().length&&(n=!0,o)){t.slice(r,o)}n&&t[r]&&t[r].trim().length&&(n=!1,o||(o=r+1))}if(o){k.attribValueEndsAt=o,Number.isInteger(k.attribValueStartsAt)&&(k.attribValue=t.slice(k.attribValueStartsAt,o)),k.attribEnd=o,t[k.attribOpeningQuoteAt]!==t[e]&&D.pop(),p.attribs.push(s(k)),_(),e=o-1;continue}}if(!u&&"tag"===p.type&&!Number.isInteger(k.attribValueStartsAt)&&Number.isInteger(k.attribNameEndsAt)&&k.attribNameEndsAt<=e&&t[e]&&t[e].trim().length&&("="!==t[e]||"'\"=".includes(t[l(t,e)])||x.includes(t[l(t,e)])?"'\"".includes(t[e])&&(k.attribOpeningQuoteAt=e,t[e+1]&&(k.attribValueStartsAt=e+1)):(k.attribValueStartsAt=l(t,e),D.push({type:"simple",value:null,position:k.attribValueStartsAt}))),">"===t[e]&&"tag"===p.type&&null!==k.attribStart&&null===k.attribEnd){let n=!1;if(t[e+1])for(let o=e+1;o<a;o++){if(null!==k.attribOpeningQuoteAt&&t[o]===t[k.attribOpeningQuoteAt]){o!==e+1&&"="!==t[o-1]&&(n=!0);break}if(">"===t[o])break;if("<"===t[o]){n=!0,D.pop();break}if(!t[o+1]){n=!0;break}}else n=!0;n&&(p.end=e+1,p.value=t.slice(p.start,p.end),Number.isInteger(k.attribValueStartsAt)&&e&&k.attribValueStartsAt<e&&t.slice(k.attribValueStartsAt,e).trim().length?(k.attribValueEndsAt=e,k.attribValue=t.slice(k.attribValueStartsAt,e)):k.attribValueStartsAt=null,k.attribEnd=e,p.attribs.push(s(k)),_())}t[e]&&n.charCb&&(U={type:p.type,chr:t[e],i:e},n.charCb&&(f.push(U),f.length>n.charCbLookahead&&q(f,n.charCb,n.charCbLookahead))),t[e]||null===p.start||(p.end=e,p.value=t.slice(p.start,p.end),z(p))}var U,G;if(f.length)for(let t=0,e=f.length;t<e;t++)q(f,n.charCb,n.charCbLookahead);if(d.length)for(let t=0,e=d.length;t<e;t++)q(d,n.tagCb,n.tagCbLookahead)}(a,{reportProgressFunc:d.reportProgressFunc,reportProgressFuncFrom:d.reportProgressFuncFrom,reportProgressFuncTo:d.reportProgressFuncTo,tagCbLookahead:2,tagCb:function(t,a){console.log("-".repeat(80)),console.log("247 ██ ".concat("[".concat(33,"m","INCOMING TOKEN","[",39,"m"),":\n",JSON.stringify({type:t.type,tagName:t.tagName,start:t.start,end:t.end,value:t.value,kind:t.kind,closing:t.closing},null,4))),console.log("262 FIY, ".concat("[".concat(33,"m","NEXT","[",39,"m")," = ",JSON.stringify(a,null,4))),console.log("269 FIY, STARTING ".concat("[".concat(33,"m","layers","[",39,"m")," = ",JSON.stringify(f,null,4))),"function"==typeof d.tagCb&&d.tagCb(t);var i=D.get(p,u);if(J(i)||(i=null),console.log("294 FIY, ".concat("[".concat(33,"m","prevToken","[",39,"m")," = ",JSON.stringify(i,null,4))),console.log("301 FIY, ".concat("[".concat(33,"m","lastProcessedToken","[",39,"m")," = ",JSON.stringify(w,null,4))),!h||t.closing||i&&i.tagName===t.tagName&&!i.closing&&t.closing||W(f,t))if(t.closing&&"string"==typeof u&&u.includes(".")&&(!t.tagName||w.tagName!==t.tagName||w.closing))if(console.log("339 ".concat("[".concat(35,"m","██ UP","[",39,"m"))),u=o(r(u)),W(f,t)){for(console.log("344 current token was pending, so we pop() it from layers");f.length&&f[f.length-1].type!==t.type&&f[f.length-1].kind!==t.kind;)f.pop();f.pop(),console.log("362 POP layers, now equals to: ".concat(JSON.stringify(f,null,4))),h=!1,console.log("367 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","nestNext","[",39,"m"),": ",h))}else if(console.log("371 ".concat("[".concat(31,"m",'layer for "'.concat(t.value,'" was not pending!'),"[",39,"m"))),console.log("374 ".concat("[".concat(31,"m","yet this was a closing token","[",39,"m"))),f.length>1&&t.tagName&&t.tagName===f[f.length-2].tagName){if(console.log("385 ".concat("[".concat(32,"m","THIS WAS A GAP","[",39,"m"))),u=o(r(u)),console.log("390 ".concat("[".concat(35,"m","██ UP again","[",39,"m"))),d.errCb){var s=f[f.length-1];console.log("397 ".concat("[".concat(31,"m","██ RAISE ERROR","[",39,"m")," ",s.type).concat("comment"===s.type?"-".concat(s.kind):"","-missing-closing")),d.errCb({ruleId:"".concat(s.type).concat("comment"===s.type?"-".concat(s.kind):"","-missing-closing"),idxFrom:s.start,idxTo:s.end,tokenObj:s})}f.pop(),f.pop(),console.log("422 POP layers twice, now equals to: ".concat(JSON.stringify(f,null,4)))}else if(f.length>2&&f[f.length-3].type===t.type&&f[f.length-3].type===t.type&&f[f.length-3].tagName===t.tagName){if(console.log("443 ".concat("[".concat(32,"m","PREVIOUS TAG WAS ROGUE OPENING","[",39,"m"))),u=o(r(u)),console.log("448 ".concat("[".concat(35,"m","██ UP again","[",39,"m"))),d.errCb){var g=f[f.length-1];console.log("455 ".concat("[".concat(31,"m","██ RAISE ERROR","[",39,"m")," tag-rogue [",g.start,", ").concat(g.end,"]")),d.errCb({ruleId:"tag-rogue",idxFrom:g.start,idxTo:g.end,tokenObj:g})}f.pop(),f.pop(),f.pop()}else if(f.length>1&&f[f.length-2].type===t.type&&f[f.length-2].type===t.type&&f[f.length-2].tagName===t.tagName){if(console.log("488 ".concat("[".concat(32,"m","PREVIOUS TAG WAS ROGUE CLOSING","[",39,"m"))),d.errCb){var b=f[f.length-1];console.log("499 ".concat("[".concat(31,"m","██ RAISE ERROR","[",39,"m")," tag-rogue [",b.start,", ").concat(b.end,"]")),d.errCb({ruleId:"tag-rogue",idxFrom:b.start,idxTo:b.end,tokenObj:b})}f.pop(),f.pop()}else console.log("515 ELSE clauses - TODO");else u?(console.log("531 ".concat("[".concat(35,"m","██ BUMP","[",39,"m"))),u=o(u),W(f,t)&&(f.pop(),console.log("537 POP layers, now equals to: ".concat(JSON.stringify(f,null,4))))):(console.log("526 ".concat("[".concat(35,"m","██ FIRST","[",39,"m"))),u="0");else h=!1,console.log("326 ".concat("[".concat(35,"m","██ NEST","[",39,"m"))),u="".concat(u,".children.0");console.log("".concat("[".concat(90,"m","----------------- path calculations done -----------------","[",39,"m"))),k.includes(t.type)&&!t.void&&Object.prototype.hasOwnProperty.call(t,"closing")&&!t.closing&&(h=!0,console.log("555 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","nestNext","[",39,"m")," = true")),A.includes(t.kind)||(f.push(Object.assign({},t)),console.log("561 ".concat("[".concat(32,"m","PUSH","[",39,"m")," to layers, which is now: ",JSON.stringify(f,null,4))))),console.log("571 FIY, ".concat("[".concat(33,"m","path","[",39,"m")," = ",u));var y,v,O=function(t){if("string"!=typeof t||!t.length)return null;const e=t.slice(t.lastIndexOf(".")+1);return"0"===e?null:t.includes(".")&&/^\d*$/.test(e)?`${t.slice(0,t.lastIndexOf(".")+1)}${+t.slice(t.lastIndexOf(".")+1)-1}`:/^\d*$/.test(t)?`${+t-1}`:null}(u),N=r(u);console.log("586 ".concat("[".concat(33,"m","parentPath","[",39,"m")," = ",JSON.stringify(N,null,4))),N&&u.includes(".")&&(y=D.get(p,N)),console.log("598 ".concat("[".concat(33,"m","parentTagsToken","[",39,"m"),' at path "',"[".concat(33,"m",N,"[",39,"m"),'" - ',JSON.stringify(y?Object.assign({},y,{children:"..."}):y,null,4))),O&&(v=D.get(p,O)),console.log("614 NOW ".concat("[".concat(33,"m","previousTagsToken","[",39,"m"),' at path "',"[".concat(33,"m",O,"[",39,"m"),'" - ',JSON.stringify(v,null,4))),console.log("621 FIY, ".concat("[".concat(33,"m","tokenObj.closing","[",39,"m")," = ",JSON.stringify(t.closing,null,4))),console.log("635 ".concat("[".concat(33,"m","res","[",39,"m")," BEFORE: ",JSON.stringify(p,null,4)));var _,x,C=/(-+|-+[^>])>/;J(v)&&Array.isArray(v.children)&&v.children.length&&v.children[v.children.length-1]&&(_=v.children[v.children.length-1],x="".concat(O,".children.").concat(D.get(p,O).children.length-1));var S=!1;if(console.log("663 FIY, ".concat("[".concat(33,"m","layers","[",39,"m")," = ",JSON.stringify(f,null,4))),"text"===t.type&&J(y)&&"comment"===y.type&&"simple"===y.kind&&!y.closing&&C.test(t.value)){console.log("678 ".concat("[".concat(31,"m","██ intervention needed","[",39,"m")));var E=C.exec(t.value).index,j=E+t.value.slice(E).indexOf(">")+1;console.log("688 SUSPICIOUS ENDING: [".concat("[".concat(33,"m","suspiciousEndingStartsAt","[",39,"m")," = ",JSON.stringify(E,null,4),", ","[".concat(33,"m","suspiciousEndingEndsAt","[",39,"m")," = ").concat(JSON.stringify(j,null,4),'] - value: "').concat(t.value.slice(E,j),'"')),E>0&&(console.log("707 ".concat("[".concat(32,"m","ADD","[",39,"m"),' text leading up to "->"')),console.log("710 ".concat("[".concat(33,"m","res","[",39,"m")," BEFORE: ",JSON.stringify(p,null,4))),D.set(p,u,Object.assign({},t,{end:t.start+E,value:t.value.slice(0,E)})),k.includes(t.type)&&(t.children=[]),console.log("728 ".concat("[".concat(33,"m","res","[",39,"m")," AFTER: ",JSON.stringify(p,null,4)))),console.log("739 OLD ".concat("[".concat(33,"m","path","[",39,"m")," = ",u)),u=o(r(u)),console.log("743 NEW ".concat("[".concat(33,"m","path","[",39,"m")," = ",u)),D.set(p,u,{type:"comment",kind:"simple",closing:!0,start:t.start+E,end:t.start+j,value:t.value.slice(E,j),children:[]}),console.log("758 ".concat("[".concat(33,"m","res","[",39,"m")," AFTER: ",JSON.stringify(p,null,4))),j<t.value.length&&(console.log("769 OLD ".concat("[".concat(33,"m","path","[",39,"m")," = ",u)),u=o(u),console.log("773 NEW ".concat("[".concat(33,"m","path","[",39,"m")," = ",u)),D.set(p,u,{type:"text",start:t.start+j,end:t.end,value:t.value.slice(j)}),console.log("782 ".concat("[".concat(33,"m","res","[",39,"m")," AFTER: ",JSON.stringify(p,null,4)))),S=!0}else if("comment"===t.type&&"only"===t.kind&&J(v))if(console.log("800 ".concat("[".concat(31,"m","██ intervention needed","[",39,"m"))),"text"===v.type&&v.value.trim().length&&"<!-".includes(v.value[c(v.value,v.value.length)])){console.log("821 ".concat("[".concat(31,"m",'MALFORMED "NOT" COMMENT',"[",39,"m")));var I=[];if(m(v.value,"\x3c!--",(function(t){I.push(t)}),{maxDistance:2}),console.log("841 ".concat("[".concat(33,"m","capturedMalformedTagRanges","[",39,"m")," = ",JSON.stringify(I,null,4))),I.length&&!l(v.value,I[I.length-1].idxTo-1)){console.log("855 picking the last malformed range");var T=I.pop();console.log("861 ".concat("[".concat(33,"m","malformedRange","[",39,"m")," = ",JSON.stringify(T,null,4))),!c(v.value,T.idxFrom)&&O&&J(v)?(console.log("877 whole token is malformed \x3c!--"),k.includes(t.type)&&(t.children=[]),u=O,D.set(p,u,Object.assign({},t,{start:T.idxFrom+v.start,kind:"not",value:"".concat(v.value).concat(t.value)})),S=!0):O&&J(v)&&(console.log("900 there are characters in front of \x3c!--"),D.set(p,O,Object.assign({},v,{end:T.idxFrom+v.start,value:v.value.slice(0,T.idxFrom)})),k.includes(t.type)&&(t.children=[]),D.set(p,u,Object.assign({},t,{start:T.idxFrom+v.start,kind:"not",value:"".concat(v.value.slice(T.idxFrom)).concat(t.value)})),S=!0)}}else if(J(_)&&"text"===_.type&&_.value.trim().length&&"<!-".includes(_.value[c(_.value,_.value.length)])){console.log("955 ".concat("[".concat(31,"m",'MALFORMED "NOT" COMMENT',"[",39,"m")));var M=[];if(m(_.value,"\x3c!--",(function(t){M.push(t)}),{maxDistance:2}),console.log("975 ".concat("[".concat(33,"m","capturedMalformedTagRanges","[",39,"m")," = ",JSON.stringify(M,null,4))),M.length&&!l(_.value,M[M.length-1].idxTo-1)){console.log("989 picking the last malformed range");var R=M.pop();console.log("995 ".concat("[".concat(33,"m","malformedRange","[",39,"m")," = ",JSON.stringify(R,null,4))),!c(_.value,R.idxFrom)&&O&&J(_)?(console.log("1011 whole token is malformed \x3c!--"),k.includes(t.type)&&(t.children=[]),D.set(p,u,Object.assign({},t,{start:R.idxFrom+_.start,kind:"not",value:"".concat(_.value).concat(t.value)})),console.log("1035 ██ ".concat("[".concat(33,"m","previousPath","[",39,"m")," = ",JSON.stringify(O,null,4))),console.log("1042 DELETING TEXT NODE - RES BEFORE: ".concat(JSON.stringify(p,null,4))),D.del(p,"".concat(O,".children.").concat(D.get(p,O).children.length-1)),console.log("1055 DELETING TEXT NODE - RES AFTER: ".concat(JSON.stringify(p,null,4))),S=!0):O&&J(_)&&x&&(console.log("1069 there are characters preceding \x3c!--"),console.log("1074 FIY, ".concat("[".concat(33,"m","parentsLastChildTokenPath","[",39,"m")," = ",JSON.stringify(x,null,4))),D.set(p,x,Object.assign({},_,{end:R.idxFrom+_.start,value:_.value.slice(0,R.idxFrom)})),k.includes(t.type)&&(t.children=[]),D.set(p,u,Object.assign({},t,{start:R.idxFrom+_.start,kind:"not",value:"".concat(_.value.slice(R.idxFrom)).concat(t.value)})),S=!0)}}console.log("1119 ███████████████████████████████████████"),console.log("1121 FIY, ".concat("[".concat(33,"m","next","[",39,"m")," = ",JSON.stringify(a,null,4))),console.log("1128 FIY, ".concat("[".concat(33,"m","layers","[",39,"m")," = ",JSON.stringify(f,null,4))),S||(console.log("1137 setting as usual"),k.includes(t.type)&&(t.children=[]),D.set(p,u,t)),console.log("1145 ".concat("[".concat(33,"m","res","[",39,"m")," AFTER: ",JSON.stringify(p,null,4))),console.log("1153 ENDING ".concat("[".concat(33,"m","path","[",39,"m")," = ",JSON.stringify(u,null,4))),!k.includes(t.type)||!t.closing||O&&J(v)&&!v.closing&&v.type===t.type&&v.tagName===t.tagName||(t.void?(console.log("1175 frontal slash must be removed because it's a void tag"),d.errCb&&(console.log("1179 ".concat("[".concat(31,"m","██ RAISE ERROR tag-void-frontal-slash","[",39,"m"))),d.errCb({ruleId:"tag-void-frontal-slash",idxFrom:t.start,idxTo:t.end,fix:{ranges:[[t.start+1,t.tagNameStartsAt]]},tokenObj:t}))):(console.log("1190 it's an unpaired tag"),d.errCb&&(console.log("1193 ".concat("[".concat(31,"m","██ RAISE ERROR","[",39,"m")," ",t.type).concat("comment"===t.type?"-".concat(t.kind):"","-missing-opening")),d.errCb({ruleId:"".concat(t.type).concat("comment"===t.type?"-".concat(t.kind):"","-missing-opening"),idxFrom:t.start,idxTo:t.end,tokenObj:t})))),w=function(t){for(var o=1;o<arguments.length;o++){var r=null!=arguments[o]?arguments[o]:{};o%2?n(Object(r),!0).forEach((function(n){e(t,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},t),console.log("".concat("[".concat(90,"m","---","[",39,"m"))),console.log("".concat("[".concat(90,"m","██ nestNext = ".concat("[".concat(h?32:31,"m").concat(h,"[",39,"m")),"[",39,"m"))),console.log("".concat("[".concat(90,"m","██ layers = ".concat(JSON.stringify(f,null,4)),"[",39,"m")))},charCb:d.charCb}),console.log("-".repeat(80)),console.log("1254 FIY, ENDING ".concat("[".concat(33,"m","layers","[",39,"m")," = ",JSON.stringify(f,null,4))),f.length&&f.forEach((function(t){d.errCb&&(console.log("1265 ".concat("[".concat(31,"m","██ RAISE ERROR","[",39,"m")," ",t.type).concat("comment"===t.type?"-".concat(t.kind):"","-missing-closing")),d.errCb({ruleId:"".concat(t.type).concat("comment"===t.type?"-".concat(t.kind):"","-missing-closing"),idxFrom:t.start,idxTo:t.end,tokenObj:t}))})),console.log("1284 ".concat("[".concat(32,"m","FINAL RETURN","[",39,"m")," ",JSON.stringify(p,null,4))),p}}));
