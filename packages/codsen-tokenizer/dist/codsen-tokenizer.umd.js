/**
 * codsen-tokenizer
 * Tokenizer for mixed inputs aiming at broken code, especially HTML & CSS
 * Version: 2.4.0
 * Author: Roy Revelt, Codsen Ltd
 * License: MIT
 * Homepage: https://gitlab.com/codsen/codsen/tree/master/packages/codsen-tokenizer
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).codsenTokenizer=e()}(this,(function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}var e=["abbr","accept","accept-charset","accesskey","action","align","alink","allow","alt","archive","async","autocapitalize","autocomplete","autofocus","autoplay","axis","background","background-attachment","background-color","background-image","background-position","background-position-x","background-position-y","background-repeat","bgcolor","border","border-bottom","border-bottom-color","border-bottom-style","border-bottom-width","border-collapse","border-color","border-left","border-left-color","border-left-style","border-left-width","border-right","border-right-color","border-right-style","border-right-width","border-style","border-top","border-top-color","border-top-style","border-top-width","border-width","buffered","capture","cellpadding","cellspacing","challenge","char","charoff","charset","checked","cite","class","classid","clear","clip","code","codebase","codetype","color","cols","colspan","column-span","compact","content","contenteditable","contextmenu","controls","coords","crossorigin","csp","cursor","data","data-*","datetime","declare","decoding","default","defer","dir","direction","dirname","disabled","display","download","draggable","dropzone","enctype","enterkeyhint","face","filter","float","font","font-color","font-emphasize","font-emphasize-position","font-emphasize-style","font-family","font-size","font-style","font-variant","font-weight","for","form","formaction","formenctype","formmethod","formnovalidate","formtarget","frame","frameborder","headers","height","hidden","high","horiz-align","href","hreflang","hspace","http-equiv","icon","id","importance","inputmode","integrity","intrinsicsize","ismap","itemprop","keytype","kind","label","lang","language","layout-flow","layout-grid","layout-grid-char","layout-grid-line","layout-grid-mode","layout-grid-type","left","letter-spacing","line-break","line-height","link","list","list-image-1","list-image-2","list-image-3","list-style","list-style-image","list-style-position","list-style-type","loading","longdesc","loop","low","manifest","margin","margin-bottom","margin-left","margin-right","margin-top","marginheight","marginwidth","max","maxlength","media","method","min","minlength","mso-ansi-font-size","mso-ansi-font-style","mso-ansi-font-weight","mso-ansi-language","mso-ascii-font-family","mso-background","mso-background-source","mso-baseline-position","mso-bidi-flag","mso-bidi-font-family","mso-bidi-font-size","mso-bidi-font-style","mso-bidi-font-weight","mso-bidi-language","mso-bookmark","mso-border-alt","mso-border-between","mso-border-between-color","mso-border-between-style","mso-border-between-width","mso-border-bottom-alt","mso-border-bottom-color-alt","mso-border-bottom-source","mso-border-bottom-style-alt","mso-border-bottom-width-alt","mso-border-color-alt","mso-border-effect","mso-border-left-alt","mso-border-left-color-alt","mso-border-left-source","mso-border-left-style-alt","mso-border-left-width-alt","mso-border-right-alt","mso-border-right-color-alt","mso-border-right-source","mso-border-right-style-alt","mso-border-right-width-alt","mso-border-shadow","mso-border-source","mso-border-style-alt","mso-border-top-alt","mso-border-top-color-alt","mso-border-top-source","mso-border-top-style-alt","mso-border-top-width-alt","mso-border-width-alt","mso-break-type","mso-build","mso-build-after-action","mso-build-after-color","mso-build-auto-secs","mso-build-avi","mso-build-dual-id","mso-build-order","mso-build-sound-name","mso-bullet-image","mso-cell-special","mso-cellspacing","mso-char-indent","mso-char-indent-count","mso-char-indent-size","mso-char-type","mso-char-wrap","mso-color-alt","mso-color-index","mso-color-source","mso-column-break-before","mso-column-separator","mso-columns","mso-comment-author","mso-comment-continuation","mso-comment-id","mso-comment-reference","mso-data-placement","mso-default-height","mso-default-width","mso-diagonal-down","mso-diagonal-down-color","mso-diagonal-down-source","mso-diagonal-down-style","mso-diagonal-down-width","mso-diagonal-up","mso-diagonal-up-color","mso-diagonal-up-source","mso-diagonal-up-style","mso-diagonal-up-width","mso-displayed-decimal-separator","mso-displayed-thousand-separator","mso-element","mso-element-anchor-horizontal","mso-element-anchor-lock","mso-element-anchor-vertical","mso-element-frame-height","mso-element-frame-hspace","mso-element-frame-vspace","mso-element-frame-width","mso-element-left","mso-element-linespan","mso-element-top","mso-element-wrap","mso-endnote-continuation-notice","mso-endnote-continuation-notice-id","mso-endnote-continuation-notice-src","mso-endnote-continuation-separator","mso-endnote-continuation-separator-id","mso-endnote-continuation-separator-src","mso-endnote-display","mso-endnote-id","mso-endnote-numbering","mso-endnote-numbering-restart","mso-endnote-numbering-start","mso-endnote-numbering-style","mso-endnote-position","mso-endnote-separator","mso-endnote-separator-id","mso-endnote-separator-src","mso-even-footer","mso-even-footer-id","mso-even-footer-src","mso-even-header","mso-even-header-id","mso-even-header-src","mso-facing-pages","mso-fareast-font-family","mso-fareast-hint","mso-fareast-language","mso-field-change","mso-field-change-author","mso-field-change-time","mso-field-change-value","mso-field-code","mso-field-lock","mso-fills-color","mso-first-footer","mso-first-footer-id","mso-first-footer-src","mso-first-header","mso-first-header-id","mso-first-header-src","mso-font-alt","mso-font-charset","mso-font-format","mso-font-info","mso-font-info-charset","mso-font-info-type","mso-font-kerning","mso-font-pitch","mso-font-signature","mso-font-signature-csb-one","mso-font-signature-csb-two","mso-font-signature-usb-four","mso-font-signature-usb-one","mso-font-signature-usb-three","mso-font-signature-usb-two","mso-font-src","mso-font-width","mso-footer","mso-footer-data","mso-footer-id","mso-footer-margin","mso-footer-src","mso-footnote-continuation-notice","mso-footnote-continuation-notice-id","mso-footnote-continuation-notice-src","mso-footnote-continuation-separator","mso-footnote-continuation-separator-id","mso-footnote-continuation-separator-src","mso-footnote-id","mso-footnote-numbering","mso-footnote-numbering-restart","mso-footnote-numbering-start","mso-footnote-numbering-style","mso-footnote-position","mso-footnote-separator","mso-footnote-separator-id","mso-footnote-separator-src","mso-foreground","mso-forms-protection","mso-generic-font-family","mso-grid-bottom","mso-grid-bottom-count","mso-grid-left","mso-grid-left-count","mso-grid-right","mso-grid-right-count","mso-grid-top","mso-grid-top-count","mso-gutter-direction","mso-gutter-margin","mso-gutter-position","mso-hansi-font-family","mso-header","mso-header-data","mso-header-id","mso-header-margin","mso-header-src","mso-height-alt","mso-height-rule","mso-height-source","mso-hide","mso-highlight","mso-horizontal-page-align","mso-hyphenate","mso-ignore","mso-kinsoku-overflow","mso-layout-grid-align","mso-layout-grid-char-alt","mso-layout-grid-origin","mso-level-inherit","mso-level-legacy","mso-level-legacy-indent","mso-level-legacy-space","mso-level-legal-format","mso-level-number-format","mso-level-number-position","mso-level-numbering","mso-level-reset-level","mso-level-start-at","mso-level-style-link","mso-level-suffix","mso-level-tab-stop","mso-level-text","mso-line-break-override","mso-line-grid","mso-line-height-alt","mso-line-height-rule","mso-line-numbers-count-by","mso-line-numbers-distance","mso-line-numbers-restart","mso-line-numbers-start","mso-line-spacing","mso-linked-frame","mso-list","mso-list-change","mso-list-change-author","mso-list-change-time","mso-list-change-values","mso-list-id","mso-list-ins","mso-list-ins-author","mso-list-ins-time","mso-list-name","mso-list-template-ids","mso-list-type","mso-margin-bottom-alt","mso-margin-left-alt","mso-margin-top-alt","mso-mirror-margins","mso-negative-indent-tab","mso-number-format","mso-outline-level","mso-outline-parent","mso-outline-parent-col","mso-outline-parent-row","mso-outline-parent-visibility","mso-outline-style","mso-padding-alt","mso-padding-between","mso-padding-bottom-alt","mso-padding-left-alt","mso-padding-right-alt","mso-padding-top-alt","mso-page-border-aligned","mso-page-border-art","mso-page-border-bottom-art","mso-page-border-display","mso-page-border-left-art","mso-page-border-offset-from","mso-page-border-right-art","mso-page-border-surround-footer","mso-page-border-surround-header","mso-page-border-top-art","mso-page-border-z-order","mso-page-numbers","mso-page-numbers-chapter-separator","mso-page-numbers-chapter-style","mso-page-numbers-start","mso-page-numbers-style","mso-page-orientation","mso-page-scale","mso-pagination","mso-panose-arm-style","mso-panose-contrast","mso-panose-family-type","mso-panose-letterform","mso-panose-midline","mso-panose-proportion","mso-panose-serif-style","mso-panose-stroke-variation","mso-panose-weight","mso-panose-x-height","mso-paper-source","mso-paper-source-first-page","mso-paper-source-other-pages","mso-pattern","mso-pattern-color","mso-pattern-style","mso-print-area","mso-print-color","mso-print-gridlines","mso-print-headings","mso-print-resolution","mso-print-sheet-order","mso-print-title-column","mso-print-title-row","mso-prop-change","mso-prop-change-author","mso-prop-change-time","mso-protection","mso-rotate","mso-row-margin-left","mso-row-margin-right","mso-ruby-merge","mso-ruby-visibility","mso-scheme-fill-color","mso-scheme-shadow-color","mso-shading","mso-shadow-color","mso-space-above","mso-space-below","mso-spacerun","mso-special-character","mso-special-format","mso-style-id","mso-style-name","mso-style-next","mso-style-parent","mso-style-type","mso-style-update","mso-subdocument","mso-symbol-font-family","mso-tab-count","mso-table-anchor-horizontal","mso-table-anchor-vertical","mso-table-bspace","mso-table-del-author","mso-table-del-time","mso-table-deleted","mso-table-dir","mso-table-ins-author","mso-table-ins-time","mso-table-inserted","mso-table-layout-alt","mso-table-left","mso-table-lspace","mso-table-overlap","mso-table-prop-author","mso-table-prop-change","mso-table-prop-time","mso-table-rspace","mso-table-top","mso-table-tspace","mso-table-wrap","mso-text-animation","mso-text-combine-brackets","mso-text-combine-id","mso-text-control","mso-text-fit-id","mso-text-indent-alt","mso-text-orientation","mso-text-raise","mso-title-page","mso-tny-compress","mso-unsynced","mso-vertical-align-alt","mso-vertical-align-special","mso-vertical-page-align","mso-width-alt","mso-width-source","mso-word-wrap","mso-xlrowspan","mso-zero-height","multiple","muted","name","nav-banner-image","navbutton_background_color","navbutton_home_hovered","navbutton_home_normal","navbutton_home_pushed","navbutton_horiz_hovered","navbutton_horiz_normal","navbutton_horiz_pushed","navbutton_next_hovered","navbutton_next_normal","navbutton_next_pushed","navbutton_prev_hovered","navbutton_prev_normal","navbutton_prev_pushed","navbutton_up_hovered","navbutton_up_normal","navbutton_up_pushed","navbutton_vert_hovered","navbutton_vert_normal","navbutton_vert_pushed","nohref","noresize","noshade","novalidate","nowrap","object","onblur","onchange","onclick","ondblclick","onfocus","onkeydown","onkeypress","onkeyup","onload","onmousedown","onmousemove","onmouseout","onmouseover","onmouseup","onreset","onselect","onsubmit","onunload","open","optimum","overflow","padding","padding-bottom","padding-left","padding-right","padding-top","page","page-break-after","page-break-before","panose-1","pattern","ping","placeholder","position","poster","preload","profile","prompt","punctuation-trim","punctuation-wrap","radiogroup","readonly","referrerpolicy","rel","required","rev","reversed","right","row-span","rows","rowspan","ruby-align","ruby-overhang","ruby-position","rules","sandbox","scheme","scope","scoped","scrolling","selected","separator-image","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","standby","start","step","style","summary","tab-interval","tab-stops","tabindex","table-border-color-dark","table-border-color-light","table-layout","target","text","text-align","text-autospace","text-combine","text-decoration","text-effect","text-fit","text-indent","text-justify","text-justify-trim","text-kashida","text-line-through","text-shadow","text-transform","text-underline","text-underline-color","text-underline-style","title","top","top-bar-button","translate","type","unicode-bidi","usemap","valign","value","valuetype","version","vert-align","vertical-align","visibility","vlink","vnd.ms-excel.numberformat","vspace","white-space","width","word-break","word-spacing","wrap","z-index"];function o(t){if("string"==typeof t)return 0!==t.length&&(t.charCodeAt(0)>=55296&&t.charCodeAt(0)<=56319);if(void 0===t)return!1;throw new TypeError(`string-character-is-astral-surrogate/isHighSurrogate(): the input is not string but ${typeof t}`)}function n(t){if("string"==typeof t)return 0!==t.length&&(t.charCodeAt(0)>=56320&&t.charCodeAt(0)<=57343);if(void 0===t)return!1;throw new TypeError(`string-character-is-astral-surrogate/isLowSurrogate(): the input is not string but ${typeof t}`)}function r(t){return null!=t}function a(t){return"string"==typeof t&&(t.charCodeAt(0)>=55296&&t.charCodeAt(0)<=57343)}function i(t,e,a,i,s){const c="function"==typeof a?a():a;if(e>=t.length&&s&&"EOL"===c)return c;if(!(e<=t.length)){if(i.relaxedApi)return!1;throw new Error(`string-match-left-right/marchForward(): [THROW_ID_102] second argument, fromIndexInclusive is ${e} beyond the input string length, ${t.length}.`)}{let l=s?1:a.length;for(let s=e,c=t.length;s<c;s++){let e=t[s];if(o(t[s])&&n(t[s+1])&&(e=t[s]+t[s+1]),n(t[s])&&o(t[s-1])&&(e=t[s-1]+t[s]),i.trimBeforeMatching&&""===t[s].trim())continue;if(!i.i&&i.trimCharsBeforeMatching.includes(e)||i.i&&i.trimCharsBeforeMatching.map(t=>t.toLowerCase()).includes(e.toLowerCase())){2===e.length&&(s+=1);continue}let c=a[a.length-l];if(o(c)&&r(a[a.length-l+1])&&n(a[a.length-l+1])&&(c=a[a.length-l]+a[a.length-l+1]),!(!i.i&&e===c||i.i&&e.toLowerCase()===c.toLowerCase()))return!1;if(l-=e.length,l<1){let i=s-a.length+e.length;return i>=0&&n(t[i])&&r(t[i-1])&&o(t[i-1])&&(i-=1),i>=0?i:0}2===e.length&&o(t[s])&&(s+=1)}if(l>0)return!(!s||"EOL"!==c)}}function s(t,e,r,a,i){const s="function"==typeof r?r():r;if(e<0&&i&&"EOL"===s)return s;if(e>=t.length){if(a.relaxedApi)return!1;throw new Error(`string-match-left-right/marchBackward(): [THROW_ID_203] second argument, starting index, should not be beyond the last character of the input string! Currently the first argument's last character's index is ${t.length} but the second argument is beyond it:\n${JSON.stringify(e,null,4)}`)}let c=i?1:r.length;for(let s=e+1;s--;){if(a.trimBeforeMatching&&""===t[s].trim()){if(0===s&&i&&"EOL"===r)return!0;continue}let e=t[s];if(n(t[s])&&o(t[s-1])?e=t[s-1]+t[s]:o(t[s])&&n(t[s+1])&&(e=t[s]+t[s+1]),!a.i&&a.trimCharsBeforeMatching.includes(e)||a.i&&a.trimCharsBeforeMatching.map(t=>t.toLowerCase()).includes(e.toLowerCase())){if(2===e.length&&(s-=1),i&&"EOL"===r&&0===s)return!0;continue}let l=r[c-1];if(n(l)&&(l=`${r[c-2]}${r[c-1]}`,c-=1,s-=1),!(!a.i&&e===l||a.i&&e.toLowerCase()===l.toLowerCase()))return!1;if(c-=1,c<1)return s>=0?s:0}return c>0?!(!i||"EOL"!==s):void 0}function c(t,e,c,l){return function(t,e,c,l,m){if("object"==typeof m&&null!==m&&Object.prototype.hasOwnProperty.call(m,"trimBeforeMatching")&&"boolean"!=typeof m.trimBeforeMatching)throw new Error(`string-match-left-right/${t}(): [THROW_ID_09] opts.trimBeforeMatching should be boolean!${Array.isArray(m.trimBeforeMatching)?" Did you mean to use opts.trimCharsBeforeMatching?":""}`);const u=Object.assign({},{i:!1,trimBeforeMatching:!1,trimCharsBeforeMatching:[],relaxedApi:!1},m);var g;let d,f,h,p;if(u.trimCharsBeforeMatching="string"==typeof(g=u.trimCharsBeforeMatching)?g.length>0?[g]:[]:g,u.trimCharsBeforeMatching=u.trimCharsBeforeMatching.map(t=>"string"==typeof t?t:String(t)),u.trimCharsBeforeMatching.some((t,e)=>t.length>1&&!a(t)&&(d=e,f=t,!0)))throw new Error(`string-match-left-right/${t}(): [THROW_ID_07] the fourth argument, options object contains trimCharsBeforeMatching. It was meant to list the single characters but one of the entries at index ${d} is longer than 1 character, ${f.length} (equals to ${f}). Please split it into separate characters and put into array as separate elements.`);if("string"!=typeof e){if(u.relaxedApi)return!1;throw new Error(`string-match-left-right/${t}(): [THROW_ID_01] the first argument should be a string. Currently it's of a type: ${typeof e}, equal to:\n${JSON.stringify(e,null,4)}`)}if(0===e.length){if(u.relaxedApi)return!1;throw new Error(`string-match-left-right/${t}(): [THROW_ID_02] the first argument should be a non-empty string. Currently it's empty!`)}if(!(Number.isInteger(c)&&c>=0)){if(u.relaxedApi)return!1;throw new Error(`string-match-left-right/${t}(): [THROW_ID_03] the second argument should be a natural number. Currently it's of a type: ${typeof c}, equal to:\n${JSON.stringify(c,null,4)}`)}if("string"==typeof l)h=[l];else if(Array.isArray(l))h=l;else if(r(l)){if("function"!=typeof l)throw new Error(`string-match-left-right/${t}(): [THROW_ID_05] the third argument, whatToMatch, is neither string nor array of strings! It's ${typeof l}, equal to:\n${JSON.stringify(l,null,4)}`);h=[],h.push(l)}else h=l;if(r(m)&&"object"!=typeof m)throw new Error(`string-match-left-right/${t}(): [THROW_ID_06] the fourth argument, options object, should be a plain object. Currently it's of a type "${typeof m}", and equal to:\n${JSON.stringify(m,null,4)}`);if(!r(h)||!Array.isArray(h)||Array.isArray(h)&&!h.length||Array.isArray(h)&&1===h.length&&"string"==typeof h[0]&&0===h[0].trim().length){if("function"==typeof u.cb){let r,a=c;if("matchRight"===t&&o(e[c])&&n(e[c+1])&&(a+=1),"matchLeftIncl"!==t&&"matchRight"!==t||(a+=1),t.startsWith("matchLeft"))for(let t=a;t--;){if(n(e[t])&&o(e[t-1]))continue;let a=e[t];if(o(e[t])&&n(e[t+1])&&(a=e[t]+e[t+1]),(!u.trimBeforeMatching||u.trimBeforeMatching&&void 0!==a&&""!==a.trim())&&(0===u.trimCharsBeforeMatching.length||void 0!==a&&!u.trimCharsBeforeMatching.includes(a))){r=t;break}n(e[t-1])&&o(e[t-2])&&(t-=1)}else if(t.startsWith("matchRight"))for(let t=a;t<e.length;t++){let a=e[t];if(o(e[t])&&n(e[t+1])&&(a=e[t]+e[t+1]),(!u.trimBeforeMatching||u.trimBeforeMatching&&""!==a.trim())&&(0===u.trimCharsBeforeMatching.length||!u.trimCharsBeforeMatching.includes(a))){r=t;break}o(e[t])&&n(e[t+1])&&(t+=1)}if(void 0===r)return!1;let i=e[r];o(e[r])&&n(e[r+1])&&(i=e[r]+e[r+1]),n(e[r])&&o(e[r-1])&&(i=e[r-1]+e[r],r-=1);let s,l=r+1;return o(e[r])&&n(e[r+1])&&(l+=1),l&&l>0&&(s=e.slice(0,l)),t.startsWith("matchLeft")?u.cb(i,s,r):(r&&r>0&&(s=e.slice(r)),u.cb(i,s,r))}let a="";throw r(m)||(a=" More so, the whole options object, the fourth input argument, is missing!"),new Error(`string-match-left-right/${t}(): [THROW_ID_08] the third argument, "whatToMatch", was given as an empty string. This means, you intend to match purely by a callback. The callback was not set though, the opts key "cb" is not set!${a}`)}if(t.startsWith("matchLeft")){for(let i=0,l=h.length;i<l;i++){p="function"==typeof h[i];const l=h[i];let m,g,d="",f=c;"matchLeft"===t&&(a(e[i-1])&&a(e[i-2])?f-=2:f-=1);const b=s(e,f,l,u,p);if(b&&p&&"function"==typeof l&&"EOL"===l())return!(!l()||u.cb&&!u.cb(m,d,g))&&l();if(r(b)&&b>0&&(g=b-1,m=e[g],d=e.slice(0,b)),n(e[g])&&r(e[g-1])&&o(e[g-1])&&(g-=1,m=e[g-1]+e[g]),o(e[g])&&r(e[g+1])&&n(e[g+1])&&(m=e[g]+e[g+1],d=e.slice(0,g+2)),!1!==b&&(!u.cb||u.cb(m,d,g)))return l}return!1}for(let a=0,s=h.length;a<s;a++){p="function"==typeof h[a];const s=h[a];let l=c+("matchRight"===t?1:0);"matchRight"===t&&o(e[l-1])&&n(e[l])&&(l+=1);const m=i(e,l,s,u,p);if(m&&p&&"function"==typeof s&&"EOL"===s()){let t,e,o;return!(!s()||u.cb&&!u.cb(t,e,o))&&s()}let g,d,f;if(r(m)&&r(e[m+s.length-1])&&(g=m+s.length,d=e[g],o(e[g])&&n(e[g+1])&&(d=e[g]+e[g+1])),r(g)&&g>=0&&(f=e.slice(g)),!1!==m&&(!u.cb||u.cb(d,f,g)))return s}return!1}("matchRight",t,e,c,l)}var l="[object Object]";var m,u,g=Function.prototype,d=Object.prototype,f=g.toString,h=d.hasOwnProperty,p=f.call(Object),b=d.toString,y=(m=Object.getPrototypeOf,u=Object,function(t){return m(u(t))});var v=function(t){if(!function(t){return!!t&&"object"==typeof t}(t)||b.call(t)!=l||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t))return!1;var e=y(t);if(null===e)return!0;var o=h.call(e,"constructor")&&e.constructor;return"function"==typeof o&&o instanceof o&&f.call(o)==p},w="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var _=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t,e){var o=200,n="__lodash_hash_undefined__",r=9007199254740991,a="[object Arguments]",i="[object Boolean]",s="[object Date]",c="[object Function]",l="[object GeneratorFunction]",m="[object Map]",u="[object Number]",g="[object Object]",d="[object RegExp]",f="[object Set]",h="[object String]",p="[object Symbol]",b="[object ArrayBuffer]",y="[object DataView]",v="[object Float32Array]",_="[object Float64Array]",k="[object Int8Array]",S="[object Int16Array]",E="[object Int32Array]",A="[object Uint8Array]",O="[object Uint8ClampedArray]",T="[object Uint16Array]",N="[object Uint32Array]",C=/\w*$/,x=/^\[object .+?Constructor\]$/,j=/^(?:0|[1-9]\d*)$/,L={};L[a]=L["[object Array]"]=L[b]=L[y]=L[i]=L[s]=L[v]=L[_]=L[k]=L[S]=L[E]=L[m]=L[u]=L[g]=L[d]=L[f]=L[h]=L[p]=L[A]=L[O]=L[T]=L[N]=!0,L["[object Error]"]=L[c]=L["[object WeakMap]"]=!1;var M="object"==typeof w&&w&&w.Object===Object&&w,I="object"==typeof self&&self&&self.Object===Object&&self,P=M||I||Function("return this")(),B=e&&!e.nodeType&&e,R=B&&t&&!t.nodeType&&t,$=R&&R.exports===B;function J(t,e){return t.set(e[0],e[1]),t}function V(t,e){return t.add(e),t}function F(t,e,o,n){var r=-1,a=t?t.length:0;for(n&&a&&(o=t[++r]);++r<a;)o=e(o,t[r],r,t);return o}function W(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function z(t){var e=-1,o=Array(t.size);return t.forEach((function(t,n){o[++e]=[n,t]})),o}function D(t,e){return function(o){return t(e(o))}}function H(t){var e=-1,o=Array(t.size);return t.forEach((function(t){o[++e]=t})),o}var q,U=Array.prototype,Q=Function.prototype,G=Object.prototype,Y=P["__core-js_shared__"],K=(q=/[^.]+$/.exec(Y&&Y.keys&&Y.keys.IE_PROTO||""))?"Symbol(src)_1."+q:"",X=Q.toString,Z=G.hasOwnProperty,tt=G.toString,et=RegExp("^"+X.call(Z).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ot=$?P.Buffer:void 0,nt=P.Symbol,rt=P.Uint8Array,at=D(Object.getPrototypeOf,Object),it=Object.create,st=G.propertyIsEnumerable,ct=U.splice,lt=Object.getOwnPropertySymbols,mt=ot?ot.isBuffer:void 0,ut=D(Object.keys,Object),gt=Rt(P,"DataView"),dt=Rt(P,"Map"),ft=Rt(P,"Promise"),ht=Rt(P,"Set"),pt=Rt(P,"WeakMap"),bt=Rt(Object,"create"),yt=Wt(gt),vt=Wt(dt),wt=Wt(ft),_t=Wt(ht),kt=Wt(pt),St=nt?nt.prototype:void 0,Et=St?St.valueOf:void 0;function At(t){var e=-1,o=t?t.length:0;for(this.clear();++e<o;){var n=t[e];this.set(n[0],n[1])}}function Ot(t){var e=-1,o=t?t.length:0;for(this.clear();++e<o;){var n=t[e];this.set(n[0],n[1])}}function Tt(t){var e=-1,o=t?t.length:0;for(this.clear();++e<o;){var n=t[e];this.set(n[0],n[1])}}function Nt(t){this.__data__=new Ot(t)}function Ct(t,e){var o=Dt(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&Ht(t)}(t)&&Z.call(t,"callee")&&(!st.call(t,"callee")||tt.call(t)==a)}(t)?function(t,e){for(var o=-1,n=Array(t);++o<t;)n[o]=e(o);return n}(t.length,String):[],n=o.length,r=!!n;for(var i in t)!e&&!Z.call(t,i)||r&&("length"==i||Vt(i,n))||o.push(i);return o}function xt(t,e,o){var n=t[e];Z.call(t,e)&&zt(n,o)&&(void 0!==o||e in t)||(t[e]=o)}function jt(t,e){for(var o=t.length;o--;)if(zt(t[o][0],e))return o;return-1}function Lt(t,e,o,n,r,w,x){var j;if(n&&(j=w?n(t,r,w,x):n(t)),void 0!==j)return j;if(!Qt(t))return t;var M=Dt(t);if(M){if(j=function(t){var e=t.length,o=t.constructor(e);e&&"string"==typeof t[0]&&Z.call(t,"index")&&(o.index=t.index,o.input=t.input);return o}(t),!e)return function(t,e){var o=-1,n=t.length;e||(e=Array(n));for(;++o<n;)e[o]=t[o];return e}(t,j)}else{var I=Jt(t),P=I==c||I==l;if(qt(t))return function(t,e){if(e)return t.slice();var o=new t.constructor(t.length);return t.copy(o),o}(t,e);if(I==g||I==a||P&&!w){if(W(t))return w?t:{};if(j=function(t){return"function"!=typeof t.constructor||Ft(t)?{}:(e=at(t),Qt(e)?it(e):{});var e}(P?{}:t),!e)return function(t,e){return Pt(t,$t(t),e)}(t,function(t,e){return t&&Pt(e,Gt(e),t)}(j,t))}else{if(!L[I])return w?t:{};j=function(t,e,o,n){var r=t.constructor;switch(e){case b:return It(t);case i:case s:return new r(+t);case y:return function(t,e){var o=e?It(t.buffer):t.buffer;return new t.constructor(o,t.byteOffset,t.byteLength)}(t,n);case v:case _:case k:case S:case E:case A:case O:case T:case N:return function(t,e){var o=e?It(t.buffer):t.buffer;return new t.constructor(o,t.byteOffset,t.length)}(t,n);case m:return function(t,e,o){return F(e?o(z(t),!0):z(t),J,new t.constructor)}(t,n,o);case u:case h:return new r(t);case d:return function(t){var e=new t.constructor(t.source,C.exec(t));return e.lastIndex=t.lastIndex,e}(t);case f:return function(t,e,o){return F(e?o(H(t),!0):H(t),V,new t.constructor)}(t,n,o);case p:return a=t,Et?Object(Et.call(a)):{}}var a}(t,I,Lt,e)}}x||(x=new Nt);var B=x.get(t);if(B)return B;if(x.set(t,j),!M)var R=o?function(t){return function(t,e,o){var n=e(t);return Dt(t)?n:function(t,e){for(var o=-1,n=e.length,r=t.length;++o<n;)t[r+o]=e[o];return t}(n,o(t))}(t,Gt,$t)}(t):Gt(t);return function(t,e){for(var o=-1,n=t?t.length:0;++o<n&&!1!==e(t[o],o,t););}(R||t,(function(r,a){R&&(r=t[a=r]),xt(j,a,Lt(r,e,o,n,a,t,x))})),j}function Mt(t){return!(!Qt(t)||function(t){return!!K&&K in t}(t))&&(Ut(t)||W(t)?et:x).test(Wt(t))}function It(t){var e=new t.constructor(t.byteLength);return new rt(e).set(new rt(t)),e}function Pt(t,e,o,n){o||(o={});for(var r=-1,a=e.length;++r<a;){var i=e[r],s=n?n(o[i],t[i],i,o,t):void 0;xt(o,i,void 0===s?t[i]:s)}return o}function Bt(t,e){var o,n,r=t.__data__;return("string"==(n=typeof(o=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==o:null===o)?r["string"==typeof e?"string":"hash"]:r.map}function Rt(t,e){var o=function(t,e){return null==t?void 0:t[e]}(t,e);return Mt(o)?o:void 0}At.prototype.clear=function(){this.__data__=bt?bt(null):{}},At.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},At.prototype.get=function(t){var e=this.__data__;if(bt){var o=e[t];return o===n?void 0:o}return Z.call(e,t)?e[t]:void 0},At.prototype.has=function(t){var e=this.__data__;return bt?void 0!==e[t]:Z.call(e,t)},At.prototype.set=function(t,e){return this.__data__[t]=bt&&void 0===e?n:e,this},Ot.prototype.clear=function(){this.__data__=[]},Ot.prototype.delete=function(t){var e=this.__data__,o=jt(e,t);return!(o<0)&&(o==e.length-1?e.pop():ct.call(e,o,1),!0)},Ot.prototype.get=function(t){var e=this.__data__,o=jt(e,t);return o<0?void 0:e[o][1]},Ot.prototype.has=function(t){return jt(this.__data__,t)>-1},Ot.prototype.set=function(t,e){var o=this.__data__,n=jt(o,t);return n<0?o.push([t,e]):o[n][1]=e,this},Tt.prototype.clear=function(){this.__data__={hash:new At,map:new(dt||Ot),string:new At}},Tt.prototype.delete=function(t){return Bt(this,t).delete(t)},Tt.prototype.get=function(t){return Bt(this,t).get(t)},Tt.prototype.has=function(t){return Bt(this,t).has(t)},Tt.prototype.set=function(t,e){return Bt(this,t).set(t,e),this},Nt.prototype.clear=function(){this.__data__=new Ot},Nt.prototype.delete=function(t){return this.__data__.delete(t)},Nt.prototype.get=function(t){return this.__data__.get(t)},Nt.prototype.has=function(t){return this.__data__.has(t)},Nt.prototype.set=function(t,e){var n=this.__data__;if(n instanceof Ot){var r=n.__data__;if(!dt||r.length<o-1)return r.push([t,e]),this;n=this.__data__=new Tt(r)}return n.set(t,e),this};var $t=lt?D(lt,Object):function(){return[]},Jt=function(t){return tt.call(t)};function Vt(t,e){return!!(e=null==e?r:e)&&("number"==typeof t||j.test(t))&&t>-1&&t%1==0&&t<e}function Ft(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||G)}function Wt(t){if(null!=t){try{return X.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function zt(t,e){return t===e||t!=t&&e!=e}(gt&&Jt(new gt(new ArrayBuffer(1)))!=y||dt&&Jt(new dt)!=m||ft&&"[object Promise]"!=Jt(ft.resolve())||ht&&Jt(new ht)!=f||pt&&"[object WeakMap]"!=Jt(new pt))&&(Jt=function(t){var e=tt.call(t),o=e==g?t.constructor:void 0,n=o?Wt(o):void 0;if(n)switch(n){case yt:return y;case vt:return m;case wt:return"[object Promise]";case _t:return f;case kt:return"[object WeakMap]"}return e});var Dt=Array.isArray;function Ht(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=r}(t.length)&&!Ut(t)}var qt=mt||function(){return!1};function Ut(t){var e=Qt(t)?tt.call(t):"";return e==c||e==l}function Qt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Gt(t){return Ht(t)?Ct(t):function(t){if(!Ft(t))return ut(t);var e=[];for(var o in Object(t))Z.call(t,o)&&"constructor"!=o&&e.push(o);return e}(t)}t.exports=function(t){return Lt(t,!0,!0)}}));function k(t,e){return function(t,e,o){if("string"!=typeof t||!t.length)return null;if(e&&"number"==typeof e||(e=0),!t[e+1])return null;if(t[e+1]&&(!o&&t[e+1].trim().length||o&&(t[e+1].trim().length||"\n\r".includes(t[e+1]))))return e+1;if(t[e+2]&&(!o&&t[e+2].trim().length||o&&(t[e+2].trim().length||"\n\r".includes(t[e+2]))))return e+2;for(let n=e+1,r=t.length;n<r;n++)if(t[n]&&(!o&&t[n].trim().length||o&&(t[n].trim().length||"\n\r".includes(t[n]))))return n;return null}(t,e,!1)}function S(t,e){return function(t,e,o){if("string"!=typeof t||!t.length)return null;if(e&&"number"==typeof e||(e=0),e<1)return null;if(t[e-1]&&(!o&&t[e-1].trim().length||o&&(t[e-1].trim().length||"\n\r".includes(t[e-1]))))return e-1;if(t[e-2]&&(!o&&t[e-2].trim().length||o&&(t[e-2].trim().length||"\n\r".includes(t[e-2]))))return e-2;for(let n=e;n--;)if(t[n]&&(!o&&t[n].trim().length||o&&(t[n].trim().length||"\n\r".includes(t[n]))))return n;return null}(t,e,!1)}const E="\\",A=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","big","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","dir","div","dl","doctype","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h1 - h6","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","math","menu","menuitem","meta","meter","nav","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","slot","small","source","span","strike","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr","xml"];function O(t){return void 0===t||t.toUpperCase()===t.toLowerCase()&&!"0123456789".includes(t)}function T(t,e=0){const o=e?t.slice(e):t;let n=!1;return/^<[\\ \t\r\n/]*\w+[\\ \t\r\n/]*>/g.test(o)?n=!0:/^<\s*\w+\s+\w+(?:-\w+)?\s*=\s*['"\w]/g.test(o)?n=!0:/^<\s*\/?\s*\w+\s*\/?\s*>/g.test(o)?n=!0:/^<[\\ \t\r\n/]*\w+(?:\s*\w+)*\s*\w+=['"]/g.test(o)?n=!0:"<"===t[e]&&t[e+1]&&(["/",E].includes(t[e+1])&&c(t,e+1,A,{cb:O,i:!0})||!O(t[e+1])&&c(t,e,A,{cb:O,i:!0,trimCharsBeforeMatching:["/",E,"!"," ","\t","\n","\r"]})||O(t[e+1])&&c(t,e,A,{cb:(e,o,n)=>(void 0===e||e.toUpperCase()===e.toLowerCase()&&!"0123456789".includes(e))&&("/"===t[k(t,n-1)]||">"===t[k(t,n-1)]),i:!0,trimCharsBeforeMatching:["/",E,"!"," ","\t","\n","\r"]}))&&(n=!0),"string"==typeof t&&e<t.length&&n}var N=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","bgsound","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","command","content","data","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","element","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","image","img","input","ins","isindex","kbd","keygen","label","legend","li","link","listing","main","map","mark","marquee","menu","menuitem","meta","meter","multicol","nav","nextid","nobr","noembed","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","plaintext","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr","xmp"];function C(t){return"string"==typeof t}function x(t){return"string"==typeof t&&t.charCodeAt(0)>=48&&t.charCodeAt(0)<=57||Number.isInteger(t)}function j(t){return C(t)&&1===t.length&&(t.charCodeAt(0)>64&&t.charCodeAt(0)<91||t.charCodeAt(0)>96&&t.charCodeAt(0)<123)}function L(t){return j(t)||t.charCodeAt(0)>=48&&t.charCodeAt(0)<=57||[":","-"].includes(t)}function M(t){for(var e="",o=0,n=t.length;o<n;o++)e="{"===t[o]?"}".concat(e):"("===t[o]?")".concat(e):"".concat(t[o]).concat(e);return e}var I={reportProgressFunc:null,reportProgressFuncFrom:0,reportProgressFuncTo:100},P=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"],B="{}%-$_()*|",R=[")|(","|(",")(","()","%)","*)","**"];return function(o,n,r,a){if(!C(o))throw void 0===o?new Error("codsen-tokenizer: [THROW_ID_01] the first input argument is completely missing! It should be given as string."):new Error('codsen-tokenizer: [THROW_ID_02] the first input argument must be string! It was given as "'.concat(t(o),'", equal to:\n').concat(JSON.stringify(o,null,4)));if(n&&"function"!=typeof n)throw new Error("codsen-tokenizer: [THROW_ID_03] the second input argument, callback function, should be a function but it was given as type ".concat(t(n),", equal to ").concat(JSON.stringify(n,null,4)));if(r&&"function"!=typeof r)throw new Error("codsen-tokenizer: [THROW_ID_04] the second input argument, callback function, should be a function but it was given as type ".concat(t(r),", equal to ").concat(JSON.stringify(r,null,4)));if(a&&!v(a))throw new Error("codsen-tokenizer: [THROW_ID_05] the third input argument, options object, should be a plain object but it was given as type ".concat(t(a),", equal to ").concat(JSON.stringify(a,null,4)));var i,s=Object.assign({},I,a);if(s.reportProgressFunc&&"function"!=typeof s.reportProgressFunc)throw new TypeError("codsen-tokenizer: [THROW_ID_06] opts.reportProgressFunc should be a function but it was given as :\n".concat(JSON.stringify(s.reportProgressFunc,null,4)," (").concat(t(s.reportProgressFunc),")"));var l,m=0,u=o.length,g=Math.floor(u/2),d=!1,f={},h={type:null,start:null,end:null,tail:null,kind:null,attribs:[]};function p(){f=_(h)}var b={},y={attribName:null,attribNameRecognised:null,attribNameStartAt:null,attribNameEndAt:null,attribOpeningQuoteAt:null,attribClosingQuoteAt:null,attribValue:null,attribValueStartAt:null,attribValueEndAt:null,attribStart:null,attribEnd:null};function w(){b=_(y)}p(),w();var E,A=[];function O(e,o,n){if(!A.length)return!1;var r=n?A[0]:A[A.length-1];if("simple"===r.type)return e[o]===M(r.value);if("esp"===r.type){var a=function(){if(!B.includes(e[o]))return{v:!1};for(var n="",a=e.length,i=o;i<a&&B.includes(e[i]);i++)n+=e[i];if(console.log("250 ".concat("[".concat(33,"m","wholeEspTagLump","[",39,"m")," = ",JSON.stringify(n,null,4))),console.log("257 ".concat("[".concat(33,"m","whichLayerToMatch.openingLump","[",39,"m")," = ",JSON.stringify(r.openingLump,null,4))),n&&r.openingLump&&n.length>r.guessedClosingLump.length){if(n.endsWith(r.openingLump))return console.log("279 RETURN ".concat(n.length-r.openingLump.length)),{v:n.length-r.openingLump.length};var s=r.guessedClosingLump.split("").reduce((function(t,e){return t.includes(e)?t:t.concat([e])}),[]);console.log("302 ".concat("[".concat(33,"m","uniqueCharsListFromGuessedClosingLumpArr","[",39,"m")," = ",JSON.stringify(s,null,0)));for(var c=0,l=function(t,e){if(console.log("311 char = ".concat(n[e])),!s.includes(n[e])&&c>1)return console.log("319 RETURN ".concat(e)),{v:{v:e}};s.includes(n[e])&&(c++,s=s.filter((function(t){return t!==n[e]})),console.log("333 SET found = ".concat(c,"; uniqueCharsListFromGuessedClosingLumpArr = ").concat(JSON.stringify(s,null,0))))},m=0,u=n.length;m<u;m++){var g=l(0,m);if("object"===t(g))return g.v}}else if(r.guessedClosingLump.split("").every((function(t){return n.includes(t)})))return console.log("348 RETURN ".concat(n.length)),{v:n.length}}();if("object"===t(a))return a.v}}function $(t,e){return O(t,e,!0)}function J(t){n&&(console.log("368 ".concat("[".concat(32,"m","PING","[",39,"m")," tagCb() with ",JSON.stringify(t,null,4))),n(_(t)),p())}function V(t,e){console.log("382 ".concat("[".concat(35,"m","dumpCurrentToken()","[",39,"m"),"; incoming token=",JSON.stringify(t,null,0),"; i = ","[".concat(33,"m",e,"[",39,"m"))),!["text","esp"].includes(t.type)&&null!==t.start&&t.start<e&&o[e-1]&&!o[e-1].trim().length&&(console.log("397 this token indeed had trailing whitespace"),t.end=S(o,e)+1,console.log("401 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.end","[",39,"m")," = ",t.end)),J(t),t.start=S(o,e)+1,t.end=null,t.type="text",console.log("410 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.start","[",39,"m")," = ",t.start,"; ","[".concat(33,"m","token.type","[",39,"m")," = ").concat(t.type))),null!==t.start&&(null===t.end&&(t.end=e,console.log("422 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.end","[",39,"m")," = ",t.end,"; then PING tagCb()"))),J(t))}for(var F=0;F<u;F++){if(console.log("[".concat(36,"m","===============================","[",39,"m [",35,"m","str[ ".concat(F," ] = ").concat(o[F]&&o[F].trim().length?o[F]:JSON.stringify(o[F],null,4)),"[",39,"m [",36,"m","===============================","[",39,"m\n")),s.reportProgressFunc&&(u>1e3&&u<2e3?F===g&&s.reportProgressFunc(Math.floor((s.reportProgressFuncTo-s.reportProgressFuncFrom)/2)):u>=2e3&&(i=s.reportProgressFuncFrom+Math.floor(F/u*(s.reportProgressFuncTo-s.reportProgressFuncFrom)))!==m&&(m=i,s.reportProgressFunc(i),console.log("505 DONE ".concat(i,"%")))),Number.isInteger(l)&&F>=l&&(l=!1,console.log("516 TURN OFF doNothing")),f.end&&f.end===F&&(console.log("521 call dumpCurrentToken()"),"style"===f.kind&&(d=!0),V(f,F),console.log("528 ".concat("[".concat(31,"m","WIPE","[",39,"m")," layers")),A=[]),!l&&["html","esp","css"].includes(f.type)&&(console.log("546 inside layers clauses"),!['"',"'","(",")"].includes(o[F])||['"',"'"].includes(o[S(o,F)])&&o[S(o,F)]===o[k(o,F)]||(O(o,F)?(A.pop(),console.log("563 ".concat("[".concat(32,"m","POP","[",39,"m")," layers"))):(A.push({type:"simple",value:o[F],position:F}),console.log("572 ".concat("[".concat(32,"m","PUSH","[",39,"m")," ",JSON.stringify({type:"simple",value:o[F]},null,4))))),console.log("585 now ".concat("[".concat(33,"m","layers","[",39,"m")," = ",JSON.stringify(A,null,4)))),!l)if(A.length||"<"!==o[F]||!(T(o,F)||o.startsWith("!--",F+1)||c(o,F,["doctype","xml","cdata"],{i:!0,trimCharsBeforeMatching:["?","!","["," ","-"]}))||"esp"===f.type&&!f.tail.includes(o[F]))if(B.includes(o[F])&&o[F+1]&&B.includes(o[F+1])&&("-"!==o[F]||"-"!==o[F+1])&&(!"0123456789".includes(o[S(o,F)])||o[F+2]&&!['"',"'",";"].includes(o[F+2])&&o[F+2].trim().length)){console.log("706 ESP tag detected");for(var W="",z=F;z<u&&B.includes(o[z]);z++)W+=o[z];if(console.log("721 ".concat("[".concat(32,"m","SET","[",39,"m")," wholeEspTagLump = ",W)),console.log("724 FIY, ".concat("[".concat(33,"m","layers","[",39,"m")," = ",JSON.stringify(A,null,4))),console.log("731 FIY, ".concat("[".concat(33,"m","token","[",39,"m")," = ",JSON.stringify(f,null,4))),!(R.includes(W)||Array.isArray(A)&&A.length&&"single"===A[A.length-1].type&&A[A.length-1].value===o[F+W.length])){console.log("749 ESP lump is not blacklisted.");var D=void 0;A.length&&O(o,F)?(console.log("755 closing part of a set ".concat("[".concat(32,"m","MATCHED","[",39,"m")," against the last layer")),D=O(o,F),console.log("759 ".concat("[".concat(33,"m","lengthOfClosingEspChunk","[",39,"m")," = ",JSON.stringify(D,null,4))),"esp"===f.type&&(null===f.end&&(f.end=F+D,console.log("772 SET ".concat("[".concat(32,"m","token.end","[",39,"m")," = ",f.end))),console.log("778 ".concat("[".concat(33,"m","token","[",39,"m")," = ",JSON.stringify(f,null,4)," before pinging")),V(f,F)),A.pop(),console.log("790 ".concat("[".concat(32,"m","POP","[",39,"m")," layers"))):A.length&&$(o,F)?(console.log("793 closing part of a set ".concat("[".concat(32,"m","MATCHED","[",39,"m")," against first layer")),console.log("796 wipe all layers, there were strange unclosed characters"),D=$(o,F),console.log("800 ".concat("[".concat(33,"m","lengthOfClosingEspChunk","[",39,"m")," = ",JSON.stringify(D,null,4))),"esp"===f.type&&(null===f.end&&(f.end=F+D,console.log("813 ".concat("[".concat(33,"m","token","[",39,"m")," = ",JSON.stringify(f,null,4)," before pinging"))),V(f,F)),A=[],console.log("826 ".concat("[".concat(32,"m","WIPE","[",39,"m")," layers"))):(console.log("829 closing part of a set ".concat("[".concat(31,"m","NOT MATCHED","[",39,"m")," - means it's a new opening")),console.log("831 push new layer"),A.push({type:"esp",openingLump:W,guessedClosingLump:M(W),position:F}),console.log("839 ".concat("[".concat(32,"m","PUSH","[",39,"m")," ",JSON.stringify({type:"esp",openingLump:W,guessedClosingLump:M(W),position:F},null,4))),console.log("851 ".concat("[".concat(33,"m","layers","[",39,"m")," = ",JSON.stringify(A,null,4))),"html"===f.type&&("comment"===f.kind||x(b.attribStart)&&null===b.attribEnd)||(console.log("870 ".concat("[".concat(36,"m","██","[",39,"m")," standalone ESP tag")),V(f,F),f.start=F,f.type="esp",console.log("877 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.start","[",39,"m")," = ",f.start,"; ","[".concat(33,"m","token.type","[",39,"m")," = ").concat(f.type)),f.tail=M(W),console.log("885 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.tail","[",39,"m")," = ",f.tail)),f.head=W)),l=F+(D||W.length),console.log("900 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(31,"m","doNothing","[",39,"m")," = ",l))}}else null!==f.start&&f.end!==F||(d?(console.log("907"),o[F].trim().length?(f.start=F,f.type="css",console.log("945 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.start","[",39,"m")," = ",f.start,"; ","[".concat(33,"m","token.type","[",39,"m")," = ").concat(f.type))):(f.start=F,f.type="text",f.end=k(o,F)||o.length,console.log("914 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.start","[",39,"m")," = ",f.start,"; ","[".concat(33,"m","token.end","[",39,"m")," = ").concat(f.end,"; ","[".concat(33,"m","token.type","[",39,"m")," = ").concat(f.type)),J(f),k(o,F)&&(f.start=k(o,F),f.type="css",console.log("928 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.start","[",39,"m")," = ",f.start,"; ","[".concat(33,"m","token.type","[",39,"m")," = ").concat(f.type)),l=k(o,F),console.log("937 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(31,"m","doNothing","[",39,"m")," = ",l))))):(console.log("952 ".concat("[".concat(31,"m","reset","[",39,"m")," attrib")),w(),f.start=F,console.log("956 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.start","[",39,"m")," = ",f.start)),f.type="text",f.attribs=[],w(),console.log("964 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.type","[",39,"m")," = ",f.type,"; ","[".concat(33,"m","token.attribs","[",39,"m")," = ").concat(f.attribs))));else console.log("612 html tag opening"),f.type&&Number.isInteger(f.start)?(console.log("615 call dumpCurrentToken()"),V(f,F)):console.log("618 didn't call dumpCurrentToken()"),console.log("621 ".concat("[".concat(31,"m","RESET","[",39,"m")," token")),p(),f.start=F,f.type="html",console.log("627 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.start","[",39,"m")," = ",f.start,"; ","[".concat(33,"m","token.type","[",39,"m")," = ").concat(f.type)),f=Object.assign({tagNameStartAt:null,tagNameEndAt:null,tagName:null,recognised:null,closing:!1,void:!1,pureHTML:!0,esp:[]},f),c(o,F,"!--")?(f.kind="comment",console.log("638 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.kind","[",39,"m")," = ",f.kind))):c(o,F,"doctype",{i:!0,trimCharsBeforeMatching:["?","!","["," ","-"]})?(f.kind="doctype",console.log("650 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.kind","[",39,"m")," = ",f.kind))):c(o,F,"cdata",{i:!0,trimCharsBeforeMatching:["?","!","["," ","-"]})?(f.kind="cdata",console.log("662 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.kind","[",39,"m")," = ",f.kind))):c(o,F,"xml",{i:!0,trimCharsBeforeMatching:["?","!","["," ","-"]})?(f.kind="xml",console.log("674 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.kind","[",39,"m")," = ",f.kind))):c(o,F,"style",{i:!0,trimCharsBeforeMatching:["?","!","["," ","-","/","\\"]})&&(f.kind="style",console.log("686 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.kind","[",39,"m")," = ",f.kind)));if(!l)if("html"!==f.type||A.length||">"!==o[F]){if("esp"===f.type&&null===f.end&&C(f.tail)&&f.tail.includes(o[F])){console.log("993 POSSIBLE ESP TAILS");for(var H="",q=F;q<u&&B.includes(o[q]);q++)H+=o[q];if(console.log("1004 wholeEspTagClosing = ".concat(H)),H.length>f.head.length){console.log("1014 wholeEspTagClosing.length = ".concat("[".concat(33,"m",H.length,"[",39,"m")," > token.head.length = ","[".concat(33,"m",f.head.length,"[",39,"m")));var U=f.head[0];H.endsWith(f.head)?(console.log("1042 - chunk ends with the same heads"),f.end=F+H.length-f.head.length,console.log("1064 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.end","[",39,"m")," = ",f.end)),l=f.end,console.log("1070 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(31,"m","doNothing","[",39,"m")," = ",l))):H.startsWith(f.tail)?(f.end=F+f.tail.length,console.log("1075 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.end","[",39,"m")," = ",f.end)),l=f.end,console.log("1081 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(31,"m","doNothing","[",39,"m")," = ",l))):!f.tail.includes(U)&&H.includes(U)||H.endsWith(f.head)||H.startsWith(f.tail)?function(){console.log("1089");var t=H.slice(0,H.indexOf(U)),e=H.slice(H.indexOf(U));console.log("".concat("[".concat(33,"m","firstPartOfWholeEspTagClosing","[",39,"m")," = ",JSON.stringify(t,null,4))),console.log("".concat("[".concat(33,"m","secondPartOfWholeEspTagClosing","[",39,"m")," = ",JSON.stringify(e,null,4))),t.length&&e.length&&f.tail.split("").every((function(e){return t.includes(e)}))&&(console.log("1124 definitely tails + new heads"),f.end=F+t.length,console.log("1127 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.end","[",39,"m")," = ",f.end)),l=f.end,console.log("1133 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(31,"m","doNothing","[",39,"m")," = ",l)))}():(console.log("CASE #2."),f.end=F+H.length,console.log("1148 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.end","[",39,"m")," = ",f.end)),l=f.end,console.log("1154 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(31,"m","doNothing","[",39,"m")," = ",l))),console.log("1157")}else f.end=F+H.length,console.log("1162 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.end","[",39,"m")," = ",f.end)),l=f.end,console.log("1168 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(31,"m","doNothing","[",39,"m")," = ",l))}}else f.end=F+1,console.log("982 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.end","[",39,"m")," = ",f.end));if(l||"html"!==f.type||!x(f.tagNameStartAt)||x(f.tagNameEndAt)||j(o[F])||x(o[F])||(f.tagNameEndAt=F,console.log("1188 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.tagNameEndAt","[",39,"m")," = ",f.tagNameEndAt)),f.tagName=o.slice(f.tagNameStartAt,F).toLowerCase(),console.log("1195 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.tagName","[",39,"m")," = ",f.tagName)),P.includes(f.tagName)&&(f.void=!0,console.log("1206 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.void","[",39,"m")," = ",f.void))),f.recognised=N.includes(f.tagName.toLowerCase())||["doctype","cdata","xml"].includes(f.tagName.toLowerCase()),console.log("1216 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.recognised","[",39,"m")," = ",f.recognised))),!l&&"html"===f.type&&!x(f.tagNameStartAt)&&x(f.start)&&f.start<F&&("/"===o[F]?(f.closing=!0,console.log("1239 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.closing","[",39,"m")," = ",f.closing))):j(o[F])&&(f.tagNameStartAt=F,console.log("1246 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.tagNameStartAt","[",39,"m")," = ",f.tagNameStartAt)),f.closing||(f.closing=!1,console.log("1255 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.closing","[",39,"m")," = ",f.closing))))),!l&&"html"===f.type&&x(b.attribNameStartAt)&&F>b.attribNameStartAt&&null===b.attribNameEndAt&&!L(o[F])&&(console.log("1276 inside catch the tag attribute name end clauses"),b.attribNameEndAt=F,b.attribName=o.slice(b.attribNameStartAt,F),b.attribNameRecognised=e.includes(b.attribName),console.log("1281 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","attrib.attribNameEndAt","[",39,"m")," = ",b.attribNameEndAt,"; ","[".concat(33,"m","attrib.attribName","[",39,"m")," = ").concat(JSON.stringify(b.attribName,null,0))),o[F].trim().length||"="!==o[k(o,F)]?(!o[F].trim().length||">"===o[F]||"/"===o[F]&&">"===o[k(o,F)])&&(b.attribEnd=F,console.log("1301 SET ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","attrib.attribNameEndAt","[",39,"m")," = ",b.attribEnd)),f.attribs.push(_(b)),w()):console.log("1292 equal on the right")),!l&&"html"===f.type&&x(f.tagNameEndAt)&&F>f.tagNameEndAt&&null===b.attribStart&&L(o[F])&&(console.log("1322 inside catch the tag attribute name start clauses"),b.attribStart=F,b.attribNameStartAt=F,console.log("1326 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","attrib.attribStart","[",39,"m")," = ",b.attribStart,"; ","[".concat(33,"m","attrib.attribNameStartAt","[",39,"m")," = ").concat(b.attribNameStartAt))),!l&&"html"===f.type&&x(b.attribValueStartAt)&&F>=b.attribValueStartAt&&null===b.attribValueEndAt&&(console.log("1344 inside catching end of a tag attr clauses"),"'\"".includes(o[F])?o[b.attribOpeningQuoteAt]!==o[F]||A.some((function(t){return"esp"===t.type}))||(console.log("1351 opening and closing quotes matched!"),b.attribClosingQuoteAt=F,b.attribValueEndAt=F,b.attribValue=o.slice(b.attribValueStartAt,F),b.attribEnd=F+1,console.log("1357 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","attrib.attribClosingQuoteAt","[",39,"m")," = ",b.attribClosingQuoteAt,"; ","[".concat(33,"m","attrib.attribValueEndAt","[",39,"m")," = ").concat(b.attribValueEndAt,"; ","[".concat(33,"m","attrib.attribValue","[",39,"m")," = ").concat(b.attribValue,"; ","[".concat(33,"m","attrib.attribEnd","[",39,"m")," = ").concat(b.attribEnd)),f.attribs.push(_(b)),w()):null===b.attribOpeningQuoteAt&&(!o[F].trim().length||["/",">"].includes(o[F])||B.includes(o[F])&&B.includes(o[F+1]))&&(console.log("1380 opening quote was missing, terminate attr val here"),b.attribValueEndAt=F,b.attribValue=o.slice(b.attribValueStartAt,F),b.attribEnd=F,console.log("1386 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","attrib.attribValueEndAt","[",39,"m")," = ",b.attribValueEndAt,"; ","[".concat(33,"m","attrib.attribValue","[",39,"m")," = ").concat(b.attribValue,"; ","[".concat(33,"m","attrib.attribEnd","[",39,"m")," = ").concat(b.attribEnd)),f.attribs.push(_(b)),w())),!l&&"html"===f.type&&!x(b.attribValueStartAt)&&x(b.attribNameEndAt)&&b.attribNameEndAt<=F&&o[F].trim().length&&(console.log("1412 inside catching attr value start clauses"),"="!==o[F]||"'\"=".includes(o[k(o,F)])||B.includes(o[k(o,F)])?"'\"".includes(o[F])&&(b.attribOpeningQuoteAt=F,o[F+1]&&(b.attribValueStartAt=F+1),console.log("1430 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","attrib.attribOpeningQuoteAt","[",39,"m")," = ",b.attribOpeningQuoteAt,"; ","[".concat(33,"m","attrib.attribValueStartAt","[",39,"m")," = ").concat(b.attribValueStartAt))):(b.attribValueStartAt=k(o,F),console.log("1420 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","attrib.attribValueStartAt","[",39,"m")," = ",b.attribValueStartAt)))),">"===o[F]&&"html"===f.type&&null!==b.attribStart&&null===b.attribEnd){console.log("1461 ".concat("[".concat(31,"m","██","[",39,"m")," bracket within attribute's value"));var Q=!1;if(o[F+1])for(var G=F+1;G<u;G++){if(console.log("1480 ".concat("[".concat(36,"m","str[".concat(G,"] = ").concat(JSON.stringify(o[G],null,0)),"[",39,"m"))),null!==b.attribOpeningQuoteAt&&o[G]===o[b.attribOpeningQuoteAt]){console.log("1493 closing quote (".concat(o[b.attribOpeningQuoteAt],") found, ","[".concat(31,"m","BREAK","[",39,"m"))),G!==F+1&&"="!==o[G-1]&&(Q=!0,console.log("1500 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","thisIsRealEnding","[",39,"m")," = ",Q)));break}if(">"===o[G])break;if("<"===o[G]){Q=!0,console.log("1511 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","thisIsRealEnding","[",39,"m")," = ",Q)),A.pop(),console.log("1518 ".concat("[".concat(31,"m","POP","[",39,"m")," ","[".concat(33,"m","layers","[",39,"m"),", now:\n",JSON.stringify(A,null,4))),console.log("1525 break");break}if(!o[G+1]){Q=!0,console.log("1531 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","thisIsRealEnding","[",39,"m")," = ",Q)),console.log("1534 break");break}}else console.log("1539 string ends so this was the bracket"),Q=!0;Q&&(f.end=F+1,console.log("1555 ".concat("[".concat(32,"m","SET","[",39,"m")," ","[".concat(33,"m","token.end","[",39,"m")," = ",f.end)),Number.isInteger(b.attribValueStartAt)&&b.attribValueStartAt<F&&o.slice(b.attribValueStartAt,F).trim().length?(b.attribValueEndAt=F,b.attribValue=o.slice(b.attribValueStartAt,F)):b.attribValueStartAt=null,b.attribEnd=F,console.log("1577 ".concat("[".concat(32,"m","SET","[",39,"m"),"  ","[".concat(33,"m","attrib.attribEnd","[",39,"m")," = ",b.attribEnd)),console.log("1584 ".concat("[".concat(32,"m","attrib wipe, push and reset","[",39,"m"))),f.attribs.push(_(b)),w())}r&&(console.log("1613 ".concat("[".concat(32,"m","PING","[",39,"m")," ",JSON.stringify({type:f.type,chr:o[F],i:F},null,4))),E={type:f.type,chr:o[F],i:F},r&&r(E)),o[F+1]||null===f.start||(f.end=F+1,J(f)),console.log("".concat("[".concat(90,"m","==========================================\n██ token: ".concat(JSON.stringify(f,null,4)).concat(null!==b.attribStart?"\n██ attrib: ".concat(JSON.stringify(b,null,4)):"").concat(A.length?"\n██ layers: ".concat(JSON.stringify(A,null,4)):""),"[",39,"m"),l?"\n".concat("[".concat(31,"m","DO NOTHING UNTIL ".concat(l),"[",39,"m")):""))}}}));
