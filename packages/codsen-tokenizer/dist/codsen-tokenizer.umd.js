/**
 * codsen-tokenizer
 * Tokenizer for mixed inputs aiming at broken code, especially HTML & CSS
 * Version: 1.0.0
 * Author: Roy Revelt, Codsen Ltd
 * License: MIT
 * Homepage: https://gitlab.com/codsen/codsen/tree/master/packages/codsen-tokenizer
 */

!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t=t||self).codsenTokenizer=n()}(this,(function(){"use strict";function t(n){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}var n="[object Object]";var e,r,o=Function.prototype,s=Object.prototype,c=o.toString,u=s.hasOwnProperty,i=c.call(Object),l=s.toString,f=(e=Object.getPrototypeOf,r=Object,function(t){return e(r(t))});var a=function(t){if(!function(t){return!!t&&"object"==typeof t}(t)||l.call(t)!=n||function(t){var n=!1;if(null!=t&&"function"!=typeof t.toString)try{n=!!(t+"")}catch(t){}return n}(t))return!1;var e=f(t);if(null===e)return!0;var r=u.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&c.call(r)==i};function p(t,n=0){const e=n?t.slice(n):t;let r=!1;return/^<\s*\w+\s*\/?\s*>/g.test(e)?r=!0:/^<\s*\w+\s+\w+\s*=\s*['"]/g.test(e)?r=!0:/^<\s*\/?\s*\w+\s*\/?\s*>/g.test(e)?r=!0:/^<\s*\w+(?:\s*\w+)*\s*\w+=['"]/g.test(e)&&(r=!0),"string"==typeof t&&n<t.length&&r}function g(t){return"string"==typeof t}var y={reportProgressFunc:null,reportProgressFuncFrom:0,reportProgressFuncTo:100},h="{}%-$_()*|";function d(t){for(var n="",e=0,r=t.length;e<r;e++)n="{"===t[e]?"}".concat(n):"("===t[e]?")".concat(n):"".concat(t[e]).concat(n);return n}return function(n,e,r){if(!g(n))throw void 0===n?new Error("html-crush: [THROW_ID_01] the first input argument is completely missing! It should be given as string."):new Error('html-crush: [THROW_ID_02] the first input argument must be string! It was given as "'.concat(t(n),'", equal to:\n').concat(JSON.stringify(n,null,4)));if("function"!=typeof e)throw new Error("html-crush: [THROW_ID_03] the second input argument, callback function, should be a function but it was given as type ".concat(t(e),", equal to ").concat(JSON.stringify(e,null,4)));if(r&&!a(r))throw new Error("html-crush: [THROW_ID_04] the third input argument, options object, should be a plain object but it was given as type ".concat(t(r),", equal to ").concat(JSON.stringify(r,null,4)));var o,s,c=Object.assign({},y,r),u=0,i=n.length,l=Math.floor(i/2),f={},m={type:null,start:null,end:null,tail:null};function b(){f=Object.assign({},m)}b();var v=[];function w(t){e(t),b()}function O(t,n){null!==t.start&&(t.end=n,w(t))}for(var F=0;F<i;F++){if(c.reportProgressFunc&&(i>1e3&&i<2e3?F===l&&c.reportProgressFunc(Math.floor((c.reportProgressFuncTo-c.reportProgressFuncFrom)/2)):i>=2e3&&(o=c.reportProgressFuncFrom+Math.floor(F/i))!==u&&(u=o,c.reportProgressFunc(o))),Number.isInteger(s)&&F>=s&&(s=!1),!s&&["html","text"].includes(f.type)&&['"',"'"].includes(n[F])&&(v.length&&v[v.length-1]===n[F]?v.pop():v.push(n[F])),!s)if(!v.length&&"<"===n[F]&&p(n,F))O(f,F),f.start=F,f.type="html";else if("esp"!==f.type&&h.includes(n[F])&&n[F+1]&&h.includes(n[F+1])){O(f,F),f.start=F,f.type="esp";for(var j="",P=F;P<i&&h.includes(n[P]);P++)j+=n[P];s=F+j.length,f.tail=d(j)}else null!==f.start&&f.end!==F||(f.end&&w(f),f.start=F,f.type="text");if(!s)if("html"!==f.type||v.length||">"!==n[F]){if("esp"===f.type&&null===f.end&&g(f.tail)&&f.tail.includes(n[F])){for(var S="",_=F;_<i&&h.includes(n[_]);_++)S+=n[_];f.end=F+S.length,s=F+S.length}}else f.end=F+1;n[F+1]||null===f.start||(f.end=F+1,w(f))}}}));
