/**
 * object-flatten-referencing
 * Flatten complex nested objects according to a reference objects
 * Version: 4.12.1
 * Author: Roy Revelt, Codsen Ltd
 * License: MIT
 * Homepage: https://codsen.com/os/object-flatten-referencing/
 */

import e from"lodash.clonedeep";import{strIndexesOfPlus as r}from"str-indexes-of-plus";import t from"matcher";import n from"lodash.isplainobject";function i(e){return"string"==typeof e}function a(r,t){if(0===arguments.length||0===Object.keys(r).length)return[];const o=e(r);let s=[];return n(o)&&Object.keys(o).forEach((e=>{n(o[e])&&(o[e]=a(o[e],t)),Array.isArray(o[e])&&(s=s.concat(o[e].map((r=>e+t.objectKeyAndValueJoinChar+r)))),i(o[e])&&s.push(e+t.objectKeyAndValueJoinChar+o[e])})),s}function o(r,t,n,a){if(0===arguments.length||0===r.length)return"";const o=e(r);let s="";if(o.length>0)if(a){for(let e=0,r=o.length;e<r;e++)if(i(o[e])){let r;r="",t.mergeArraysWithLineBreaks&&e>0&&(!t.mergeWithoutTrailingBrIfLineContainsBr||"string"!=typeof o[e-1]||t.mergeWithoutTrailingBrIfLineContainsBr&&void 0!==o[e-1]&&!o[e-1].toLowerCase().includes("<br"))&&(r=`<br${t.xhtml?" /":""}>`),s+=r+(n?t.wrapHeadsWith:"")+o[e]+(n?t.wrapTailsWith:"")}else if(Array.isArray(o[e])&&o[e].length>0&&o[e].every(i)){let r="";t.mergeArraysWithLineBreaks&&s.length>0&&(r=`<br${t.xhtml?" /":""}>`),s=o[e].reduce(((e,i,a,o)=>{let s="";return a!==o.length-1&&(s=" "),e+(0===a?r:"")+(n?t.wrapHeadsWith:"")+i+(n?t.wrapTailsWith:"")+s}),s)}}else s=o.reduce(((e,r,i,a)=>{let o="";t.mergeArraysWithLineBreaks&&i>0&&(o=`<br${t.xhtml?" /":""}>`);let s="";return i!==a.length-1&&(s=" "),e+(0===i?o:"")+(n?t.wrapHeadsWith:"")+r+(n?t.wrapTailsWith:"")+s}),s);return s}function s(e){return i(e)?e.length>0?[e]:[]:e}var h="4.12.1";function l(e){return null!=e}function p(e){return"string"==typeof e}const f={wrapHeadsWith:"%%_",wrapTailsWith:"_%%",dontWrapKeys:[],dontWrapPaths:[],xhtml:!0,preventDoubleWrapping:!0,preventWrappingIfContains:[],objectKeyAndValueJoinChar:".",wrapGlobalFlipSwitch:!0,ignore:[],whatToDoWhenReferenceIsMissing:0,mergeArraysWithLineBreaks:!0,mergeWithoutTrailingBrIfLineContainsBr:!0,enforceStrictKeyset:!0};function c(i,h,c){if(0===arguments.length)throw new Error("object-flatten-referencing/ofr(): [THROW_ID_01] all inputs missing!");if(1===arguments.length)throw new Error("object-flatten-referencing/ofr(): [THROW_ID_02] reference object missing!");if(l(c)&&!n(c))throw new Error("object-flatten-referencing/ofr(): [THROW_ID_03] third input, options object must be a plain object. Currently it's: "+typeof c);const g={...f,...c};function W(i,s,h,f=!0,c=!0,g=""){let w=e(i);const y=e(s);return h.wrapGlobalFlipSwitch||(f=!1),n(w)?Object.keys(w).forEach((e=>{const r=g+(0===g.length?e:`.${e}`);if(0===h.ignore.length||!h.ignore.includes(e))if(h.wrapGlobalFlipSwitch&&(f=!0,h.dontWrapKeys.length>0&&(f=f&&!h.dontWrapKeys.some((r=>t.isMatch(e,r,{caseSensitive:!0})))),h.dontWrapPaths.length>0&&(f=f&&!h.dontWrapPaths.some((e=>e===r))),h.preventWrappingIfContains.length>0&&"string"==typeof w[e]&&(f=f&&!h.preventWrappingIfContains.some((r=>w[e].includes(r))))),l(y[e])||!l(y[e])&&2===h.whatToDoWhenReferenceIsMissing)if(Array.isArray(w[e]))if(2===h.whatToDoWhenReferenceIsMissing||p(y[e]))w[e]=o(w[e],h,f,c);else{if(w[e].every((e=>"string"==typeof e||Array.isArray(e)))){let r=!0;w[e].forEach((e=>{Array.isArray(e)&&!e.every(p)&&(r=!1)})),r&&(c=!1)}w[e]=W(w[e],y[e],h,f,c,r)}else n(w[e])?w[e]=2===h.whatToDoWhenReferenceIsMissing||p(y[e])?o(a(w[e],h),h,f,c):W(w[e],y[e],f?h:{...h,wrapGlobalFlipSwitch:!1},f,c,r):p(w[e])&&(w[e]=W(w[e],y[e],h,f,c,r));else if(typeof w[e]!=typeof y[e]&&1===h.whatToDoWhenReferenceIsMissing)throw new Error(`object-flatten-referencing/ofr(): [THROW_ID_06] reference object does not have the key ${e} and we need it. TIP: Turn off throwing via opts.whatToDoWhenReferenceIsMissing.`)})):Array.isArray(w)?Array.isArray(y)?w.forEach(((e,r)=>{w[r]=l(w[r])&&l(y[r])?W(w[r],y[r],h,f,c,`${g}[${r}]`):W(w[r],y[0],h,f,c,`${g}[${r}]`)})):p(y)&&(w=o(w,h,f,c)):p(w)&&w.length>0&&(h.wrapHeadsWith||h.wrapTailsWith)&&(h.preventDoubleWrapping&&(""!==h.wrapHeadsWith&&r(w,h.wrapHeadsWith.trim()).length||""!==h.wrapTailsWith&&r(w,h.wrapTailsWith.trim()).length)||(w=(f?h.wrapHeadsWith:"")+w+(f?h.wrapTailsWith:""))),w}return g.dontWrapKeys=s(g.dontWrapKeys),g.preventWrappingIfContains=s(g.preventWrappingIfContains),g.dontWrapPaths=s(g.dontWrapPaths),g.ignore=s(g.ignore),"number"!=typeof g.whatToDoWhenReferenceIsMissing&&(g.whatToDoWhenReferenceIsMissing=+g.whatToDoWhenReferenceIsMissing||0),W(i,h,g)}export{s as arrayiffyString,f as defaults,o as flattenArr,a as flattenObject,c as flattenReferencing,h as version};
