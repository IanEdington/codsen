/**
 * string-collapse-white-space
 * Replace chunks of whitespace with a single spaces
 * Version: 8.0.5
 * Author: Roy Revelt, Codsen Ltd
 * License: MIT
 * Homepage: https://codsen.com/os/string-collapse-white-space/
 */

import{rApply as t}from"ranges-apply";import{Ranges as e}from"ranges-push";import{right as n}from"string-left-right";var r="8.0.5";const i={trimStart:!0,trimEnd:!0,trimLines:!1,trimnbsp:!1,removeEmptyLines:!1,limitConsecutiveEmptyLinesTo:0,enforceSpacesOnly:!1,cb:({suggested:t})=>t},l=["suggested","whiteSpaceStartsAt","whiteSpaceEndsAt","str"];function s(r,l){if("string"!=typeof r)throw Error(`string-collapse-white-space/collapse(): [THROW_ID_01] The input is not string but ${typeof r}, equal to: ${JSON.stringify(r,null,4)}`);if(l&&"object"!=typeof l)throw Error(`string-collapse-white-space/collapse(): [THROW_ID_02] The opts is not a plain object but ${typeof l}, equal to:\n${JSON.stringify(l,null,4)}`);if(!r.length)return{result:"",ranges:null};const s=new e,c="Â ",u={...i,...l};function p(t,e){if("function"==typeof u.cb){const n=u.cb({suggested:t,...e});Array.isArray(n)&&s.push(...n)}else s.push(...t)}let a=null,o=null,m=null,S=null,f=null,h=!1;const g=[];let d=0;for(let t=0,e=r.length;e>=t;t++){if(("\r"===r[t]||"\n"===r[t]&&"\r"!==r[t-1])&&(d+=1,null===S&&(S=t),f="\r"===r[t]&&"\n"===r[t+1]?t+2:t+1),u.trimnbsp||r[t]!==c||h||(h=!0),null!==a&&" "!==r[t]){const e=a&&o||!o&&(!u.trimStart||!u.trimnbsp&&(r[t]===c||r[a-1]===c)),i=r[t]||!u.trimEnd||!u.trimnbsp&&(r[t]===c||r[a-1]===c),l=!u.enforceSpacesOnly||(!r[a-1]||r[a-1].trim())&&(!r[t]||r[t].trim());if(t-1>a&&e&&i&&l){const e=a;let i=t,l=" ";u.trimLines&&(!a||!r[t]||r[a-1]&&"\r\n".includes(r[a-1])||r[t]&&"\r\n".includes(r[t]))&&(l=null),l&&" "===r[a]&&(i-=1,l=null),(!a&&u.trimStart||!r[t]&&u.trimEnd)&&(i=t),g.push([l?[e,i,l]:[e,i],{whiteSpaceStartsAt:o,whiteSpaceEndsAt:n(r,t-1)||t,str:r}])}}if(null===a&&" "===r[t]&&(a=t),null===o&&r[t]&&!r[t].trim()&&(o=t),null!==m&&("\n\r".includes(r[t])||!r[t]||r[t].trim()||!u.trimnbsp&&!u.enforceSpacesOnly&&r[t]===c)&&(m||!u.trimStart||u.enforceSpacesOnly&&h)&&(r[t]||!u.trimEnd||u.enforceSpacesOnly&&h)){if(u.enforceSpacesOnly&&(t>m+1||" "!==r[m])){let e=m,n=t,i=" ";" "===r[n-1]?(n-=1,i=null):" "===r[m]&&(e+=1,i=null),((u.trimStart||u.trimLines)&&!m||(u.trimEnd||u.trimLines)&&!r[t])&&(i=null),p(i?[e,n,i]:[e,n],{whiteSpaceStartsAt:o,whiteSpaceEndsAt:t,str:r})}!u.trimLines||m&&!"\r\n".includes(r[m-1])&&r[t]&&!"\r\n".includes(r[t])||!u.trimnbsp&&h||p([m,t],{whiteSpaceStartsAt:o,whiteSpaceEndsAt:n(r,t-1)||t,str:r}),m=null}if(null!==m||"\r\n".includes(r[t])||!r[t]||r[t].trim()||!u.trimnbsp&&r[t]===c&&!u.enforceSpacesOnly||(m=t),null!==o&&(!r[t]||r[t].trim())){if((!o&&(u.trimStart||u.trimLines&&null===S)||!r[t]&&(u.trimEnd||u.trimLines&&null===S))&&(u.trimnbsp||!h||u.enforceSpacesOnly))p([o,t],{whiteSpaceStartsAt:o,whiteSpaceEndsAt:t,str:r});else{let e=!1;if(u.removeEmptyLines&&null!==S&&d>(u.limitConsecutiveEmptyLinesTo||0)+1){e=!0;let n=S,i=f||r.length,l=(""+("\r"===r[S]&&"\n"===r[S+1]?"\r\n":r[S])).repeat((u.limitConsecutiveEmptyLinesTo||0)+1);r.endsWith(l,f)?(i-=l.length||0,l=null):r.startsWith(l,S)&&(n+=l.length,l=null),p(l?[n,i,l]:[n,i],{whiteSpaceStartsAt:o,whiteSpaceEndsAt:t,str:r})}if(g.length){for(;g.length;)p(...g.shift(),{whiteSpaceStartsAt:o,whiteSpaceEndsAt:t,str:r});e=!0}e||p(null,{whiteSpaceStartsAt:o,whiteSpaceEndsAt:t,str:r})}o=null,m=null,h=!1,d&&(d=0,S=null,f=null)}null!==a&&" "!==r[t]&&(a=null)}return{result:t(r,s.current()),ranges:s.current()}}export{l as cbSchema,s as collapse,i as defaults,r as version};
