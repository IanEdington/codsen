/**
 * string-remove-widows
 * Helps to prevent widow words in a text
 * Version: 1.7.3
 * Author: Roy Revelt, Codsen Ltd
 * License: MIT
 * Homepage: https://codsen.com/os/string-remove-widows/
 */

import{matchRightIncl as t}from"string-match-left-right";import{arrayiffy as e}from"arrayiffy-if-string";import{left as r,right as o}from"string-left-right";import{Ranges as i}from"ranges-push";import{rApply as s}from"ranges-apply";var n="1.7.3";const a=[{heads:"{{",tails:"}}"},{heads:["{% if","{%- if"],tails:["{% endif","{%- endif"]},{heads:["{% for","{%- for"],tails:["{% endfor","{%- endfor"]},{heads:["{%","{%-"],tails:["%}","-%}"]},{heads:"{#",tails:"#}"}],g=[{heads:"{{",tails:"}}"}],u=[{heads:["<%","<%=","<%-"],tails:["%>","=%>","-%>"]}],c=["abbr","address","area","article","aside","audio","base","bdi","bdo","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","doctype","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","math","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","param","picture","pre","progress","rb","rp","rt","rtc","ruby","samp","script","section","select","slot","small","source","span","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","ul","var","video","wbr","xml"],d={removeWidowPreventionMeasures:!1,convertEntities:!0,targetLanguage:"html",UKPostcodes:!1,hyphens:!0,minWordCount:4,minCharCount:5,ignore:[],reportProgressFunc:null,reportProgressFuncFrom:0,reportProgressFuncTo:100,tagRanges:[]};function l(n,l){function m(t){return"string"==typeof t}const h=Date.now();if(!m(n))throw Error(void 0===n?"string-remove-widows: [THROW_ID_01] the first input argument is completely missing! It should be given as string.":`string-remove-widows: [THROW_ID_02] the first input argument must be string! It was given as "${typeof n}", equal to:\n${JSON.stringify(n,null,4)}`);if(l&&"object"!=typeof l)throw Error(`string-remove-widows: [THROW_ID_03] the second input argument, options object, should be a plain object but it was given as type ${typeof l}, equal to ${JSON.stringify(l,null,4)}`);const p=n.length,f=new i({mergeType:2}),v=["."],y=/[A-Z]{1,2}[0-9][0-9A-Z]?$/,b=/^[0-9][A-Z]{2}/,W=.06;let w,A,F,L,P,C,E,j,T,k=0,M=0,R=0;const D={...d,...l},I={removeWidows:!1,convertEntities:!1};if(D.ignore&&(Array.isArray(D.ignore)||m(D.ignore))){if(D.ignore=e(D.ignore),D.ignore.includes("all"))D.ignore=D.ignore.concat(a.concat(u));else if(D.ignore.some((t=>m(t)))){let t=[];D.ignore=D.ignore.filter((e=>m(e)&&e.length?(["nunjucks","jinja","liquid"].includes(e.trim().toLowerCase())?t=t.concat(a):["hugo"].includes(e.trim().toLowerCase())?t=t.concat(g):["hexo"].includes(e.trim().toLowerCase())&&(t=t.concat(u)),!1):"object"==typeof e||void 0)),t.length&&(D.ignore=D.ignore.concat(t))}}else D.ignore=[];let _=100;function O(t,e){let r=" ";D.removeWidowPreventionMeasures?r=" ":D.convertEntities&&(r="&nbsp;",m(D.targetLanguage)&&("css"===D.targetLanguage.trim().toLowerCase()?r="\\00A0":"js"===D.targetLanguage.trim().toLowerCase()&&(r="\\u00A0"))),n.slice(t,e)!==r&&f.push(t,e,r)}function $(){M=0,R=0,A=void 0,F=void 0,L=void 0,P=void 0,C=void 0,E=void 0}D.reportProgressFunc&&(_=Math.floor(D.reportProgressFuncTo-(D.reportProgressFuncTo-D.reportProgressFuncFrom)*W-D.reportProgressFuncFrom)),$();for(let e=0;p>=e;e++){if(!j&&Array.isArray(D.ignore)&&D.ignore.length&&D.ignore.some(((t,r)=>{if(Array.isArray(t.heads)&&t.heads.some((t=>n.startsWith(t,e)))||m(t.heads)&&n.startsWith(t.heads,e))return M+=1,j=D.ignore[r].tails,!0})),!j&&T&&T===e&&(M+=1,T=void 0),"function"==typeof D.reportProgressFunc&&(w=D.reportProgressFuncFrom+Math.floor(e/p*_),w!==k&&(k=w,D.reportProgressFunc(w))),!j&&e&&n[e]&&n[e].trim()&&(!n[e-1]||n[e-1]&&!n[e-1].trim())&&(P=e),!j&&n[e]&&n[e].trim()&&(R+=1),j||!D.hyphens||!("-—–".includes(n[e])||n.startsWith("&ndash;",e)||n.startsWith("\\2013",e)||n.startsWith("\\u2013",e)||n.startsWith("&mdash;",e)||n.startsWith("\\2014",e)||n.startsWith("\\u2014",e))||!n[e+1]||n[e+1].trim()&&"&"!==n[e]||n[e-1]&&!n[e-1].trim()&&n[r(n,e)]&&(O(r(n,e)+1,e),I.removeWidows=!0),j||!n.startsWith("&nbsp;",e)&&!n.startsWith("&#160;",e)||(C=e,E=e+6,n[e+6]&&n[e+6].trim()&&(T=e+6),D.convertEntities?"css"!==D.targetLanguage&&"js"!==D.targetLanguage||(f.push(e,e+6,"css"===D.targetLanguage?"\\00A0":"\\u00A0"),I.convertEntities=!0):(f.push(e,e+6," "),I.convertEntities=!0)),!j&&n[e+4]&&"\\"===n[e]&&"0"===n[e+1]&&"0"===n[e+2]&&"A"===n[e+3].toUpperCase()&&"0"===n[e+4]&&(C=e,E=e+5,n[e+5]&&n[e+5].trim()&&(T=e+5),D.convertEntities?"html"!==D.targetLanguage&&"js"!==D.targetLanguage||(f.push(e,e+5,"html"===D.targetLanguage?"&nbsp;":"\\u00A0"),I.convertEntities=!0):(f.push(e,e+5," "),I.convertEntities=!0)),!j&&"\\"===n[e]&&n[e+1]&&"u"===n[e+1].toLowerCase()&&"0"===n[e+2]&&"0"===n[e+3]&&n[e+4]&&"A"===n[e+4].toUpperCase()&&"0"===n[e+5]&&(C=e,E=e+6,n[e+6]&&n[e+6].trim()&&(T=e+6),D.convertEntities?"html"!==D.targetLanguage&&"css"!==D.targetLanguage||f.push(e,e+6,"html"===D.targetLanguage?"&nbsp;":"\\00A0"):f.push(e,e+6," ")),j||" "!==n[e]||(C=e,E=e+1,D.convertEntities&&f.push(e,e+1,"css"===D.targetLanguage?"\\00A0":"js"===D.targetLanguage?"\\u00A0":"&nbsp;")),j||!n[e]||!n[e].trim()||n[e-1]&&n[e-1].trim()||(M+=1),!j&&(!n[e]||"\r\n".includes(n[e])||("\n"===n[e]||"\r"===n[e]||"\r"===n[e]&&"\n"===n[e+1])&&n[e-1]&&v.includes(n[r(n,e)]))){if(!(D.minWordCount&&D.minWordCount>M||D.minCharCount&&D.minCharCount>R)){let t,e;void 0!==L&&void 0!==P&&void 0!==C&&void 0!==E?L>C?(t=L,e=P):(t=C,e=E):void 0!==L&&void 0!==P?(t=L,e=P):void 0!==C&&void 0!==E&&(t=C,e=E),t&&e||!A||!F||(t=A,e=F),t&&e&&(O(t,e),I.removeWidows=!0)}$()}D.UKPostcodes&&n[e]&&!n[e].trim()&&n[e-1]&&n[e-1].trim()&&y.test(n.slice(0,e))&&n[o(n,e)]&&b.test(n.slice(o(n,e)))&&(O(e,o(n,e)),I.removeWidows=!0),j||!n[e]||n[e].trim()||!n[e-1]||!n[e-1].trim()||!(void 0===L||n[L-1]&&n[L-1].trim())||"/>".includes(n[o(n,e)])||n.slice(0,e).trim().endsWith("br")||n.slice(0,e).trim().endsWith("hr")||n.slice(0,e).endsWith("<")&&c.some((t=>n.startsWith(t,o(n,e))))||(A=L,F=P,L=e,P=void 0,void 0===C&&void 0===E||(C=void 0,E=void 0));let i="";j&&(!m(j)||j.length&&!n.startsWith(j,e)?!Array.isArray(j)||j.length&&!j.some((t=>{if(n.startsWith(t,e))return i=t,!0}))||(j=void 0,e+=i.length,Array.isArray(D.ignore)&&D.ignore.length&&n[e+1]&&D.ignore.some((r=>t(n,e,r.tails,{trimBeforeMatching:!0,cb:(t,r,o)=>(o&&(e=o-1,n[e+1]&&n[e+1].trim()&&(M+=1)),!0)})))):j=void 0),n[e]&&"\r\n".includes(n[e])&&(M=0,R=0),Array.isArray(D.tagRanges)&&D.tagRanges.length&&D.tagRanges.some((t=>{if(e>=t[0]&&t[1]>=e&&t[1]-1>e)return e=t[1]-1,!0}))}const q=s(n,f.current(),D.reportProgressFunc?t=>{w=Math.floor(.94*(D.reportProgressFuncTo-D.reportProgressFuncFrom)+t/100*(D.reportProgressFuncTo-D.reportProgressFuncFrom)*W),w!==k&&(k=w,D.reportProgressFunc(w))}:void 0);return q.split("").forEach(((t,e)=>{})),{res:q,ranges:f.current(),log:{timeTakenInMiliseconds:Date.now()-h},whatWasDone:I}}export{d as defaults,l as removeWidows,n as version};
