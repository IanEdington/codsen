/**
 * html-img-alt
 * Adds missing alt attributes to img tags. Non-parsing.
 * Version: 1.5.3
 * Author: Roy Revelt, Codsen Ltd
 * License: MIT
 * Homepage: https://codsen.com/os/html-img-alt/
 */

import{unfancy as t}from"string-unfancy";import{rApply as e}from"ranges-apply";import{Ranges as r}from"ranges-push";import{checkTypesMini as i}from"check-types-mini";var n="1.5.3";function a(n,a){if("string"!=typeof n)throw new TypeError(`html-img-alt/alts(): [THROW_ID_01] Input must be string! Currently its type is: ${typeof n}, equal to: ${JSON.stringify(n,null,4)}`);if(a&&"[object Object]"!==Object.prototype.toString.call(a))throw new TypeError(`html-img-alt/alts(): [THROW_ID_02] Options object must be a plain object! Currently its type is: ${typeof a}, equal to: ${JSON.stringify(a,null,4)}`);let l,o=!1,d=!1,s=0,c=0,m=0,u=0,f=!1,g=0,p=0,h=0,w=!1,y=null;const $=new r,O=new r,T={unfancyTheAltContents:!0},b={...T,...a};i(b,T,{msg:"html-img-alt/alts(): [THROW_ID_03]"});for(let e=0,r=n.length;e<r;e++){n[e].charCodeAt(0);if("<img"==`${n[e]}${n[e+1]}${n[e+2]}${n[e+3]}`){if(o)throw new TypeError(`html-img-alt/alts(): [THROW_ID_02] Something is wrong with the code - there's an image tag within an image tag. First image tag was: ${n.slice(s-20,s+20)}, then before it was closed, we've got this: ${n.slice(e-20,e+20)}`);o=!0,s=e}if(o&&"/"===n[e]&&(m=e),o&&!d&&("alt"==`${n[e]}${n[e+1]}${n[e+2]}`?y=e:"alt"==`${n[e-3]}${n[e-2]}${n[e-1]}`&&(f=!0)),f&&""!==n[e].trim()&&"="!==n[e]&&'"'!==n[e]&&(f=!1),y&&e===y+3&&(g=e),"="===n[e]&&(y&&(g=0,p=e+1),O.current()&&O.current().length&&O.wipe(),d&&'"'===n[e+1]&&(d=!1,u=0)),c&&""!==n[e].trim()){if(c<e-1+(">"===n[e]||"'"===n[e]||m||g||p||h?1:0)&&(d?O.add(c,e-1+(">"===n[e]||"'"===n[e]||m||g||p||h?1:0)):$.add(c,e-1+(">"===n[e]||"'"===n[e]||m||g||p||h?1:0)),">"!==n[e]&&"/"!==n[e]||(w=!0),g&&"="!==n[e]&&e>=g||p&&'"'!==n[e]&&e>=p)){const t="",e=g||p;let r="";g&&(r+="="),d||$.add(e,e,`${r}""${t}`),g=0,p=0}c=0}if('"'===n[e]&&(d=!d,e===p&&(h=e+1)),'"'===n[e])if(p&&e>=p)h=p,p=0,f&&(u=e+1,f=!1),"/"!==n[e+1].trim()&&">"!==n[e+1].trim()||(w=!0,l=!1);else if(h&&e>=h){if(O.wipe(),h=0,">"!==n[e+1]&&"/"!==n[e+1]||(w=!0,l=!1),u&&b.unfancyTheAltContents){const r=n.slice(u,e);t(r).trim()!==r&&$.add(u,e,t(r).trim())}u=0}o&&!d&&"'"===n[e]&&($.add(e,e+1),"/"!==n[e+1]&&">"!==n[e+1]||(w=!0)),o&&">"===n[e]&&(s=0,d=!1,null===y&&(m?$.add(m,m,' alt="" '):$.add(e,e,' alt="" '),l=!1,w=!1),m||g!==e?m&&g===e-1&&($.add(e-1,e-1,'="" '),l=!1):($.add(e,e,'="" '),l=!1),!m&&p&&p<=e?($.add(e,e,'"" '),w=!1):m&&p&&p<=e?($.add(e-1,e-1,'"" '),w=!1):!m&&h&&h<=e?($.add(e,e,'"'),w=!0,O.current()&&O.current().forEach((t=>{$.add(t[0],t[1],t[2])})),$.current(),O.wipe()):m&&h&&h<=e&&($.add(h+1,h+1,'"'),O.current()&&O.current().forEach((t=>{$.add(t[0],t[1],t[2])})),O.wipe(),$.current()),(l||w)&&(m?$.add(m,m," "):$.add(e,e," ")),o=!1,y=null,p=0,h=0,l=!1),m&&"/"!==n[e]&&""!==n[e].trim()&&(m=0,g=0,p=0,h=0),o&&""===n[e].trim()&&!c&&(c=e)}return $.current()&&$.current().length>0?e(n,$.current()):n}export{a as alts,n as version};
