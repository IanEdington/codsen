/**
 * html-table-patcher
 * Wraps any content between TR/TD tags in additional rows/columns to appear in browser correctly
 * Version: 2.0.0
 * Author: Roy Revelt, Codsen Ltd
 * License: MIT
 * Homepage: https://gitlab.com/codsen/codsen/tree/master/packages/html-table-patcher
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).htmlTablePatcher={})}(this,(function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function i(e){return"string"==typeof e&&e.length?e.includes(".")&&/^\d*$/.test(e.slice(e.lastIndexOf(".")+1))?`${e.slice(0,e.lastIndexOf(".")+1)}${+e.slice(e.lastIndexOf(".")+1)+1}`:/^\d*$/.test(e)?""+(+e+1):e:e}function s(e){if("string"==typeof e){if(!e.includes(".")||!e.slice(e.indexOf(".")+1).includes("."))return"0";let t=0;for(let r=e.length;r--;)if("."===e[r]&&(t+=1),2===t)return e.slice(0,r)}return e}Function.prototype.toString.call(Object);var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function l(e,t){return e(t={exports:{}},t.exports),t.exports}var u=l((function(e,t){var r="[object Arguments]",n="[object Function]",o="[object GeneratorFunction]",i="[object Map]",s="[object Set]",l=/\w*$/,u=/^\[object .+?Constructor\]$/,c=/^(?:0|[1-9]\d*)$/,d={};d[r]=d["[object Array]"]=d["[object ArrayBuffer]"]=d["[object DataView]"]=d["[object Boolean]"]=d["[object Date]"]=d["[object Float32Array]"]=d["[object Float64Array]"]=d["[object Int8Array]"]=d["[object Int16Array]"]=d["[object Int32Array]"]=d[i]=d["[object Number]"]=d["[object Object]"]=d["[object RegExp]"]=d[s]=d["[object String]"]=d["[object Symbol]"]=d["[object Uint8Array]"]=d["[object Uint8ClampedArray]"]=d["[object Uint16Array]"]=d["[object Uint32Array]"]=!0,d["[object Error]"]=d[n]=d["[object WeakMap]"]=!1;var g="object"==typeof a&&a&&a.Object===Object&&a,m="object"==typeof self&&self&&self.Object===Object&&self,p=g||m||Function("return this")(),f=t&&!t.nodeType&&t,h=f&&e&&!e.nodeType&&e,y=h&&h.exports===f;function b(e,t){return e.set(t[0],t[1]),e}function v(e,t){return e.add(t),e}function A(e,t,r,n){var o=-1,i=e?e.length:0;for(n&&i&&(r=e[++o]);++o<i;)r=t(r,e[o],o,e);return r}function w(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function _(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function O(e,t){return function(r){return e(t(r))}}function k(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var C,x=Array.prototype,T=Function.prototype,N=Object.prototype,$=p["__core-js_shared__"],E=(C=/[^.]+$/.exec($&&$.keys&&$.keys.IE_PROTO||""))?"Symbol(src)_1."+C:"",S=T.toString,I=N.hasOwnProperty,j=N.toString,V=RegExp("^"+S.call(I).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),M=y?p.Buffer:void 0,R=p.Symbol,F=p.Uint8Array,B=O(Object.getPrototypeOf,Object),W=Object.create,L=N.propertyIsEnumerable,P=x.splice,D=Object.getOwnPropertySymbols,q=M?M.isBuffer:void 0,H=O(Object.keys,Object),z=he(p,"DataView"),J=he(p,"Map"),Q=he(p,"Promise"),U=he(p,"Set"),Z=he(p,"WeakMap"),G=he(Object,"create"),K=we(z),X=we(J),Y=we(Q),ee=we(U),te=we(Z),re=R?R.prototype:void 0,ne=re?re.valueOf:void 0;function oe(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function ie(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function se(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function ae(e){this.__data__=new ie(e)}function le(e,t){var n=Oe(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&ke(e)}(e)&&I.call(e,"callee")&&(!L.call(e,"callee")||j.call(e)==r)}(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],o=n.length,i=!!o;for(var s in e)!t&&!I.call(e,s)||i&&("length"==s||ve(s,o))||n.push(s);return n}function ue(e,t,r){var n=e[t];I.call(e,t)&&_e(n,r)&&(void 0!==r||t in e)||(e[t]=r)}function ce(e,t){for(var r=e.length;r--;)if(_e(e[r][0],t))return r;return-1}function de(e,t,a,u,c,g,m){var p;if(u&&(p=g?u(e,c,g,m):u(e)),void 0!==p)return p;if(!Te(e))return e;var f=Oe(e);if(f){if(p=function(e){var t=e.length,r=e.constructor(t);t&&"string"==typeof e[0]&&I.call(e,"index")&&(r.index=e.index,r.input=e.input);return r}(e),!t)return function(e,t){var r=-1,n=e.length;t||(t=Array(n));for(;++r<n;)t[r]=e[r];return t}(e,p)}else{var h=be(e),y=h==n||h==o;if(Ce(e))return function(e,t){if(t)return e.slice();var r=new e.constructor(e.length);return e.copy(r),r}(e,t);if("[object Object]"==h||h==r||y&&!g){if(w(e))return g?e:{};if(p=function(e){return"function"!=typeof e.constructor||Ae(e)?{}:(t=B(e),Te(t)?W(t):{});var t}(y?{}:e),!t)return function(e,t){return pe(e,ye(e),t)}(e,function(e,t){return e&&pe(t,Ne(t),e)}(p,e))}else{if(!d[h])return g?e:{};p=function(e,t,r,n){var o=e.constructor;switch(t){case"[object ArrayBuffer]":return me(e);case"[object Boolean]":case"[object Date]":return new o(+e);case"[object DataView]":return function(e,t){var r=t?me(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(e,t){var r=t?me(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}(e,n);case i:return function(e,t,r){return A(t?r(_(e),!0):_(e),b,new e.constructor)}(e,n,r);case"[object Number]":case"[object String]":return new o(e);case"[object RegExp]":return function(e){var t=new e.constructor(e.source,l.exec(e));return t.lastIndex=e.lastIndex,t}(e);case s:return function(e,t,r){return A(t?r(k(e),!0):k(e),v,new e.constructor)}(e,n,r);case"[object Symbol]":return a=e,ne?Object(ne.call(a)):{}}var a}(e,h,de,t)}}m||(m=new ae);var O=m.get(e);if(O)return O;if(m.set(e,p),!f)var C=a?function(e){return function(e,t,r){var n=t(e);return Oe(e)?n:function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}(n,r(e))}(e,Ne,ye)}(e):Ne(e);return function(e,t){for(var r=-1,n=e?e.length:0;++r<n&&!1!==t(e[r],r,e););}(C||e,(function(r,n){C&&(r=e[n=r]),ue(p,n,de(r,t,a,u,n,e,m))})),p}function ge(e){return!(!Te(e)||(t=e,E&&E in t))&&(xe(e)||w(e)?V:u).test(we(e));var t}function me(e){var t=new e.constructor(e.byteLength);return new F(t).set(new F(e)),t}function pe(e,t,r,n){r||(r={});for(var o=-1,i=t.length;++o<i;){var s=t[o],a=n?n(r[s],e[s],s,r,e):void 0;ue(r,s,void 0===a?e[s]:a)}return r}function fe(e,t){var r,n,o=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof t?"string":"hash"]:o.map}function he(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return ge(r)?r:void 0}oe.prototype.clear=function(){this.__data__=G?G(null):{}},oe.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},oe.prototype.get=function(e){var t=this.__data__;if(G){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return I.call(t,e)?t[e]:void 0},oe.prototype.has=function(e){var t=this.__data__;return G?void 0!==t[e]:I.call(t,e)},oe.prototype.set=function(e,t){return this.__data__[e]=G&&void 0===t?"__lodash_hash_undefined__":t,this},ie.prototype.clear=function(){this.__data__=[]},ie.prototype.delete=function(e){var t=this.__data__,r=ce(t,e);return!(r<0)&&(r==t.length-1?t.pop():P.call(t,r,1),!0)},ie.prototype.get=function(e){var t=this.__data__,r=ce(t,e);return r<0?void 0:t[r][1]},ie.prototype.has=function(e){return ce(this.__data__,e)>-1},ie.prototype.set=function(e,t){var r=this.__data__,n=ce(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},se.prototype.clear=function(){this.__data__={hash:new oe,map:new(J||ie),string:new oe}},se.prototype.delete=function(e){return fe(this,e).delete(e)},se.prototype.get=function(e){return fe(this,e).get(e)},se.prototype.has=function(e){return fe(this,e).has(e)},se.prototype.set=function(e,t){return fe(this,e).set(e,t),this},ae.prototype.clear=function(){this.__data__=new ie},ae.prototype.delete=function(e){return this.__data__.delete(e)},ae.prototype.get=function(e){return this.__data__.get(e)},ae.prototype.has=function(e){return this.__data__.has(e)},ae.prototype.set=function(e,t){var r=this.__data__;if(r instanceof ie){var n=r.__data__;if(!J||n.length<199)return n.push([e,t]),this;r=this.__data__=new se(n)}return r.set(e,t),this};var ye=D?O(D,Object):function(){return[]},be=function(e){return j.call(e)};function ve(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||c.test(e))&&e>-1&&e%1==0&&e<t}function Ae(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||N)}function we(e){if(null!=e){try{return S.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function _e(e,t){return e===t||e!=e&&t!=t}(z&&"[object DataView]"!=be(new z(new ArrayBuffer(1)))||J&&be(new J)!=i||Q&&"[object Promise]"!=be(Q.resolve())||U&&be(new U)!=s||Z&&"[object WeakMap]"!=be(new Z))&&(be=function(e){var t=j.call(e),r="[object Object]"==t?e.constructor:void 0,n=r?we(r):void 0;if(n)switch(n){case K:return"[object DataView]";case X:return i;case Y:return"[object Promise]";case ee:return s;case te:return"[object WeakMap]"}return t});var Oe=Array.isArray;function ke(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!xe(e)}var Ce=q||function(){return!1};function xe(e){var t=Te(e)?j.call(e):"";return t==n||t==o}function Te(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Ne(e){return ke(e)?le(e):function(e){if(!Ae(e))return H(e);var t=[];for(var r in Object(e))I.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e)}e.exports=function(e){return de(e,!0,!0)}}));function c(e,t){return function(e,t,r){if("string"!=typeof e||!e.length)return null;if(t&&"number"==typeof t||(t=0),!e[t+1])return null;if(e[t+1]&&(!r&&e[t+1].trim()||r&&(e[t+1].trim()||"\n\r".includes(e[t+1]))))return t+1;if(e[t+2]&&(!r&&e[t+2].trim()||r&&(e[t+2].trim()||"\n\r".includes(e[t+2]))))return t+2;for(let n=t+1,o=e.length;n<o;n++)if(e[n]&&(!r&&e[n].trim()||r&&(e[n].trim()||"\n\r".includes(e[n]))))return n;return null}(e,t,!1)}function d(e,t){return function(e,t,r){if("string"!=typeof e||!e.length)return null;if(t&&"number"==typeof t||(t=0),t<1)return null;if(e[t-1]&&(!r&&e[t-1].trim()||r&&(e[t-1].trim()||"\n\r".includes(e[t-1]))))return t-1;if(e[t-2]&&(!r&&e[t-2].trim()||r&&(e[t-2].trim()||"\n\r".includes(e[t-2]))))return t-2;for(let n=t;n--;)if(e[n]&&(!r&&e[n].trim()||r&&(e[n].trim()||"\n\r".includes(e[n]))))return n;return null}(e,t,!1)}function g(e){return"string"==typeof e}function m(e,t,r,n){if(!g(e))throw new TypeError(`string-find-malformed: [THROW_ID_01] the first input argument, string where to look for, must be a string! Currently it's equal to: ${e} (type: ${typeof e})`);if(!e.length)return;if(!g(t))throw new TypeError(`string-find-malformed: [THROW_ID_02] the second input argument, string we should find, must be a string! Currently it's equal to: ${t} (type: ${typeof t})`);if(!t.length)return;if("function"!=typeof r)throw new TypeError(`string-find-malformed: [THROW_ID_03] the third input argument, a callback function, must be a function! Currently it's equal to: ${r} (type: ${typeof r})`);if(n&&(!(o=n)||"object"!=typeof o||Array.isArray(o)))throw new TypeError(`string-find-malformed: [THROW_ID_04] the fourth input argument, an Optional Options Object, must be a plain object! Currently it's equal to: ${n} (type: ${typeof n})`);var o;const i={stringOffset:0,maxDistance:1,ignoreWhitespace:!0,...n};if("string"==typeof i.stringOffset&&/^\d*$/.test(i.stringOffset))i.stringOffset=Number(i.stringOffset);else if(!Number.isInteger(i.stringOffset)||i.stringOffset<0)throw new TypeError(`${i.source} [THROW_ID_05] opts.stringOffset must be a natural number or zero! Currently it's: ${i.fromIndex}`);const s=e.length,a=Math.min(t.length,i.maxDistance+1);let l=[];const u=i.maxDistance;let d;for(let n=0;n<s;n++){if(i.ignoreWhitespace&&!e[n].trim())continue;for(let t=0,r=l.length;t<r;t++)d=!1,Array.isArray(l[t].pendingToCheck)&&l[t].pendingToCheck.length&&e[n]===l[t].pendingToCheck[0]?(d=!0,l[t].pendingToCheck.shift()):Array.isArray(l[t].pendingToCheck)&&l[t].pendingToCheck.length&&e[n]===l[t].pendingToCheck[1]?(d=!0,l[t].pendingToCheck.shift(),l[t].pendingToCheck.shift(),l[t].patienceLeft-=1):(l[t].patienceLeft-=1,e[c(e,n)]!==l[t].pendingToCheck[0]&&(l[t].pendingToCheck.shift(),e[n]===l[t].pendingToCheck[0]&&l[t].pendingToCheck.shift()));l=l.filter(e=>e.patienceLeft>=0);const o=l.filter(e=>0===e.pendingToCheck.length).map(e=>e.startsAt);if(Array.isArray(o)&&o.length){const s=Math.min(...o),a=n+(d?1:0);e.slice(s,a)!==t&&r({idxFrom:s+i.stringOffset,idxTo:a+i.stringOffset}),l=l.filter(e=>e.pendingToCheck.length)}for(let r=0;r<a;r++)if(e[n]===t[r]){const e={startsAt:n,patienceLeft:u-r,pendingToCheck:Array.from(t.slice(r+1))};l.push(e);break}}}function p(e){return e&&"object"==typeof e&&!Array.isArray(e)}function f(e){return"string"==typeof e}function h(e,t,r,n,o,i){const s="function"==typeof r?r():r;if(t<0&&o&&"EOL"===s)return s;if(t>=e.length&&!o)return!1;let a=o?1:r.length,l=!1,u=!1,c=n.maxMismatches,d=t,g=!1,m=!1,p=!1;for(;e[d];){const t=i(d);if(n.trimBeforeMatching&&""===e[d].trim()){if(!e[t]&&o&&"EOL"===r)return!0;d=i(d);continue}if(!n.i&&n.trimCharsBeforeMatching.includes(e[d])||n.i&&n.trimCharsBeforeMatching.map(e=>e.toLowerCase()).includes(e[d].toLowerCase())){if(o&&"EOL"===r&&!e[t])return!0;d=i(d);continue}const s=t>d?r[r.length-a]:r[a-1];if(!n.i&&e[d]===s||n.i&&e[d].toLowerCase()===s.toLowerCase()){if(g||(g=!0),u||(u=!0),a===r.length?m=!0:1===a&&(p=!0),a-=1,a<1)return d}else{if(!(n.maxMismatches&&c&&d))return!(0!==d||1!==a||n.lastMustMatch||!u)&&0;c-=1;for(let o=0;o<=c;o++){const s=t>d?r[r.length-a+1+o]:r[a-2-o],l=e[i(d)];if(s&&(!n.i&&e[d]===s||n.i&&e[d].toLowerCase()===s.toLowerCase())&&(!n.firstMustMatch||a!==r.length)){a-=2,g=!0;break}if(l&&s&&(!n.i&&l===s||n.i&&l.toLowerCase()===s.toLowerCase())&&(!n.firstMustMatch||a!==r.length)){a-=1,g=!0;break}if(void 0===s&&c>=0&&g&&(!n.firstMustMatch||m)&&(!n.lastMustMatch||p))return d}g||(l=d)}if(!1!==l&&l!==d&&(l=!1),a<1)return d;d=i(d)}return a>0?!(!o||"EOL"!==s)||!!(n.maxMismatches>=a&&u)&&(l||0):void 0}function y(e,t,r,n,o){if(p(o)&&Object.prototype.hasOwnProperty.call(o,"trimBeforeMatching")&&"boolean"!=typeof o.trimBeforeMatching)throw new Error(`string-match-left-right/${e}(): [THROW_ID_09] opts.trimBeforeMatching should be boolean!${Array.isArray(o.trimBeforeMatching)?" Did you mean to use opts.trimCharsBeforeMatching?":""}`);const i={i:!1,trimBeforeMatching:!1,trimCharsBeforeMatching:[],maxMismatches:0,firstMustMatch:!1,lastMustMatch:!1,...o};var s;if(i.trimCharsBeforeMatching="string"==typeof(s=i.trimCharsBeforeMatching)?s.length>0?[s]:[]:s,i.trimCharsBeforeMatching=i.trimCharsBeforeMatching.map(e=>f(e)?e:String(e)),!f(t))return!1;if(!t.length)return!1;if(!Number.isInteger(r)||r<0)throw new Error(`string-match-left-right/${e}(): [THROW_ID_03] the second argument should be a natural number. Currently it's of a type: ${typeof r}, equal to:\n${JSON.stringify(r,null,4)}`);let a,l,u,c;if(f(n))a=[n];else if(Array.isArray(n))a=n;else if(n){if("function"!=typeof n)throw new Error(`string-match-left-right/${e}(): [THROW_ID_05] the third argument, whatToMatch, is neither string nor array of strings! It's ${typeof n}, equal to:\n${JSON.stringify(n,null,4)}`);a=[],a.push(n)}else a=n;if(o&&!p(o))throw new Error(`string-match-left-right/${e}(): [THROW_ID_06] the fourth argument, options object, should be a plain object. Currently it's of a type "${typeof o}", and equal to:\n${JSON.stringify(o,null,4)}`);if(i.trimCharsBeforeMatching.some((e,t)=>e.length>1&&(u=t,c=e,!0)))throw new Error(`string-match-left-right/${e}(): [THROW_ID_07] the fourth argument, options object contains trimCharsBeforeMatching. It was meant to list the single characters but one of the entries at index ${u} is longer than 1 character, ${c.length} (equals to ${c}). Please split it into separate characters and put into array as separate elements.`);if(!a||!Array.isArray(a)||Array.isArray(a)&&!a.length||Array.isArray(a)&&1===a.length&&f(a[0])&&!a[0].trim()){if("function"==typeof i.cb){let n,o=r;if("matchLeftIncl"!==e&&"matchRight"!==e||(o+=1),"L"===e[5])for(let e=o;e--;){const r=t[e];if((!i.trimBeforeMatching||i.trimBeforeMatching&&void 0!==r&&r.trim())&&(!i.trimCharsBeforeMatching.length||void 0!==r&&!i.trimCharsBeforeMatching.includes(r))){n=e;break}}else if(e.startsWith("matchRight"))for(let e=o;e<t.length;e++){const r=t[e];if((!i.trimBeforeMatching||i.trimBeforeMatching&&r.trim())&&(!i.trimCharsBeforeMatching.length||!i.trimCharsBeforeMatching.includes(r))){n=e;break}}if(void 0===n)return!1;const s=t[n],a=n+1;let l="";return a&&a>0&&(l=t.slice(0,a)),"L"===e[5]?i.cb(s,l,n):(n&&n>0&&(l=t.slice(n)),i.cb(s,l,n))}let n="";throw o||(n=" More so, the whole options object, the fourth input argument, is missing!"),new Error(`string-match-left-right/${e}(): [THROW_ID_08] the third argument, "whatToMatch", was given as an empty string. This means, you intend to match purely by a callback. The callback was not set though, the opts key "cb" is not set!${n}`)}for(let n=0,o=a.length;n<o;n++){l="function"==typeof a[n];const o=a[n];let s,u,c="",d=r;"matchRight"===e?d+=1:"matchLeft"===e&&(d-=1);const g=h(t,d,o,i,l,t=>"L"===e[5]?t-1:t+1);if(g&&l&&"function"==typeof o&&"EOL"===o())return!(!o()||i.cb&&!i.cb(s,c,u))&&o();if(Number.isInteger(g)&&(u=e.startsWith("matchLeft")?g-1:g+1,c="L"===e[5]?t.slice(0,g):t.slice(u)),u<0&&(u=void 0),t[u]&&(s=t[u]),Number.isInteger(g)&&(!i.cb||i.cb(s,c,u)))return o}return!1}function b(e,t,r,n){return y("matchLeftIncl",e,t,r,n)}function v(e,t,r,n){return y("matchLeft",e,t,r,n)}function A(e,t,r,n){return y("matchRightIncl",e,t,r,n)}function w(e,t,r,n){return y("matchRight",e,t,r,n)}const _=new Set(["abbr","accept","accept-charset","accesskey","action","align","alink","allow","alt","archive","async","autocapitalize","autocomplete","autofocus","autoplay","axis","background","background-attachment","background-color","background-image","background-position","background-position-x","background-position-y","background-repeat","bgcolor","border","border-bottom","border-bottom-color","border-bottom-style","border-bottom-width","border-collapse","border-color","border-left","border-left-color","border-left-style","border-left-width","border-right","border-right-color","border-right-style","border-right-width","border-style","border-top","border-top-color","border-top-style","border-top-width","border-width","buffered","capture","cellpadding","cellspacing","challenge","char","charoff","charset","checked","cite","class","classid","clear","clip","code","codebase","codetype","color","cols","colspan","column-span","compact","content","contenteditable","contextmenu","controls","coords","crossorigin","csp","cursor","data","data-*","datetime","declare","decoding","default","defer","dir","direction","dirname","disabled","display","download","draggable","dropzone","enctype","enterkeyhint","face","filter","float","font","font-color","font-emphasize","font-emphasize-position","font-emphasize-style","font-family","font-size","font-style","font-variant","font-weight","for","form","formaction","formenctype","formmethod","formnovalidate","formtarget","frame","frameborder","frontuid","headers","height","hidden","high","horiz-align","href","hreflang","hspace","http-equiv","icon","id","importance","inputmode","integrity","intrinsicsize","ismap","itemprop","keytype","kind","label","lang","language","layout-flow","layout-grid","layout-grid-char","layout-grid-line","layout-grid-mode","layout-grid-type","left","letter-spacing","line-break","line-height","link","list","list-image-1","list-image-2","list-image-3","list-style","list-style-image","list-style-position","list-style-type","loading","longdesc","loop","low","manifest","margin","margin-bottom","margin-left","margin-right","margin-top","marginheight","marginwidth","max","maxlength","media","method","min","minlength","mso-ansi-font-size","mso-ansi-font-style","mso-ansi-font-weight","mso-ansi-language","mso-ascii-font-family","mso-background","mso-background-source","mso-baseline-position","mso-bidi-flag","mso-bidi-font-family","mso-bidi-font-size","mso-bidi-font-style","mso-bidi-font-weight","mso-bidi-language","mso-bookmark","mso-border-alt","mso-border-between","mso-border-between-color","mso-border-between-style","mso-border-between-width","mso-border-bottom-alt","mso-border-bottom-color-alt","mso-border-bottom-source","mso-border-bottom-style-alt","mso-border-bottom-width-alt","mso-border-color-alt","mso-border-effect","mso-border-left-alt","mso-border-left-color-alt","mso-border-left-source","mso-border-left-style-alt","mso-border-left-width-alt","mso-border-right-alt","mso-border-right-color-alt","mso-border-right-source","mso-border-right-style-alt","mso-border-right-width-alt","mso-border-shadow","mso-border-source","mso-border-style-alt","mso-border-top-alt","mso-border-top-color-alt","mso-border-top-source","mso-border-top-style-alt","mso-border-top-width-alt","mso-border-width-alt","mso-break-type","mso-build","mso-build-after-action","mso-build-after-color","mso-build-auto-secs","mso-build-avi","mso-build-dual-id","mso-build-order","mso-build-sound-name","mso-bullet-image","mso-cell-special","mso-cellspacing","mso-char-indent","mso-char-indent-count","mso-char-indent-size","mso-char-type","mso-char-wrap","mso-color-alt","mso-color-index","mso-color-source","mso-column-break-before","mso-column-separator","mso-columns","mso-comment-author","mso-comment-continuation","mso-comment-id","mso-comment-reference","mso-data-placement","mso-default-height","mso-default-width","mso-diagonal-down","mso-diagonal-down-color","mso-diagonal-down-source","mso-diagonal-down-style","mso-diagonal-down-width","mso-diagonal-up","mso-diagonal-up-color","mso-diagonal-up-source","mso-diagonal-up-style","mso-diagonal-up-width","mso-displayed-decimal-separator","mso-displayed-thousand-separator","mso-element","mso-element-anchor-horizontal","mso-element-anchor-lock","mso-element-anchor-vertical","mso-element-frame-height","mso-element-frame-hspace","mso-element-frame-vspace","mso-element-frame-width","mso-element-left","mso-element-linespan","mso-element-top","mso-element-wrap","mso-endnote-continuation-notice","mso-endnote-continuation-notice-id","mso-endnote-continuation-notice-src","mso-endnote-continuation-separator","mso-endnote-continuation-separator-id","mso-endnote-continuation-separator-src","mso-endnote-display","mso-endnote-id","mso-endnote-numbering","mso-endnote-numbering-restart","mso-endnote-numbering-start","mso-endnote-numbering-style","mso-endnote-position","mso-endnote-separator","mso-endnote-separator-id","mso-endnote-separator-src","mso-even-footer","mso-even-footer-id","mso-even-footer-src","mso-even-header","mso-even-header-id","mso-even-header-src","mso-facing-pages","mso-fareast-font-family","mso-fareast-hint","mso-fareast-language","mso-field-change","mso-field-change-author","mso-field-change-time","mso-field-change-value","mso-field-code","mso-field-lock","mso-fills-color","mso-first-footer","mso-first-footer-id","mso-first-footer-src","mso-first-header","mso-first-header-id","mso-first-header-src","mso-font-alt","mso-font-charset","mso-font-format","mso-font-info","mso-font-info-charset","mso-font-info-type","mso-font-kerning","mso-font-pitch","mso-font-signature","mso-font-signature-csb-one","mso-font-signature-csb-two","mso-font-signature-usb-four","mso-font-signature-usb-one","mso-font-signature-usb-three","mso-font-signature-usb-two","mso-font-src","mso-font-width","mso-footer","mso-footer-data","mso-footer-id","mso-footer-margin","mso-footer-src","mso-footnote-continuation-notice","mso-footnote-continuation-notice-id","mso-footnote-continuation-notice-src","mso-footnote-continuation-separator","mso-footnote-continuation-separator-id","mso-footnote-continuation-separator-src","mso-footnote-id","mso-footnote-numbering","mso-footnote-numbering-restart","mso-footnote-numbering-start","mso-footnote-numbering-style","mso-footnote-position","mso-footnote-separator","mso-footnote-separator-id","mso-footnote-separator-src","mso-foreground","mso-forms-protection","mso-generic-font-family","mso-grid-bottom","mso-grid-bottom-count","mso-grid-left","mso-grid-left-count","mso-grid-right","mso-grid-right-count","mso-grid-top","mso-grid-top-count","mso-gutter-direction","mso-gutter-margin","mso-gutter-position","mso-hansi-font-family","mso-header","mso-header-data","mso-header-id","mso-header-margin","mso-header-src","mso-height-alt","mso-height-rule","mso-height-source","mso-hide","mso-highlight","mso-horizontal-page-align","mso-hyphenate","mso-ignore","mso-kinsoku-overflow","mso-layout-grid-align","mso-layout-grid-char-alt","mso-layout-grid-origin","mso-level-inherit","mso-level-legacy","mso-level-legacy-indent","mso-level-legacy-space","mso-level-legal-format","mso-level-number-format","mso-level-number-position","mso-level-numbering","mso-level-reset-level","mso-level-start-at","mso-level-style-link","mso-level-suffix","mso-level-tab-stop","mso-level-text","mso-line-break-override","mso-line-grid","mso-line-height-alt","mso-line-height-rule","mso-line-numbers-count-by","mso-line-numbers-distance","mso-line-numbers-restart","mso-line-numbers-start","mso-line-spacing","mso-linked-frame","mso-list","mso-list-change","mso-list-change-author","mso-list-change-time","mso-list-change-values","mso-list-id","mso-list-ins","mso-list-ins-author","mso-list-ins-time","mso-list-name","mso-list-template-ids","mso-list-type","mso-margin-bottom-alt","mso-margin-left-alt","mso-margin-top-alt","mso-mirror-margins","mso-negative-indent-tab","mso-number-format","mso-outline-level","mso-outline-parent","mso-outline-parent-col","mso-outline-parent-row","mso-outline-parent-visibility","mso-outline-style","mso-padding-alt","mso-padding-between","mso-padding-bottom-alt","mso-padding-left-alt","mso-padding-right-alt","mso-padding-top-alt","mso-page-border-aligned","mso-page-border-art","mso-page-border-bottom-art","mso-page-border-display","mso-page-border-left-art","mso-page-border-offset-from","mso-page-border-right-art","mso-page-border-surround-footer","mso-page-border-surround-header","mso-page-border-top-art","mso-page-border-z-order","mso-page-numbers","mso-page-numbers-chapter-separator","mso-page-numbers-chapter-style","mso-page-numbers-start","mso-page-numbers-style","mso-page-orientation","mso-page-scale","mso-pagination","mso-panose-arm-style","mso-panose-contrast","mso-panose-family-type","mso-panose-letterform","mso-panose-midline","mso-panose-proportion","mso-panose-serif-style","mso-panose-stroke-variation","mso-panose-weight","mso-panose-x-height","mso-paper-source","mso-paper-source-first-page","mso-paper-source-other-pages","mso-pattern","mso-pattern-color","mso-pattern-style","mso-print-area","mso-print-color","mso-print-gridlines","mso-print-headings","mso-print-resolution","mso-print-sheet-order","mso-print-title-column","mso-print-title-row","mso-prop-change","mso-prop-change-author","mso-prop-change-time","mso-protection","mso-rotate","mso-row-margin-left","mso-row-margin-right","mso-ruby-merge","mso-ruby-visibility","mso-scheme-fill-color","mso-scheme-shadow-color","mso-shading","mso-shadow-color","mso-space-above","mso-space-below","mso-spacerun","mso-special-character","mso-special-format","mso-style-id","mso-style-name","mso-style-next","mso-style-parent","mso-style-type","mso-style-update","mso-subdocument","mso-symbol-font-family","mso-tab-count","mso-table-anchor-horizontal","mso-table-anchor-vertical","mso-table-bspace","mso-table-del-author","mso-table-del-time","mso-table-deleted","mso-table-dir","mso-table-ins-author","mso-table-ins-time","mso-table-inserted","mso-table-layout-alt","mso-table-left","mso-table-lspace","mso-table-overlap","mso-table-prop-author","mso-table-prop-change","mso-table-prop-time","mso-table-rspace","mso-table-top","mso-table-tspace","mso-table-wrap","mso-text-animation","mso-text-combine-brackets","mso-text-combine-id","mso-text-control","mso-text-fit-id","mso-text-indent-alt","mso-text-orientation","mso-text-raise","mso-title-page","mso-tny-compress","mso-unsynced","mso-vertical-align-alt","mso-vertical-align-special","mso-vertical-page-align","mso-width-alt","mso-width-source","mso-word-wrap","mso-xlrowspan","mso-zero-height","multiple","muted","name","nav-banner-image","navbutton_background_color","navbutton_home_hovered","navbutton_home_normal","navbutton_home_pushed","navbutton_horiz_hovered","navbutton_horiz_normal","navbutton_horiz_pushed","navbutton_next_hovered","navbutton_next_normal","navbutton_next_pushed","navbutton_prev_hovered","navbutton_prev_normal","navbutton_prev_pushed","navbutton_up_hovered","navbutton_up_normal","navbutton_up_pushed","navbutton_vert_hovered","navbutton_vert_normal","navbutton_vert_pushed","nohref","noresize","noshade","novalidate","nowrap","object","onblur","onchange","onclick","ondblclick","onfocus","onkeydown","onkeypress","onkeyup","onload","onmousedown","onmousemove","onmouseout","onmouseover","onmouseup","onreset","onselect","onsubmit","onunload","open","optimum","overflow","padding","padding-bottom","padding-left","padding-right","padding-top","page","page-break-after","page-break-before","panose-1","pattern","ping","placeholder","position","poster","preload","profile","prompt","punctuation-trim","punctuation-wrap","radiogroup","readonly","referrerpolicy","rel","required","rev","reversed","right","row-span","rows","rowspan","ruby-align","ruby-overhang","ruby-position","rules","sandbox","scheme","scope","scoped","scrolling","selected","separator-image","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","standby","start","step","style","summary","tab-interval","tab-stops","tabindex","table-border-color-dark","table-border-color-light","table-layout","target","text","text-align","text-autospace","text-combine","text-decoration","text-effect","text-fit","text-indent","text-justify","text-justify-trim","text-kashida","text-line-through","text-shadow","text-transform","text-underline","text-underline-color","text-underline-style","title","top","top-bar-button","translate","type","unicode-bidi","urlId","usemap","valign","value","valuetype","version","vert-align","vertical-align","visibility","vlink","vnd.ms-excel.numberformat","vspace","white-space","width","word-break","word-spacing","wrap","xmlns","z-index"]);function O(e){return"string"==typeof e&&(e.charCodeAt(0)>96&&e.charCodeAt(0)<123||e.charCodeAt(0)>64&&e.charCodeAt(0)<91||e.charCodeAt(0)>47&&e.charCodeAt(0)<58||":"===e||"-"===e)}const k=Array.isArray;function C(e,t,r){const n={inclusiveRangeEnds:!1,returnMatchedRangeInsteadOfTrue:!1,...r};return!!k(t)&&(n.returnMatchedRangeInsteadOfTrue?t.find(t=>n.inclusiveRangeEnds?e>=t[0]&&e<=t[1]:e>t[0]&&e<t[1])||!1:t.some(t=>n.inclusiveRangeEnds?e>=t[0]&&e<=t[1]:e>t[0]&&e<t[1]))}function x(e,t){if(void 0===e)throw new Error("string-split-by-whitespace: [THROW_ID_01] The input is missing!");if("string"!=typeof e)return e;if(""===e.trim())return[];const r={ignoreRanges:[],...t};if(r.ignoreRanges.length>0&&!r.ignoreRanges.every(e=>Array.isArray(e)))throw new Error("string-split-by-whitespace: [THROW_ID_03] The opts.ignoreRanges contains elements which are not arrays!");let n=null;const o=[];for(let t=0,i=e.length;t<i;t++)null!==n||""===e[t].trim()||0!==r.ignoreRanges.length&&(0===r.ignoreRanges.length||C(t,r.ignoreRanges.map(e=>[e[0],e[1]-1]),{inclusiveRangeEnds:!0}))||(n=t),null!==n&&(""===e[t].trim()?(o.push(e.slice(n,t)),n=null):r.ignoreRanges.length&&C(t,r.ignoreRanges)?(o.push(e.slice(n,t-1)),n=null):void 0===e[t+1]&&o.push(e.slice(n,t+1)));return o}function T(e,t,r,n=[]){for(let o=t,i=e.length;o<i;o++){if(n.some(t=>e.startsWith(t,o)))return!0;if(e[o]===r)return!1}return!0}function N(e,t,r,n){for(let o=t,i=e.length;o<i;o++){if(e.startsWith(r,o))return!0;if(e.startsWith(n,o))return!1}return!1}function $(e,t){if(!O(e[t])||!t)return!1;return/^[a-zA-Z0-9:-]*(\s*[=]?\s*((?:'[^']*')|(?:"[^"]*")))|( [^/>'"=]*['"])/.test(e.slice(t))}function E(e,t){if(!O(e[t])||!t)return!1;return/^[a-zA-Z0-9:-]*=(((?:'[^']*')|(?:"[^"]*"))|((?:['"][^'"]*['"]\s*\/?>)))/.test(e.slice(t))}function S(e,t){if(O(e[d(e,t)]))for(let r=t;r--;)if(e[r].trim().length&&!O(e[r]))return e.slice(r+1,t)}function I(e){return"'"===e?'"':"'"}function j(e,t,r){if("string"!=typeof e||!e.trim()||!Number.isInteger(t)||!Number.isInteger(r)||!e[t]||!e[r]||t>=r)return!1;const n="'\"".includes(e[t])?e[t]:null;let o,i=null;n&&(i=I(n));const s=(new Map).set("'",0).set('"',0).set("matchedPairs",0);let a,l=null,u=0,g=!1,m=!1,p=!1,f=!1,h=!1,y=!1;for(let b=t,v=e.length;b<v;b++){if("'\"".includes(e[b])&&g&&m===t&&p<b&&b>=r){const n=b!==r||E(e,c(e,r))||"/>".includes(e[c(e,b)]),i=!(b>r&&e[t]===e[r]&&e[t]===e[b]&&$(e,b+1)),s=b===r&&$(e,r+1),a=o&&o<b&&_.has(e.slice(o,b).trim()),l=o&&o<b&&e[o-1]&&!e[o-1].trim()&&Array.from(e.slice(o,b).trim()).every(e=>O(e))&&e[t]===e[r];let u;b===r&&(u=S(e,b));const m=b===r&&(!O(e[d(e,b)])||u&&!_.has(u))&&"="!==e[d(e,b)],p="/>".includes(e[c(e,b)])&&b===r,f=O(e[c(e,b)]),h=g&&b!==r;return n&&i&&(s||a||l||m)&&(p||f||h)}if("'\"".includes(e[b])&&(l&&e[b]===e[l]?(s.set("matchedPairs",s.get("matchedPairs")+1),m=l,p=b,l=null,g=!0):g=!1,s.set(e[b],s.get(e[b])+1),u=s.get('"')+s.get("'")),">"===e[b]&&!h&&(h=!0,u&&s.get("matchedPairs")&&u===2*s.get("matchedPairs")&&b<r))return!1;if("<"===e[b]&&h&&!y)return y=!0,!1;if(e[b].trim()&&!o)O(e[b])&&(o=b);else if(o&&!O(e[b])){if(a=e.slice(o,b),f=o>=r,"'\"".includes(e[b])&&0===s.get("matchedPairs")&&3===u&&e[t]===e[b]&&_.has(a)){const t=b>r,n=!l,o=l+1>=b,i=x(e.slice(l+1,b)).every(e=>_.has(e)),s=b===r,a=u<3,c=!!g,d=!l,m=l+1>=b,p=!x(e.slice(l+1,b)).every(e=>_.has(e));return t&&(n||o||i)||s&&(a||c||d||m||p)}if(a&&_.has(a)&&m===t&&p===r)return!0}if("'\"".includes(e[b])&&(!(s.get('"')%2)||!(s.get("'")%2))&&(s.get('"')+s.get("'"))%2&&(a&&_.has(a)||b>r+1&&_.has(e.slice(r+1,b).trim()))){const o=b>r,i=!!n,s=e[t]!==e[r],a=_.has(e.slice(t+1,r).trim()),l=!N(e,b+1,e[r],I(e[r]));return o&&!(i&&s&&a&&l)}if(("="===e[b]||!e[b].length&&"="===e[c(e,b)])&&a&&_.has(a)){const n=b>r,i=!(!(g&&m===t&&p===r||E(e,o))&&g&&m&&m<=r);return n&&i}if(b>r){if(n&&e[b]===n){const t=!!l,n=l===r,o=l+1<b&&e.slice(l+1,b).trim(),i=x(e.slice(l+1,b)).every(e=>_.has(e)),s=b>=r;return t&&n&&o&&i&&s}if(n&&e[r]===i&&e[b]===i)return!1;if("/"===e[b]||">"===e[b]||"<"===e[b]){const n=e[t]===e[r]&&l===r&&!e.slice(t+1,r).includes(e[t]),o=s.get("matchedPairs")<2,i=S(e,b),a=(!i||!_.has(i))&&(!(b>r&&s.get("'")&&s.get('"')&&s.get("matchedPairs")>1)||"/>".includes(e[c(e,b)])),d=u<3||s.get('"')+s.get("'")-2*s.get("matchedPairs")!=2,p=!g||g&&!(m&&Array.from(e.slice(t+1,m).trim()).every(e=>O(e))&&_.has(e.slice(t+1,m).trim())),f=!c(e,b)&&u%2==0,h=e[t-2]&&"="===e[t-1]&&O(e[t-2]),y=!T(e,b+1,"<",["='",'="']);return n||(o||a)&&d&&(p||f||h||y)}if("="===e[b]&&w(e,b,["'",'"'],{trimBeforeMatching:!0,trimCharsBeforeMatching:["="]}))return!0}else{let n;if(e[b-1]&&e[b-1].trim()&&"="!==e[b-1])n=b-1;else for(let t=b;t--;)if(e[t].trim()&&"="!==e[t]){n=t;break}if("="===e[b]&&w(e,b,["'",'"'],{cb:e=>!"/>".includes(e),trimBeforeMatching:!0,trimCharsBeforeMatching:["="]})&&O(e[n]))return!1;if(b===r&&E(e,b+1))return!0;if(b<r&&"'\"".includes(e[b])&&a&&e[d(e,t)]&&"="!==e[d(e,t)]&&m===t&&_.has(a))return!1}if("'\"".includes(e[b])&&b>r)return!!(f&&a&&_.has(a));"'\"".includes(e[b])&&(l=b),o&&!O(e[b])&&(o=null)}return!1}const V=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","big","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","dir","div","dl","doctype","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h1 - h6","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","math","menu","menuitem","meta","meter","nav","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","slot","small","source","span","strike","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr","xml"];function M(e){return void 0===e||e.toUpperCase()===e.toLowerCase()&&!"0123456789".includes(e)&&"="!==e}function R(e,t=0,r){const n={allowCustomTagNames:!1,skipOpeningBracket:!1,...r},o="._a-z0-9·À-ÖØ-öø-ͽͿ-῿‌-‍‿-⁀⁰-￿",i=new RegExp(`^${n.skipOpeningBracket?"":"<"}[\\\\ \\t\\r\\n/]*\\w+[\\\\ \\t\\r\\n/]*>`,"g"),s=new RegExp(`^${n.skipOpeningBracket?"":"<"}[\\\\ \\t\\r\\n/]*[${o}]+[-${o}]*[\\\\ \\t\\r\\n/]*>`,"g"),a=new RegExp(`^${n.skipOpeningBracket?"":"<"}\\s*\\w+\\s+\\w+(?:-\\w+)?\\s*=\\s*['"\\w]`,"g"),l=new RegExp(`^${n.skipOpeningBracket?"":"<"}\\s*\\w+\\s+[${o}]+[-${o}]*(?:-\\w+)?\\s*=\\s*['"\\w]`),u=new RegExp(`^${n.skipOpeningBracket?"":"<"}\\s*\\/?\\s*\\w+\\s*\\/?\\s*>`,"g"),c=new RegExp(`^${n.skipOpeningBracket?"":"<"}\\s*\\/?\\s*[${o}]+[-${o}]*\\s*\\/?\\s*>`,"g"),d=new RegExp(`^${n.skipOpeningBracket?"":"<"}[\\\\ \\t\\r\\n/]*\\w+(?:\\s*\\w+)*\\s*\\w+=['"]`,"g"),g=new RegExp(`^${n.skipOpeningBracket?"":"<"}[\\\\ \\t\\r\\n/]*[${o}]+[-${o}]*(?:\\s*\\w+)*\\s*\\w+=['"]`,"g"),m=t?e.slice(t):e;let p=!1;const f={cb:M,i:!0,trimCharsBeforeMatching:["/","\\","!"," ","\t","\n","\r"]};return n.allowCustomTagNames?(s.test(m)||l.test(m)||c.test(m)||g.test(m))&&(p=!0):A(e,t,V,{cb:M,i:!0,trimCharsBeforeMatching:["<","/","\\","!"," ","\t","\n","\r"]})&&(i.test(m)||a.test(m)||u.test(m)||d.test(m))&&(p=!0),!p&&!n.skipOpeningBracket&&"<"===e[t]&&e[t+1].trim()&&w(e,t,V,f)&&(p=!0),"string"==typeof e&&t<e.length&&p}const F=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","bgsound","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","command","content","data","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","element","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","image","img","input","ins","isindex","kbd","keygen","label","legend","li","link","listing","main","map","mark","marquee","menu","menuitem","meta","meter","multicol","nav","nextid","nobr","noembed","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","plaintext","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr","xmp"],B="{}%-$_()*|#",W=[")|(","|(",")(","()","{}","%)","*)","**"];function L(e){return"string"==typeof e}function P(e){return L(e)&&1===e.length&&(e.charCodeAt(0)>64&&e.charCodeAt(0)<91||e.charCodeAt(0)>96&&e.charCodeAt(0)<123)}function D(e){let t="";for(let r=0,n=e.length;r<n;r++)t="["===e[r]?"]"+t:"]"===e[r]?"["+t:"{"===e[r]?"}"+t:"}"===e[r]?"{"+t:"("===e[r]?")"+t:")"===e[r]?"("+t:"<"===e[r]?">"+t:">"===e[r]?"<"+t:`${e[r]}${t}`;return t}function q(e){return F.includes(e.toLowerCase())||["doctype","cdata","xml"].includes(e.toLowerCase())}function H(e,t,r,n){for(let o=t,i=e.length;o<i;o++){if(e.startsWith(r,o))return!0;if(e.startsWith(n,o))return!1}return!1}function z(e,t,r){let n=e[t];const o=e.length;for(let i=t+1;i<o&&!(n.length>1&&(n.includes("{")||n.includes("[")||n.includes("("))&&"("===e[i])&&(B.includes(e[i])||"<"===e[t]&&"/"===e[i]||">"===e[i]&&"--"===n&&Array.isArray(r)&&r.length&&"esp"===r[r.length-1].type&&"<"===r[r.length-1].openingLump[0]&&"-"===r[r.length-1].openingLump[2]&&"-"===r[r.length-1].openingLump[3]);i++)n+=e[i];if(n&&Array.isArray(r)&&r.length&&"esp"===r[r.length-1].type&&r[r.length-1].guessedClosingLump&&n.length>r[r.length-1].guessedClosingLump.length){if(n.endsWith(r[r.length-1].openingLump))return n.slice(0,n.length-r[r.length-1].openingLump.length);let e=new Set(r[r.length-1].guessedClosingLump),t=0;for(let r=0,o=n.length;r<o;r++){if(!e.has(n[r])&&t>1)return n.slice(0,r);e.has(n[r])&&(t+=1,e=new Set([...e].filter(e=>e!==n[r])))}}return n}function J(e,t,r){if(!t.length)return;const n=r?t[0]:t[t.length-1];return"esp"===n.type&&Array.from(e).every(e=>n.guessedClosingLump.includes(e))?e.length:void 0}function Q(e,t,r,n){return"<"===e[t]&&(w(e,t,["!--"],{maxMismatches:1,firstMustMatch:!0,trimBeforeMatching:!0})||w(e,t,["![endif]"],{i:!0,maxMismatches:2,trimBeforeMatching:!0}))&&!w(e,t,["![cdata","<"],{i:!0,maxMismatches:1,trimBeforeMatching:!0})&&("comment"!==r.type||"not"!==r.kind)||"-"===e[t]&&w(e,t,["->"],{trimBeforeMatching:!0})&&("comment"!==r.type||!r.closing&&"not"!==r.kind)&&!v(e,t,"<",{trimBeforeMatching:!0,trimCharsBeforeMatching:["-","!"]})&&(!Array.isArray(n)||!n.length||"esp"!==n[n.length-1].type||!("<"===n[n.length-1].openingLump[0]&&"-"===n[n.length-1].openingLump[2]&&"-"===n[n.length-1].openingLump[3]))}const U="\\";function Z(e,t,r,n){return e[t]&&e[t].trim().length&&(!n.length||"text"===r.type)&&!["doctype","xml"].includes(r.kind)&&("<"===e[t]&&(R(e,t,{allowCustomTagNames:!0})||">"===e[c(e,t)]||w(e,t,["doctype","xml","cdata"],{i:!0,trimBeforeMatching:!0,trimCharsBeforeMatching:["?","!","["," ","-"]}))||P(e[t])&&(!e[t-1]||!P(e[t-1])&&!["<","/","!",U].includes(e[d(e,t)]))&&R(e,t,{allowCustomTagNames:!1,skipOpeningBracket:!0}))&&("esp"!==r.type||r.tail&&r.tail.includes(e[t]))}function G(e,t,r,n,o){return B.includes(e[t])&&e[t+1]&&B.includes(e[t+1])&&"rule"!==r.type&&"at"!==r.type&&!("-"===e[t]&&"-{(".includes(e[t+1]))&&!("})".includes(e[t])&&"-".includes(e[t+1]))&&!("%"===e[t]&&"0123456789".includes(e[d(e,t)])&&(!e[t+2]||['"',"'",";"].includes(e[t+2])||!e[t+2].trim().length))&&!(o&&("{}".includes(e[t])||"{}".includes(e[c(e,t)])))||"<"===e[t]&&("/"===e[t+1]&&B.includes(e[t+2])||B.includes(e[t+1])&&!["-"].includes(e[t+1]))||">})".includes(e[t])&&Array.isArray(n)&&n.length&&"esp"===n[n.length-1].type&&n[n.length-1].openingLump.includes(D(e[t]))&&(">"!==e[t]||!H(e,t+1,">","<"))||"-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]&&Array.isArray(n)&&n.length&&"esp"===n[n.length-1].type&&"<"===n[n.length-1].openingLump[0]&&"-"===n[n.length-1].openingLump[2]&&"-"===n[n.length-1].openingLump[3]}function K(e){return e&&"object"==typeof e&&!Array.isArray(e)}const X=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"],Y=["{","}",","];var ee=l((function(e){e.exports=function(){var e=Object.prototype.toString;function t(e,t){return null!=e&&Object.prototype.hasOwnProperty.call(e,t)}function r(e){if(!e)return!0;if(o(e)&&0===e.length)return!0;if("string"!=typeof e){for(var r in e)if(t(e,r))return!1;return!0}return!1}function n(t){return e.call(t)}var o=Array.isArray||function(t){return"[object Array]"===e.call(t)};function i(e){var t=parseInt(e);return t.toString()===e?t:e}function s(e){e=e||{};var s=function(e){return Object.keys(s).reduce((function(t,r){return"create"===r||"function"==typeof s[r]&&(t[r]=s[r].bind(s,e)),t}),{})};function a(r,n){return e.includeInheritedProps||"number"==typeof n&&Array.isArray(r)||t(r,n)}function l(e,t){if(a(e,t))return e[t]}function u(e,t,r,n){if("number"==typeof t&&(t=[t]),!t||0===t.length)return e;if("string"==typeof t)return u(e,t.split(".").map(i),r,n);var o=t[0],s=l(e,o);return 1===t.length?(void 0!==s&&n||(e[o]=r),s):(void 0===s&&("number"==typeof t[1]?e[o]=[]:e[o]={}),u(e[o],t.slice(1),r,n))}return s.has=function(r,n){if("number"==typeof n?n=[n]:"string"==typeof n&&(n=n.split(".")),!n||0===n.length)return!!r;for(var s=0;s<n.length;s++){var a=i(n[s]);if(!("number"==typeof a&&o(r)&&a<r.length||(e.includeInheritedProps?a in Object(r):t(r,a))))return!1;r=r[a]}return!0},s.ensureExists=function(e,t,r){return u(e,t,r,!0)},s.set=function(e,t,r,n){return u(e,t,r,n)},s.insert=function(e,t,r,n){var i=s.get(e,t);n=~~n,o(i)||(i=[],s.set(e,t,i)),i.splice(n,0,r)},s.empty=function(e,t){var i,l;if(!r(t)&&null!=e&&(i=s.get(e,t))){if("string"==typeof i)return s.set(e,t,"");if(function(e){return"boolean"==typeof e||"[object Boolean]"===n(e)}(i))return s.set(e,t,!1);if("number"==typeof i)return s.set(e,t,0);if(o(i))i.length=0;else{if(!function(e){return"object"==typeof e&&"[object Object]"===n(e)}(i))return s.set(e,t,null);for(l in i)a(i,l)&&delete i[l]}}},s.push=function(e,t){var r=s.get(e,t);o(r)||(r=[],s.set(e,t,r)),r.push.apply(r,Array.prototype.slice.call(arguments,2))},s.coalesce=function(e,t,r){for(var n,o=0,i=t.length;o<i;o++)if(void 0!==(n=s.get(e,t[o])))return n;return r},s.get=function(e,t,r){if("number"==typeof t&&(t=[t]),!t||0===t.length)return e;if(null==e)return r;if("string"==typeof t)return s.get(e,t.split("."),r);var n=i(t[0]),o=l(e,n);return void 0===o?r:1===t.length?o:s.get(e[n],t.slice(1),r)},s.del=function(e,t){if("number"==typeof t&&(t=[t]),null==e)return e;if(r(t))return e;if("string"==typeof t)return s.del(e,t.split("."));var n=i(t[0]);return a(e,n)?1!==t.length?s.del(e[n],t.slice(1)):(o(e)?e.splice(n,1):delete e[n],e):e},s}var a=s();return a.create=s,a.withInheritedProps=s({includeInheritedProps:!0}),a}()}));function te(e){return e&&"object"==typeof e&&!Array.isArray(e)}function re(e,t){return t.closing&&e.length&&(e[e.length-1].type===t.type&&Object.prototype.hasOwnProperty.call(e[e.length-1],"tagName")&&Object.prototype.hasOwnProperty.call(t,"tagName")&&e[e.length-1].tagName===t.tagName&&!1===e[e.length-1].closing||"comment"===t.type&&e.some(e=>Object.prototype.hasOwnProperty.call(e,"closing")&&!e.closing))}function ne(e,t){if("string"!=typeof e)throw void 0===e?new Error("codsen-tokenizer: [THROW_ID_01] the first input argument is completely missing! It should be given as string."):new Error(`codsen-tokenizer: [THROW_ID_02] the first input argument must be string! It was given as "${typeof e}", equal to:\n${JSON.stringify(e,null,4)}`);if(t&&!te(t))throw new Error(`codsen-tokenizer: [THROW_ID_03] the second input argument, an options object, should be a plain object but it was given as type ${typeof t}, equal to ${JSON.stringify(t,null,4)}`);if(te(t)&&t.tagCb&&"function"!=typeof t.tagCb)throw new Error(`codsen-tokenizer: [THROW_ID_04] the opts.tagCb, callback function, should be a function but it was given as type ${typeof t.tagCb}, equal to ${JSON.stringify(t.tagCb,null,4)}`);if(te(t)&&t.charCb&&"function"!=typeof t.charCb)throw new Error(`codsen-tokenizer: [THROW_ID_05] the opts.charCb, callback function, should be a function but it was given as type ${typeof t.charCb}, equal to ${JSON.stringify(t.charCb,null,4)}`);if(te(t)&&t.reportProgressFunc&&"function"!=typeof t.reportProgressFunc)throw new Error(`codsen-tokenizer: [THROW_ID_06] the opts.reportProgressFunc, callback function, should be a function but it was given as type ${typeof t.reportProgressFunc}, equal to ${JSON.stringify(t.reportProgressFunc,null,4)}`);if(te(t)&&t.errCb&&"function"!=typeof t.errCb)throw new Error(`codsen-tokenizer: [THROW_ID_07] the opts.errCb, callback function, should be a function but it was given as type ${typeof t.errCb}, equal to ${JSON.stringify(t.errCb,null,4)}`);const r={reportProgressFunc:null,reportProgressFuncFrom:0,reportProgressFuncTo:100,tagCb:null,charCb:null,errCb:null,...t},n=[],o=[];let a,l=!1,g={};const p=["tag","comment"],f=["doctype"];return function(e,t){const r=Date.now();if(!L(e))throw void 0===e?new Error("codsen-tokenizer: [THROW_ID_01] the first input argument is completely missing! It should be given as string."):new Error(`codsen-tokenizer: [THROW_ID_02] the first input argument must be string! It was given as "${typeof e}", equal to:\n${JSON.stringify(e,null,4)}`);if(t&&!K(t))throw new Error(`codsen-tokenizer: [THROW_ID_03] the second input argument, an options object, should be a plain object but it was given as type ${typeof t}, equal to ${JSON.stringify(t,null,4)}`);if(K(t)&&t.tagCb&&"function"!=typeof t.tagCb)throw new Error(`codsen-tokenizer: [THROW_ID_04] the opts.tagCb, callback function, should be a function but it was given as type ${typeof t.tagCb}, equal to ${JSON.stringify(t.tagCb,null,4)}`);if(K(t)&&t.charCb&&"function"!=typeof t.charCb)throw new Error(`codsen-tokenizer: [THROW_ID_05] the opts.charCb, callback function, should be a function but it was given as type ${typeof t.charCb}, equal to ${JSON.stringify(t.charCb,null,4)}`);if(K(t)&&t.reportProgressFunc&&"function"!=typeof t.reportProgressFunc)throw new Error(`codsen-tokenizer: [THROW_ID_06] the opts.reportProgressFunc, callback function, should be a function but it was given as type ${typeof t.reportProgressFunc}, equal to ${JSON.stringify(t.reportProgressFunc,null,4)}`);const n={tagCb:null,tagCbLookahead:0,charCb:null,charCbLookahead:0,reportProgressFunc:null,reportProgressFuncFrom:0,reportProgressFuncTo:100,...t};let o,i=0;const s=e.length,a=Math.floor(s/2);let l,g=!1;const m=[],p=[];let f={};const h={type:null,start:null,end:null};function y(){return f=u(h),x(),f}let k={};const C={attribName:null,attribNameRecognised:null,attribNameStartsAt:null,attribNameEndsAt:null,attribOpeningQuoteAt:null,attribClosingQuoteAt:null,attribValueRaw:null,attribValue:[],attribValueStartsAt:null,attribValueEndsAt:null,attribStart:null,attribEnd:null};function x(){k=u(C)}let T,N,$;y(),x();let E=[];function S(e,t,r){const n=e.shift(),o=[];for(let t=0;t<r&&e[t];t++)o.push(u(e[t]));t(n,o)}function I(e){n.tagCb&&(m.push(e),m.length>n.tagCbLookahead&&S(m,n.tagCb,n.tagCbLookahead))}function V(t,r){if(!["text","esp"].includes(t.type)&&null!==t.start&&t.start<r&&(e[r-1]&&!e[r-1].trim()||"<"===e[r]))if(t.end=d(e,r)+1,t.value=e.slice(t.start,t.end),"tag"!==t.type||"/>".includes(e[t.end-1]))I(t),f=y(),e[r-1]&&!e[r-1].trim()&&M("text",d(e,r)+1);else{let n=t.tagNameEndsAt||r;if(Array.isArray(t.attribs)&&t.attribs.length)for(let r=0,o=t.attribs.length;r<o;r++){if(!t.attribs[r].attribNameRecognised){t.attribs=0===r?[]:t.attribs.splice(0,r);break}n=t.attribs[r].attribEnd,e[n]&&e[n+1]&&!e[n].trim()&&e[n+1].trim()&&(n+=1)}t.end=n,t.value=e.slice(t.start,t.end),t.tagNameEndsAt||(t.tagNameEndsAt=n),Number.isInteger(t.tagNameStartsAt)&&Number.isInteger(t.tagNameEndsAt)&&!t.tagName&&(t.tagName=e.slice(t.tagNameStartsAt,n),t.recognised=q(t.tagName)),I(t),f=y(),M("text",n)}null!==f.start&&(null===f.end&&f.start!==r&&(f.end=r,f.value=e.slice(f.start,f.end)),null!==f.start&&null!==f.end&&I(f),f=y())}function M(e,t){x(),"tag"===e?(f.type=e,f.start=t,f.end=null,f.value=null,f.tagNameStartsAt=null,f.tagNameEndsAt=null,f.tagName=null,f.recognised=null,f.closing=!1,f.void=!1,f.pureHTML=!0,f.kind=null,f.attribs=[],delete f.openingCurlyAt,delete f.closingCurlyAt,delete f.selectorsStart,delete f.selectorsEnd,delete f.selectors,delete f.identifier,delete f.identifierStartsAt,delete f.identifierEndsAt,delete f.query,delete f.queryStartsAt,delete f.queryEndsAt,delete f.head,delete f.tail):"comment"===e?(f.type=e,f.start=t,f.end=null,f.value=null,delete f.tagNameStartsAt,delete f.tagNameEndsAt,delete f.tagName,delete f.recognised,f.closing=!1,delete f.void,delete f.pureHTML,f.kind="simple",delete f.attribs,delete f.openingCurlyAt,delete f.closingCurlyAt,delete f.selectorsStart,delete f.selectorsEnd,delete f.selectors,delete f.identifier,delete f.identifierStartsAt,delete f.identifierEndsAt,delete f.query,delete f.queryStartsAt,delete f.queryEndsAt,delete f.head,delete f.tail):"rule"===e?(f.type=e,f.start=t,f.end=null,f.value=null,delete f.tagNameStartsAt,delete f.tagNameEndsAt,delete f.tagName,delete f.recognised,delete f.closing,delete f.void,delete f.pureHTML,delete f.kind,delete f.attribs,f.openingCurlyAt=null,f.closingCurlyAt=null,f.selectorsStart=null,f.selectorsEnd=null,f.selectors=[],delete f.identifier,delete f.identifierStartsAt,delete f.identifierEndsAt,delete f.query,delete f.queryStartsAt,delete f.queryEndsAt,delete f.head,delete f.tail):"at"===e?(f.type=e,f.start=t,f.end=null,f.value=null,delete f.tagNameStartsAt,delete f.tagNameEndsAt,delete f.tagName,delete f.recognised,delete f.closing,delete f.void,delete f.pureHTML,delete f.kind,delete f.attribs,f.openingCurlyAt=null,f.closingCurlyAt=null,delete f.selectorsStart,delete f.selectorsEnd,delete f.selectors,f.identifier=null,f.identifierStartsAt=null,f.identifierEndsAt=null,f.query=null,f.queryStartsAt=null,f.queryEndsAt=null,delete f.head,delete f.tail):"text"===e?(f.type=e,f.start=t,f.end=null,f.value=null,delete f.tagNameStartsAt,delete f.tagNameEndsAt,delete f.tagName,delete f.recognised,delete f.closing,delete f.void,delete f.pureHTML,delete f.kind,delete f.attribs,delete f.openingCurlyAt,delete f.closingCurlyAt,delete f.selectorsStart,delete f.selectorsEnd,delete f.selectors,delete f.identifier,delete f.identifierStartsAt,delete f.identifierEndsAt,delete f.query,delete f.queryStartsAt,delete f.queryEndsAt,delete f.head,delete f.tail):"esp"===e&&(f.type=e,f.start=t,f.end=null,f.value=null,delete f.tagNameStartsAt,delete f.tagNameEndsAt,delete f.tagName,delete f.recognised,delete f.closing,delete f.void,delete f.pureHTML,f.kind=null,delete f.attribs,delete f.openingCurlyAt,delete f.closingCurlyAt,delete f.selectorsStart,delete f.selectorsEnd,delete f.selectors,delete f.identifier,delete f.identifierStartsAt,delete f.identifierEndsAt,delete f.query,delete f.queryStartsAt,delete f.queryEndsAt,f.head=null,f.tail=null)}for(let t=0;t<=s;t++){if(!l&&e[t]&&n.reportProgressFunc&&(s>1e3&&s<2e3?t===a&&n.reportProgressFunc(Math.floor((n.reportProgressFuncTo-n.reportProgressFuncFrom)/2)):s>=2e3&&(o=n.reportProgressFuncFrom+Math.floor(t/s*(n.reportProgressFuncTo-n.reportProgressFuncFrom)),o!==i&&(i=o,n.reportProgressFunc(o)))),g&&f.type&&!["rule","at","text"].includes(f.type)&&(g=!1),Number.isInteger(l)&&t>=l&&(l=!1),!l&&E.length&&"at"===E[E.length-1].type&&K(E[E.length-1].token)&&Number.isInteger(E[E.length-1].token.openingCurlyAt)&&!Number.isInteger(E[E.length-1].token.closingCurlyAt))if("}"===e[t]){if(null===f.type||"text"===f.type||"rule"===f.type&&null===f.openingCurlyAt){"rule"===f.type&&(f.end=d(e,t)+1,f.value=e.slice(f.start,f.end),I(f),f=y(),d(e,t)<t-1&&M("text",d(e,t)+1)),V(f,t);const r=E.pop();f=r.token,f.closingCurlyAt=t,f.end=t+1,f.value=e.slice(f.start,f.end),I(f),f=y(),l=t+1}}else"text"===f.type&&e[t]&&e[t].trim()&&(f.end=t,f.value=e.slice(f.start,f.end),I(f),f=y());if(f.end&&f.end===t&&("style"!==f.tagName||f.closing||(g=!0),$?(k=$,k.attribValue.push(u(f)),f=u(N),$=void 0,N=void 0):(V(f,t),E=[])),l||(["tag","rule","at"].includes(f.type)&&"cdata"!==f.kind?!['"',"'","(",")"].includes(e[t])||['"',"'","`"].includes(e[d(e,t)])&&e[d(e,t)]===e[c(e,t)]||(Array.isArray(E)&&E.length&&"simple"===E[E.length-1].type&&E[E.length-1].value===D(e[t])?E.pop():E.push({type:"simple",value:e[t],position:t})):"comment"===f.type&&["only","not"].includes(f.kind)?["[","]"].includes(e[t])&&(Array.isArray(E)&&E.length&&"simple"===E[E.length-1].type&&E[E.length-1].value===D(e[t])?E.pop():E.push({type:"simple",value:e[t],position:t})):"esp"!==f.type||!"'\"`()".includes(e[t])||['"',"'","`"].includes(e[d(e,t)])&&e[d(e,t)]===e[c(e,t)]||(Array.isArray(E)&&E.length&&"simple"===E[E.length-1].type&&E[E.length-1].value===D(e[t])?(E.pop(),l=t+1):"]})>".includes(e[t])||E.push({type:"simple",value:e[t],position:t}))),!l&&"at"===f.type&&Number.isInteger(f.start)&&t>=f.start&&!Number.isInteger(f.identifierStartsAt)&&e[t]&&e[t].trim()&&"@"!==e[t]&&(f.identifierStartsAt=t),!l&&"at"===f.type&&Number.isInteger(f.queryStartsAt)&&!Number.isInteger(f.queryEndsAt)&&"{};".includes(e[t])&&(e[t-1]&&e[t-1].trim()?f.queryEndsAt=t:f.queryEndsAt=d(e,t)+1,f.query=e.slice(f.queryStartsAt,f.queryEndsAt)),!l&&"at"===f.type&&"{"===e[t]&&f.identifier&&!Number.isInteger(f.openingCurlyAt)){f.openingCurlyAt=t,E.push({type:"at",token:f});const r=c(e,t);"}"===e[r]?(f.closingCurlyAt=r,I(f),l=r):(y(),r>t+1&&(M("text",t+1),f.end=r,f.value=e.slice(f.start,f.end),I(f)),y(),M("rule",r),l=r)}if(!l&&"at"===f.type&&f.identifier&&e[t]&&e[t].trim()&&!Number.isInteger(f.queryStartsAt)&&(f.queryStartsAt=t),!l&&"at"===f.type&&Number.isInteger(f.identifierStartsAt)&&t>=f.start&&e[t]&&(!e[t].trim()||"()".includes(e[t]))&&!Number.isInteger(f.identifierEndsAt)&&(f.identifierEndsAt=t,f.identifier=e.slice(f.identifierStartsAt,t)),"rule"===f.type&&Number.isInteger(T)&&(Y.includes(e[t])||e[t]&&!e[t].trim()&&Y.includes(e[c(e,t)]))&&(f.selectors.push({value:e.slice(T,t),selectorStarts:T,selectorEnds:t}),T=void 0,f.selectorsEnd=t),!l)if(Z(e,t,f,E))f.type&&null!==f.start&&(V(f,t),y()),M("tag",t),g&&(g=!1),w(e,t,"doctype",{i:!0,trimCharsBeforeMatching:["?","!","["," ","-"]})?f.kind="doctype":w(e,t,"cdata",{i:!0,trimCharsBeforeMatching:["?","!","["," ","-"]})?f.kind="cdata":w(e,t,"xml",{i:!0,trimCharsBeforeMatching:["?","!","["," ","-"]})&&(f.kind="xml");else if(Q(e,t,f,E))Number.isInteger(f.start)&&V(f,t),y(),M("comment",t),"-"===e[t]?f.closing=!0:A(e,t,["<![endif]--\x3e"],{i:!0,trimBeforeMatching:!0,maxMismatches:2})&&(f.closing=!0,f.kind="only"),g&&(g=!1);else if(!G(e,t,f,E,g)||Array.isArray(E)&&E.length&&"simple"===E[E.length-1].type&&["'",'"'].includes(E[E.length-1].value)&&(!k||!k.attribStart||k.attribEnd))if(null===f.start||f.end===t)if(g)if(e[t]&&!e[t].trim()){if(y(),M("text",t),f.end=c(e,t)||e.length,f.value=e.slice(f.start,f.end),I(f),l=f.end,y(),c(e,t)&&!["{","}","<"].includes(e[c(e,t)])){const r=c(e,t);M("@"===e[r]?"at":"rule",r),e[t+1]&&!e[t+1].trim()&&(l=c(e,t))}}else e[t]&&(y(),"}".includes(e[t])?(M("text",t),l=t+1):M("@"===e[t]?"at":"rule",t));else e[t]&&(t&&(f=y()),M("text",t));else"text"===f.type&&g&&e[t]&&e[t].trim()&&!"{},".includes(e[t])&&(V(f,t),y(),M("rule",t));else{const r=z(e,t,E);if(!(W.includes(r)||Array.isArray(E)&&E.length&&"simple"===E[E.length-1].type&&E[E.length-1].value===e[t+r.length])){let n;if(E.length&&(n=J(r,E))){if("esp"===f.type){if(Number.isInteger(f.end)||(f.end=t+n,f.value=e.slice(f.start,f.end),f.tail=e.slice(t,t+n)),N){Array.isArray(N.attribs)||(N.attribs=[]),$?(k=$,k.attribValue.push(u(f))):N.attribs.push(u(f)),f=u(N),N=void 0,$=void 0,E.pop();continue}V(f,t),y()}E.pop()}else E.length&&(n=J(r,E,"matchFirst"))?("esp"===f.type&&(Number.isInteger(f.end)||(f.end=t+n,f.value=e.slice(f.start,f.end)),V(f,t),y()),E=[]):(Array.isArray(E)&&E.length&&"esp"===E[E.length-1].type&&E.pop(),$&&(Array.isArray($.attribValue)||($.attribValue=[]),$.attribValue.push(f)),E.push({type:"esp",openingLump:r,guessedClosingLump:D(r),position:t}),null!==f.start&&("tag"===f.type?(f.tagName&&f.tagNameEndsAt||(f.tagNameEndsAt=t,f.tagName=e.slice(f.tagNameStartsAt,t),f.recognised=q(f.tagName)),N=u(f),k.attribStart&&!k.attribEnd&&($=u(k))):V(f,t)),M("esp",t),f.head=r,N&&"tag"===N.type&&N.pureHTML&&(N.pureHTML=!1),$&&Array.isArray($.attribValue)&&$.attribValue.length&&($.attribValue[$.attribValue.length-1].start===f.start?$.attribValue.pop():"text"!==$.attribValue[$.attribValue.length-1].type||$.attribValue[$.attribValue.length-1].end||($.attribValue[$.attribValue.length-1].end=t,$.attribValue[$.attribValue.length-1].value=e.slice($.attribValue[$.attribValue.length-1].start,t))));l=t+(n||r.length)}}if(l||"rule"!==f.type||!e[t]||!e[t].trim()||"{}".includes(e[t])||Number.isInteger(T)||Number.isInteger(f.openingCurlyAt)||(",".includes(e[t])?f.selectorsEnd=t+1:(T=t,null===f.selectorsStart&&(f.selectorsStart=t))),"comment"===f.type&&["only","not"].includes(f.kind)&&e[t],!l)if("tag"!==f.type||E.length||">"!==e[t])if("comment"===f.type&&!E.length&&"simple"===f.kind&&("<"===e[f.start]&&"-"===e[t]&&(v(e,t,"!-",{trimBeforeMatching:!0})||b(e,t,"!-",{trimBeforeMatching:!0})&&"-"!==e[t+1])||"-"===e[f.start]&&">"===e[t]&&v(e,t,"--",{trimBeforeMatching:!0,maxMismatches:1})))"-"===e[t]&&(w(e,t,["[if","(if","{if"],{i:!0,trimBeforeMatching:!0})||w(e,t,["if"],{i:!0,trimBeforeMatching:!0})&&(H(e,t,"]",">")||e.includes("mso",t)&&!e.slice(t,e.indexOf("mso")).includes("<")&&!e.slice(t,e.indexOf("mso")).includes(">")))?f.kind="only":"-"!==e[f.start]&&A(e,t,["-<![endif"],{i:!0,trimBeforeMatching:!0,maxMismatches:2})?(f.kind="not",f.closing=!0):"simple"!==f.kind||f.closing||">"!==e[c(e,t)]?(f.end=t+1,"!"===e[d(e,t)]&&"-"===e[c(e,t)]&&(f.end=c(e,t)+1),f.value=e.slice(f.start,f.end)):(f.end=c(e,t)+1,f.kind="simplet",f.closing=null);else if("comment"!==f.type||">"!==e[t]||E.length&&"<"!==e[c(e,t)]){if("esp"===f.type&&null===f.end&&L(f.tail)&&f.tail.includes(e[t])){let r="";for(let n=t;n<s&&B.includes(e[n]);n++)r+=e[n];if(r.length>f.head.length){const n=f.head[0];if(r.endsWith(f.head))f.end=t+r.length-f.head.length,f.value=e.slice(f.start,f.end),l=f.end;else if(r.startsWith(f.tail))f.end=t+f.tail.length,f.value=e.slice(f.start,f.end),l=f.end;else if(!f.tail.includes(n)&&r.includes(n)||r.endsWith(f.head)||r.startsWith(f.tail)){const o=r.slice(0,r.indexOf(n)),i=r.slice(r.indexOf(n));o.length&&i.length&&f.tail.split("").every(e=>o.includes(e))&&(f.end=t+o.length,f.value=e.slice(f.start,f.end),l=f.end)}else f.end=t+r.length,f.value=e.slice(f.start,f.end),l=f.end}else f.end=t+r.length,f.value=e.slice(f.start,f.end),Array.isArray(E)&&E.length&&"esp"===E[E.length-1].type&&E.pop(),l=f.end}}else Array.isArray(E)&&E.length&&"["===E[E.length-1].value&&E.pop(),!["simplet","not"].includes(f.kind)&&w(e,t,["\x3c!--\x3e","\x3c!----\x3e"],{trimBeforeMatching:!0,maxMismatches:1,lastMustMatch:!0})?f.kind="not":(f.end=t+1,f.value=e.slice(f.start,f.end));else f.end=t+1,f.value=e.slice(f.start,f.end);if(l||"tag"!==f.type||!Number.isInteger(f.tagNameStartsAt)||Number.isInteger(f.tagNameEndsAt)||e[t]&&(F=e[t],/[.\-_a-z0-9\u00B7\u00C0-\uFFFD]/i.test(F))||(f.tagNameEndsAt=t,f.tagName=e.slice(f.tagNameStartsAt,t).toLowerCase(),"xml"===f.tagName&&f.closing&&!f.kind&&(f.kind="xml"),X.includes(f.tagName)&&(f.void=!0),f.recognised=q(f.tagName)),!l&&"tag"===f.type&&!Number.isInteger(f.tagNameStartsAt)&&Number.isInteger(f.start)&&(f.start<t||"<"!==e[f.start])&&("/"===e[t]?f.closing=!0:P(e[t])&&(f.tagNameStartsAt=t,f.closing||(f.closing=!1))),!l&&"tag"===f.type&&"cdata"!==f.kind&&Number.isInteger(k.attribNameStartsAt)&&t>k.attribNameStartsAt&&null===k.attribNameEndsAt&&!O(e[t])&&(k.attribNameEndsAt=t,k.attribName=e.slice(k.attribNameStartsAt,t),k.attribNameRecognised=_.has(k.attribName),e[t]&&!e[t].trim()&&"="===e[c(e,t)]||(e[t]&&!e[t].trim()||">"===e[t]||"/"===e[t]&&">"===e[c(e,t)])&&("'\"".includes(e[c(e,t)])||(k.attribEnd=t,f.attribs.push(u(k)),x()))),!l&&e[t]&&"tag"===f.type&&"cdata"!==f.kind&&Number.isInteger(f.tagNameEndsAt)&&t>f.tagNameEndsAt&&null===k.attribStart&&O(e[t])&&(k.attribStart=t,k.attribNameStartsAt=t),l||"rule"!==f.type||("{"!==e[t]||Number.isInteger(f.openingCurlyAt)?"}"===e[t]&&Number.isInteger(f.openingCurlyAt)&&!Number.isInteger(f.closingCurlyAt)&&(f.closingCurlyAt=t,f.end=t+1,f.value=e.slice(f.start,f.end),I(f),y()):f.openingCurlyAt=t),!l&&"tag"===f.type&&Number.isInteger(k.attribValueStartsAt)&&t>=k.attribValueStartsAt&&null===k.attribValueEndsAt)if("'\"".includes(e[t]))e[d(e,t)]!==e[t]||("/>"+B).includes(e[c(e,t)])||H(e,t,"=",'"')||H(e,t,"=","'")||!H(e,t,'"',">")&&!H(e,t,"'",">")||e.slice(t+1).includes("<")&&e.slice(0,e.indexOf("<")).includes("=")?!E.some(e=>"esp"===e.type)&&j(e,k.attribOpeningQuoteAt||k.attribValueStartsAt,t)&&(k.attribClosingQuoteAt=t,k.attribValueEndsAt=t,Number.isInteger(k.attribValueStartsAt)&&(k.attribValueRaw=e.slice(k.attribValueStartsAt,t)),k.attribEnd=t+1,Array.isArray(k.attribValue)&&k.attribValue.length&&!k.attribValue[k.attribValue.length-1].end&&(k.attribValue[k.attribValue.length-1].end=t,k.attribValue[k.attribValue.length-1].value=e.slice(k.attribValue[k.attribValue.length-1].start,t)),e[k.attribOpeningQuoteAt]!==e[t]&&(E.pop(),E.pop()),f.attribs.push(u(k)),x()):(k.attribOpeningQuoteAt=t,k.attribValueStartsAt=t+1,Array.isArray(k.attribValue)&&k.attribValue.length&&k.attribValue[k.attribValue.length-1].start&&!k.attribValue[k.attribValue.length-1].end&&k.attribValueStartsAt>k.attribValue[k.attribValue.length-1].start&&(k.attribValue[k.attribValue.length-1].start=k.attribValueStartsAt),E.push({type:"simple",value:e[t],position:t}));else if(null===k.attribOpeningQuoteAt&&(e[t]&&!e[t].trim()||["/",">"].includes(e[t])||B.includes(e[t])&&B.includes(e[t+1])))k.attribValueEndsAt=t,k.attribValueRaw=e.slice(k.attribValueStartsAt,t),Array.isArray(k.attribValue)&&k.attribValue.length&&!k.attribValue[k.attribValue.length-1].end&&(k.attribValue[k.attribValue.length-1].end=t,k.attribValue[k.attribValue.length-1].value=e.slice(k.attribValue[k.attribValue.length-1].start,k.attribValue[k.attribValue.length-1].end)),k.attribEnd=t,f.attribs.push(u(k)),x(),E.pop(),">"===e[t]&&(f.end=t+1,f.value=e.slice(f.start,f.end));else if("="===e[t]&&("'\"".includes(e[c(e,t)])||e[t-1]&&P(e[t-1]))){let r,n;for(let o=d(e,t);o>=k.attribValueStartsAt;o--){if(!r&&e[o]&&!e[o].trim()&&(r=!0,n)){e.slice(o,n)}r&&e[o]&&e[o].trim()&&(r=!1,n||(n=o+1))}if(n){k.attribValueEndsAt=n,Number.isInteger(k.attribValueStartsAt)&&(k.attribValueRaw=e.slice(k.attribValueStartsAt,n),Array.isArray(k.attribValue)&&k.attribValue.length&&!k.attribValue[k.attribValue.length-1].end&&(k.attribValue[k.attribValue.length-1].end=k.attribValueEndsAt,k.attribValue[k.attribValue.length-1].value=e.slice(k.attribValue[k.attribValue.length-1].start,k.attribValueEndsAt))),k.attribEnd=n,e[k.attribOpeningQuoteAt]!==e[t]&&E.pop(),f.attribs.push(u(k)),x(),t=n-1;continue}if(k.attribOpeningQuoteAt&&("'\"".includes(e[c(e,t)])||_.has(e.slice(k.attribOpeningQuoteAt+1,t).trim()))){t=k.attribOpeningQuoteAt,k.attribEnd=k.attribOpeningQuoteAt+1,k.attribValueStartsAt=null,E.pop(),f.attribs.push(u(k)),x();continue}}else k&&k.attribStart&&!k.attribEnd&&(!Array.isArray(k.attribValue)||!k.attribValue.length||k.attribValue[k.attribValue.length-1].end&&k.attribValue[k.attribValue.length-1].end<=t)&&k.attribValue.push({type:"text",start:t,end:null,value:null});if(!l&&"tag"===f.type&&!Number.isInteger(k.attribValueStartsAt)&&Number.isInteger(k.attribNameEndsAt)&&k.attribNameEndsAt<=t&&e[t]&&e[t].trim())if("="!==e[t]||"'\"=".includes(e[c(e,t)])||B.includes(e[c(e,t)])){if("'\"".includes(e[t])){const r=c(e,t);!(r&&"'\"".includes(e[r])&&e[t]!==e[r]&&e.length>r+2&&e.slice(r+1).includes(e[r]))||e.indexOf(e[r],r+1)&&c(e,e.indexOf(e[r],r+1))&&e[t]===e[c(e,e.indexOf(e[r],r+1))]||Array.from(e.slice(r+1,e.indexOf(e[r]))).some(r=>("<>="+e[t]).includes(r))?(k.attribOpeningQuoteAt=t,e[t+1]&&(k.attribValueStartsAt=t+1),!Array.isArray(k.attribValue)||k.attribValue.length&&!k.attribValue[k.attribValue.length-1].end||k.attribValue.push({type:"text",start:k.attribValueStartsAt,end:null,value:null})):E.pop()}}else{const r=c(e,t),n=[e.indexOf("'",r),e.indexOf('"',r)].filter(e=>e>0).length?Math.min(...[e.indexOf("'",r),e.indexOf('"',r)].filter(e=>e>0)):void 0;r&&e.slice(r).includes("=")&&_.has(e.slice(r,r+e.slice(r).indexOf("=")).trim().toLowerCase())?(k.attribEnd=t+1,f.attribs.push(u(k)),x()):n&&!e.slice(r,n).includes("=")&&e.includes(e[n],n+1)&&!Array.from(e.slice(n+1,e.indexOf(e[n],n+1))).some(e=>"<>=".includes(e))||(k.attribValueStartsAt=r,E.push({type:"simple",value:null,position:k.attribValueStartsAt}))}if(">"===e[t]&&"tag"===f.type&&null!==k.attribStart&&null===k.attribEnd){let r=!1;if(e[t+1])for(let n=t+1;n<s;n++){if(null!==k.attribOpeningQuoteAt&&e[n]===e[k.attribOpeningQuoteAt]){n!==t+1&&"="!==e[n-1]&&(r=!0);break}if(">"===e[n])break;if("<"===e[n]){r=!0,E.pop();break}if(!e[n+1]){r=!0;break}}else r=!0;r&&(f.end=t+1,f.value=e.slice(f.start,f.end),Number.isInteger(k.attribValueStartsAt)&&t&&k.attribValueStartsAt<t&&e.slice(k.attribValueStartsAt,t).trim()?(k.attribValueEndsAt=t,k.attribValueRaw=e.slice(k.attribValueStartsAt,t),Array.isArray(k.attribValue)&&k.attribValue.length&&!k.attribValue[k.attribValue.length-1].end&&(k.attribValue[k.attribValue.length-1].end=t,k.attribValue[k.attribValue.length-1].value=e.slice(k.attribValue[k.attribValue.length-1].start,t))):k.attribValueStartsAt=null,k.attribEnd=t,f.attribs.push(u(k)),x())}e[t]&&n.charCb&&(R={type:f.type,chr:e[t],i:t},n.charCb&&(p.push(R),p.length>n.charCbLookahead&&S(p,n.charCb,n.charCbLookahead))),e[t]||null===f.start||(f.end=t,f.value=e.slice(f.start,f.end),I(f))}var R,F;if(p.length)for(let e=0,t=p.length;e<t;e++)S(p,n.charCb,n.charCbLookahead);if(m.length)for(let e=0,t=m.length;e<t;e++)S(m,n.tagCb,n.tagCbLookahead);Date.now()}(e,{reportProgressFunc:r.reportProgressFunc,reportProgressFuncFrom:r.reportProgressFuncFrom,reportProgressFuncTo:r.reportProgressFuncTo,tagCbLookahead:2,tagCb:(e,t)=>{"function"==typeof r.tagCb&&r.tagCb(e);let u=ee.get(o,a);if(te(u)||(u=null),!l||e.closing||u&&u.tagName===e.tagName&&!u.closing&&e.closing||re(n,e)||t.length&&"text"===e.type&&"tag"===t[0].type&&(t[0].closing&&g.closing||n[n.length-3]&&t[0].tagName!==n[n.length-1].tagName&&"tag"===n[n.length-3].type&&!n[n.length-3].closing&&t[0].tagName===n[n.length-3].tagName))if(e.closing&&"string"==typeof a&&a.includes(".")&&(!e.tagName||g.tagName!==e.tagName||g.closing)){if(a=i(s(a)),re(n,e)){for(;n.length&&n[n.length-1].type!==e.type&&n[n.length-1].kind!==e.kind;)n.pop();n.pop(),l=!1}else if(n.length>1&&e.tagName&&e.tagName===n[n.length-2].tagName){if(a=i(s(a)),r.errCb){const e=n[n.length-1];r.errCb({ruleId:`${e.type}${"comment"===e.type?"-"+e.kind:""}-missing-closing`,idxFrom:e.start,idxTo:e.end,tokenObj:e})}n.pop(),n.pop()}else if(n.length>2&&n[n.length-3].type===e.type&&n[n.length-3].type===e.type&&n[n.length-3].tagName===e.tagName){if(a=i(s(a)),r.errCb){const e=n[n.length-1];r.errCb({ruleId:"tag-rogue",idxFrom:e.start,idxTo:e.end,tokenObj:e})}n.pop(),n.pop(),n.pop()}else if(n.length>1&&n[n.length-2].type===e.type&&n[n.length-2].type===e.type&&n[n.length-2].tagName===e.tagName){if(r.errCb){const e=n[n.length-1];r.errCb({ruleId:"tag-rogue",idxFrom:e.start,idxTo:e.end,tokenObj:e})}n.pop(),n.pop()}}else a?(a=i(a),re(n,e)&&n.pop()):a="0";else l=!1,a+=".children.0";p.includes(e.type)&&!e.void&&Object.prototype.hasOwnProperty.call(e,"closing")&&!e.closing&&(l=!0,f.includes(e.kind)||n.push({...e}));const h=function(e){if("string"!=typeof e||!e.length)return null;const t=e.slice(e.lastIndexOf(".")+1);return"0"===t?null:e.includes(".")&&/^\d*$/.test(t)?`${e.slice(0,e.lastIndexOf(".")+1)}${+e.slice(e.lastIndexOf(".")+1)-1}`:/^\d*$/.test(e)?""+(+e-1):null}(a),y=s(a);let b,v;y&&a.includes(".")&&(b=ee.get(o,y)),h&&(v=ee.get(o,h));const A=/(-+|-+[^>])>/;let w,_;te(v)&&Array.isArray(v.children)&&v.children.length&&v.children[v.children.length-1]&&(w=v.children[v.children.length-1],_=`${h}.children.${ee.get(o,h).children.length-1}`);let O=!1;if("text"===e.type&&te(b)&&"comment"===b.type&&"simple"===b.kind&&!b.closing&&A.test(e.value)){const t=A.exec(e.value).index,r=t+e.value.slice(t).indexOf(">")+1;t>0&&(ee.set(o,a,{...e,end:e.start+t,value:e.value.slice(0,t)}),p.includes(e.type)&&(e.children=[])),a=i(s(a)),ee.set(o,a,{type:"comment",kind:"simple",closing:!0,start:e.start+t,end:e.start+r,value:e.value.slice(t,r),children:[]}),r<e.value.length&&(a=i(a),ee.set(o,a,{type:"text",start:e.start+r,end:e.end,value:e.value.slice(r)})),O=!0}else if("comment"===e.type&&"only"===e.kind&&te(v))if("text"===v.type&&v.value.trim()&&"<!-".includes(v.value[d(v.value,v.value.length)])){const t=[];if(m(v.value,"\x3c!--",e=>{t.push(e)},{maxDistance:2}),t.length&&!c(v.value,t[t.length-1].idxTo-1)){const r=t.pop();!d(v.value,r.idxFrom)&&h&&te(v)?(p.includes(e.type)&&(e.children=[]),a=h,ee.set(o,a,{...e,start:r.idxFrom+v.start,kind:"not",value:`${v.value}${e.value}`}),O=!0):h&&te(v)&&(ee.set(o,h,{...v,end:r.idxFrom+v.start,value:v.value.slice(0,r.idxFrom)}),p.includes(e.type)&&(e.children=[]),ee.set(o,a,{...e,start:r.idxFrom+v.start,kind:"not",value:`${v.value.slice(r.idxFrom)}${e.value}`}),O=!0)}}else if(te(w)&&"text"===w.type&&w.value.trim()&&"<!-".includes(w.value[d(w.value,w.value.length)])){const t=[];if(m(w.value,"\x3c!--",e=>{t.push(e)},{maxDistance:2}),t.length&&!c(w.value,t[t.length-1].idxTo-1)){const r=t.pop();!d(w.value,r.idxFrom)&&h&&te(w)?(p.includes(e.type)&&(e.children=[]),ee.set(o,a,{...e,start:r.idxFrom+w.start,kind:"not",value:`${w.value}${e.value}`}),ee.del(o,`${h}.children.${ee.get(o,h).children.length-1}`),O=!0):h&&te(w)&&_&&(ee.set(o,_,{...w,end:r.idxFrom+w.start,value:w.value.slice(0,r.idxFrom)}),p.includes(e.type)&&(e.children=[]),ee.set(o,a,{...e,start:r.idxFrom+w.start,kind:"not",value:`${w.value.slice(r.idxFrom)}${e.value}`}),O=!0)}}O||(p.includes(e.type)&&(e.children=[]),ee.set(o,a,e)),!p.includes(e.type)||!e.closing||h&&te(v)&&!v.closing&&v.type===e.type&&v.tagName===e.tagName||(e.void?r.errCb&&r.errCb({ruleId:"tag-void-frontal-slash",idxFrom:e.start,idxTo:e.end,fix:{ranges:[[e.start+1,e.tagNameStartsAt]]},tokenObj:e}):r.errCb&&r.errCb({ruleId:`${e.type}${"comment"===e.type?"-"+e.kind:""}-missing-opening`,idxFrom:e.start,idxTo:e.end,tokenObj:e})),g={...e}},charCb:r.charCb}),n.length&&n.forEach(e=>{r.errCb&&r.errCb({ruleId:`${e.type}${"comment"===e.type?"-"+e.kind:""}-missing-closing`,idxFrom:e.start,idxTo:e.end,tokenObj:e})}),o}function oe(e,t=!0,r){if(!(r.trim()||e.length&&"\n"!==r&&" "!==r&&" "===(t?e[e.length-1]:e[0])||e.length&&"\n"===(t?e[e.length-1]:e[0])&&"\n"!==r&&" "!==r))if(t){if(("\n"===r||" "===r)&&e.length&&" "===e[e.length-1])for(;e.length&&" "===e[e.length-1];)e.pop();e.push(" "===r||"\n"===r?r:" ")}else{if(("\n"===r||" "===r)&&e.length&&" "===e[0])for(;e.length&&" "===e[0];)e.shift();e.unshift(" "===r||"\n"===r?r:" ")}}function ie(e,t){if("string"==typeof e&&e.length){let r,n,o=!1;if(e.includes("\r\n")&&(o=!0),r=t&&"number"==typeof t?t:1,""===e.trim()){const t=[];for(n=r,Array.from(e).forEach(e=>{("\n"!==e||n)&&("\n"===e&&(n-=1),oe(t,!0,e))});t.length>1&&" "===t[t.length-1];)t.pop();return t.join("")}const i=[];if(n=r,""===e[0].trim())for(let t=0,r=e.length;t<r&&!e[t].trim();t++)("\n"!==e[t]||n)&&("\n"===e[t]&&(n-=1),oe(i,!0,e[t]));const s=[];if(n=r,""===e.slice(-1).trim())for(let t=e.length;t--&&!e[t].trim();)("\n"!==e[t]||n)&&("\n"===e[t]&&(n-=1),oe(s,!1,e[t]));return o?`${i.join("")}${e.trim()}${s.join("")}`.replace(/\n/g,"\r\n"):i.join("")+e.trim()+s.join("")}return e}function se(e,t){if(!Array.isArray(e))throw new TypeError(`ranges-sort: [THROW_ID_01] Input must be an array, consisting of range arrays! Currently its type is: ${typeof e}, equal to: ${JSON.stringify(e,null,4)}`);if(0===e.length)return e;const r={strictlyTwoElementsInRangeArrays:!1,progressFn:null,...t};let n,o;if(r.strictlyTwoElementsInRangeArrays&&!e.every((e,t)=>2===e.length||(n=t,o=e.length,!1)))throw new TypeError(`ranges-sort: [THROW_ID_03] The first argument should be an array and must consist of arrays which are natural number indexes representing TWO string index ranges. However, ${n}th range (${JSON.stringify(e[n],null,4)}) has not two but ${o} elements!`);if(!e.every((e,t)=>!(!Number.isInteger(e[0])||e[0]<0||!Number.isInteger(e[1])||e[1]<0)||(n=t,!1)))throw new TypeError(`ranges-sort: [THROW_ID_04] The first argument should be an array and must consist of arrays which are natural number indexes representing string index ranges. However, ${n}th range (${JSON.stringify(e[n],null,4)}) does not consist of only natural numbers!`);const i=e.length*e.length;let s=0;return Array.from(e).sort((e,t)=>(r.progressFn&&(s+=1,r.progressFn(Math.floor(100*s/i))),e[0]===t[0]?e[1]<t[1]?-1:e[1]>t[1]?1:0:e[0]<t[0]?-1:1))}function ae(e,t){function r(e){return"string"==typeof e}function n(e){return e&&"object"==typeof e&&!Array.isArray(e)}if(!Array.isArray(e))return e;const o={mergeType:1,progressFn:null,joinRangesThatTouchEdges:!0};let i;if(t){if(!n(t))throw new Error(`emlint: [THROW_ID_03] the second input argument must be a plain object. It was given as:\n${JSON.stringify(t,null,4)} (type ${typeof t})`);if(i={...o,...t},i.progressFn&&n(i.progressFn)&&!Object.keys(i.progressFn).length)i.progressFn=null;else if(i.progressFn&&"function"!=typeof i.progressFn)throw new Error(`ranges-merge: [THROW_ID_01] opts.progressFn must be a function! It was given of a type: "${typeof i.progressFn}", equal to ${JSON.stringify(i.progressFn,null,4)}`);if(i.mergeType&&1!==i.mergeType&&2!==i.mergeType)if(r(i.mergeType)&&"1"===i.mergeType.trim())i.mergeType=1;else{if(!r(i.mergeType)||"2"!==i.mergeType.trim())throw new Error(`ranges-merge: [THROW_ID_02] opts.mergeType was customised to a wrong thing! It was given of a type: "${typeof i.mergeType}", equal to ${JSON.stringify(i.mergeType,null,4)}`);i.mergeType=2}if("boolean"!=typeof i.joinRangesThatTouchEdges)throw new Error(`ranges-merge: [THROW_ID_04] opts.joinRangesThatTouchEdges was customised to a wrong thing! It was given of a type: "${typeof i.joinRangesThatTouchEdges}", equal to ${JSON.stringify(i.joinRangesThatTouchEdges,null,4)}`)}else i={...o};const s=e.map(e=>[...e]).filter(e=>void 0!==e[2]||e[0]!==e[1]);let a,l,u;a=i.progressFn?se(s,{progressFn:e=>{u=Math.floor(e/5),u!==l&&(l=u,i.progressFn(u))}}):se(s);const c=a.length-1;for(let e=c;e>0;e--)i.progressFn&&(u=Math.floor(78*(1-e/c))+21,u!==l&&u>l&&(l=u,i.progressFn(u))),(a[e][0]<=a[e-1][0]||!i.joinRangesThatTouchEdges&&a[e][0]<a[e-1][1]||i.joinRangesThatTouchEdges&&a[e][0]<=a[e-1][1])&&(a[e-1][0]=Math.min(a[e][0],a[e-1][0]),a[e-1][1]=Math.max(a[e][1],a[e-1][1]),void 0!==a[e][2]&&(a[e-1][0]>=a[e][0]||a[e-1][1]<=a[e][1])&&null!==a[e-1][2]&&(null===a[e][2]&&null!==a[e-1][2]?a[e-1][2]=null:void 0!==a[e-1][2]?2===i.mergeType&&a[e-1][0]===a[e][0]?a[e-1][2]=a[e][2]:a[e-1][2]+=a[e][2]:a[e-1][2]=a[e][2]),a.splice(e,1),e=a.length);return a}function le(e){return null!=e}function ue(e){return Number.isInteger(e)&&e>=0}function ce(e){return"string"==typeof e}function de(e){return/^\d*$/.test(e)?parseInt(e,10):e}function ge(e){return null!=e}function me(e){return"string"==typeof e}function pe(e){return"string"==typeof e&&"."===e[0]?e.slice(1):e}function fe(e,t,r=0){const n=[];function o(){const e=n.shift();e[2].next=[];for(let t=0;t<r&&n[t];t++)e[2].next.push(u([n[t][0],n[t][1],n[t][2]]));t(...e)}if(function e(t,r,n,o){if((n={depth:-1,path:"",...n}).depth+=1,Array.isArray(t))for(let i=0,s=t.length;i<s&&!o.now;i++){const s=`${n.path}.${i}`;n.parent=u(t),n.parentType="array",r(t[i],void 0,{...n,path:pe(s)},o),e(t[i],r,{...n,path:pe(s)},o)}else if((i=t)&&"object"==typeof i&&!Array.isArray(i))for(const i in t){if(o.now&&null!=i)break;const s=`${n.path}.${i}`;0===n.depth&&null!=i&&(n.topmostKey=i),n.parent=u(t),n.parentType="object",r(i,t[i],{...n,path:pe(s)},o),e(t[i],r,{...n,path:pe(s)},o)}var i;return t}(e,(function(...e){n.push([...e]),n.length>r&&o()}),{},{now:!1}),n.length)for(let e=0,t=n.length;e<t;e++)o()}var he=/<!--([\s\S]*?)-->/g,ye=new class{constructor(e){const t={limitToBeAddedWhitespace:!1,limitLinebreaksCount:1,mergeType:1,...e};if(t.mergeType&&1!==t.mergeType&&2!==t.mergeType)if(ce(t.mergeType)&&"1"===t.mergeType.trim())t.mergeType=1;else{if(!ce(t.mergeType)||"2"!==t.mergeType.trim())throw new Error(`ranges-push: [THROW_ID_02] opts.mergeType was customised to a wrong thing! It was given of a type: "${typeof t.mergeType}", equal to ${JSON.stringify(t.mergeType,null,4)}`);t.mergeType=2}this.opts=t}add(e,t,r,...n){if(n.length>0)throw new TypeError("ranges-push/Ranges/add(): [THROW_ID_03] Please don't overload the add() method. From the 4th input argument onwards we see these redundant arguments: "+JSON.stringify(n,null,4));if(!le(e)&&!le(t))return;if(le(e)&&!le(t)){if(Array.isArray(e)){if(e.length){if(e.some(e=>Array.isArray(e)))return void e.forEach(e=>{Array.isArray(e)&&this.add(...e)});e.length>1&&ue(de(e[0]))&&ue(de(e[1]))&&this.add(...e)}return}throw new TypeError(`ranges-push/Ranges/add(): [THROW_ID_12] the first input argument, "from" is set (${JSON.stringify(e,null,0)}) but second-one, "to" is not (${JSON.stringify(t,null,0)})`)}if(!le(e)&&le(t))throw new TypeError(`ranges-push/Ranges/add(): [THROW_ID_13] the second input argument, "to" is set (${JSON.stringify(t,null,0)}) but first-one, "from" is not (${JSON.stringify(e,null,0)})`);const o=/^\d*$/.test(e)?parseInt(e,10):e,i=/^\d*$/.test(t)?parseInt(t,10):t;if(ue(r)&&(r=String(r)),!ue(o)||!ue(i))throw ue(o)&&o>=0?new TypeError(`ranges-push/Ranges/add(): [THROW_ID_10] "to" value, the second input argument, must be a natural number or zero! Currently it's of a type "${typeof i}" equal to: ${JSON.stringify(i,null,4)}`):new TypeError(`ranges-push/Ranges/add(): [THROW_ID_09] "from" value, the first input argument, must be a natural number or zero! Currently it's of a type "${typeof o}" equal to: ${JSON.stringify(o,null,4)}`);if(le(r)&&!ce(r)&&!ue(r))throw new TypeError(`ranges-push/Ranges/add(): [THROW_ID_08] The third argument, the value to add, was given not as string but ${typeof r}, equal to:\n${JSON.stringify(r,null,4)}`);if(le(this.slices)&&Array.isArray(this.last())&&o===this.last()[1]){if(this.last()[1]=i,this.last()[2],null!==this.last()[2]&&le(r)){let e=!(le(this.last()[2])&&this.last()[2].length>0)||this.opts&&this.opts.mergeType&&1!==this.opts.mergeType?r:this.last()[2]+r;this.opts.limitToBeAddedWhitespace&&(e=ie(e,this.opts.limitLinebreaksCount)),ce(e)&&!e.length||(this.last()[2]=e)}}else{this.slices||(this.slices=[]);const e=void 0===r||ce(r)&&!r.length?[o,i]:[o,i,this.opts.limitToBeAddedWhitespace?ie(r,this.opts.limitLinebreaksCount):r];this.slices.push(e)}}push(e,t,r,...n){this.add(e,t,r,...n)}current(){return null!=this.slices?(this.slices=ae(this.slices,{mergeType:this.opts.mergeType}),this.opts.limitToBeAddedWhitespace?this.slices.map(e=>le(e[2])?[e[0],e[1],ie(e[2],this.opts.limitLinebreaksCount)]:e):this.slices):null}wipe(){this.slices=void 0}replace(e){if(Array.isArray(e)&&e.length){if(!Array.isArray(e[0])||!ue(e[0][0]))throw new Error(`ranges-push/Ranges/replace(): [THROW_ID_11] Single range was given but we expected array of arrays! The first element, ${JSON.stringify(e[0],null,4)} should be an array and its first element should be an integer, a string index.`);this.slices=Array.from(e)}else this.slices=void 0}last(){return void 0!==this.slices&&Array.isArray(this.slices)?this.slices[this.slices.length-1]:null}};function be(e){return e&&"object"===t(e)&&!Array.isArray(e)}var ve={cssStylesContent:"",alwaysCenter:!1};e.defaults=ve,e.patcher=function(e,t){if("string"!=typeof e||0===e.length)return{result:e};var r=o(o({},ve),t);r.cssStylesContent&&("string"!=typeof r.cssStylesContent||!r.cssStylesContent.trim())&&(r.cssStylesContent="");var n=[];if(fe(ne(e),(function(e,t,o){if(be(e)&&"comment"===e.type&&!n.some((function(e){return o.path.startsWith(e)})))n.push(o.path);else if(be(e)&&"tag"===e.type&&"table"===e.tagName&&!n.some((function(e){return o.path.startsWith(e)}))&&!e.closing&&e.children.some((function(e){return["text","esp"].includes(e.type)}))){var i,s=1,a=!1;if(e.children.some((function(e){return"tag"===e.type&&"tr"===e.tagName&&!e.closing&&(i=e)})))for(var l=0,u=0,c=i.children.length;u<c;u++){var d=i.children[u];"tag"===d.type&&"td"===d.tagName?d.closing||(a=d.attribs.some((function(e){return"align"===e.attribName&&"center"===e.attribValueRaw||"style"===e.attribName&&/text-align:\s*center/i.test(e.attribValueRaw)})),++l>s&&(s=l)):("text"!==d.type||d.value.replace(he,"").trim())&&(l=0)}e.children.filter((function(e){return["text","esp"].includes(e.type)})).forEach((function(e){e.value.replace(he,"").trim()&&ye.push(e.start,e.end,"\n<tr>\n  <td".concat(s>1?' colspan="'.concat(s,'"'):"").concat(r.alwaysCenter||a?' align="center"':"").concat(r.cssStylesContent?' style="'.concat(r.cssStylesContent,'"'):"",">\n    ").concat(e.value.trim(),"\n  </td>\n</tr>\n"))})),e.children.filter((function(e){return"tag"===e.type&&"tr"===e.tagName&&!e.closing})).forEach((function(e){for(var t=!1,n=0,o=e.children.length;n<o;n++){var i=e.children[n];t&&"comment"===i.type&&i.closing?t=!1:(t||"comment"!==i.type||i.closing||(t=!0),!t&&["text","esp"].includes(i.type)&&i.value.trim()&&i.value.trim()&&(n?n&&o>1&&n===o-1?ye.push(i.start,i.end,"\n</tr>\n<tr>\n  <td".concat(s>1?' colspan="'.concat(s,'"'):"").concat(r.alwaysCenter||a?' align="center"':"").concat(r.cssStylesContent?' style="'.concat(r.cssStylesContent,'"'):"",">\n    ").concat(i.value.trim(),"\n  </td>\n")):ye.push(i.start,i.end,"\n</tr>\n<tr>\n  <td".concat(s>1?' colspan="'.concat(s,'"'):"").concat(r.alwaysCenter||a?' align="center"':"").concat(r.cssStylesContent?' style="'.concat(r.cssStylesContent,'"'):"",">\n    ").concat(i.value.trim(),"\n  </td>\n</tr>\n<tr>\n")):ye.push(i.start,i.end,"\n  <td".concat(s>1?' colspan="'.concat(s,'"'):"").concat(r.alwaysCenter||a?' align="center"':"").concat(r.cssStylesContent?' style="'.concat(r.cssStylesContent,'"'):"",">\n    ").concat(i.value.trim(),"\n  </td>\n</tr>\n<tr>\n"))))}}))}})),ye.current()){var i=function(e,t,r){let n,o=0,i=0;if(0===arguments.length)throw new Error("ranges-apply: [THROW_ID_01] inputs missing!");if(!me(e))throw new TypeError(`ranges-apply: [THROW_ID_02] first input argument must be a string! Currently it's: ${typeof e}, equal to: ${JSON.stringify(e,null,4)}`);if(null===t)return e;if(!Array.isArray(t))throw new TypeError(`ranges-apply: [THROW_ID_03] second input argument must be an array (or null)! Currently it's: ${typeof t}, equal to: ${JSON.stringify(t,null,4)}`);if(r&&"function"!=typeof r)throw new TypeError(`ranges-apply: [THROW_ID_04] the third input argument must be a function (or falsey)! Currently it's: ${typeof r}, equal to: ${JSON.stringify(r,null,4)}`);n=Array.isArray(t)&&(Number.isInteger(t[0])&&t[0]>=0||/^\d*$/.test(t[0]))&&(Number.isInteger(t[1])&&t[1]>=0||/^\d*$/.test(t[1]))?[Array.from(t)]:Array.from(t);const s=n.length;let a=0;n.forEach((e,t)=>{if(r&&(o=Math.floor(a/s*10),o!==i&&(i=o,r(o))),!Array.isArray(e))throw new TypeError(`ranges-apply: [THROW_ID_05] ranges array, second input arg., has ${t}th element not an array: ${JSON.stringify(e,null,4)}, which is ${typeof e}`);if(!Number.isInteger(e[0])||e[0]<0){if(!/^\d*$/.test(e[0]))throw new TypeError(`ranges-apply: [THROW_ID_06] ranges array, second input arg. has ${t}th element, array [${e[0]},${e[1]}]. That array has first element not an integer, but ${typeof e[0]}, equal to: ${JSON.stringify(e[0],null,4)}. Computer doesn't like this.`);n[t][0]=Number.parseInt(n[t][0],10)}if(!Number.isInteger(e[1])){if(!/^\d*$/.test(e[1]))throw new TypeError(`ranges-apply: [THROW_ID_07] ranges array, second input arg. has ${t}th element, array [${e[0]},${e[1]}]. That array has second element not an integer, but ${typeof e[1]}, equal to: ${JSON.stringify(e[1],null,4)}. Computer doesn't like this.`);n[t][1]=Number.parseInt(n[t][1],10)}a+=1});const l=ae(n,{progressFn:e=>{r&&(o=10+Math.floor(e/10),o!==i&&(i=o,r(o)))}}),u=l.length;if(u>0){const t=e.slice(l[u-1][1]);e=l.reduce((t,n,s,a)=>{r&&(o=20+Math.floor(s/u*80),o!==i&&(i=o,r(o)));const l=0===s?0:a[s-1][1],c=a[s][0];return t+e.slice(l,c)+(ge(a[s][2])?a[s][2]:"")},""),e+=t}return e}(e,ye.current());return ye.wipe(),{result:i}}return{result:e}},e.version="2.0.0",Object.defineProperty(e,"__esModule",{value:!0})}));
